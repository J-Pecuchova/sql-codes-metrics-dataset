ID;TG;Student;Model;Variant;X;AXC
1;A;-1;ChatGPT5.2;0;1;"CREATE OR REPLACE TABLE retail (
    invoice_no   INTEGER,
    stock_code   STRING,
    description  STRING,
    quantity     INTEGER,
    invoice_date TIMESTAMP,
    unit_price   NUMBER(10,2),
    customer_id  INTEGER,
    country      STRING
);

CREATE OR REPLACE FILE FORMAT retail_csv_ff
    TYPE = CSV
    FIELD_DELIMITER = ';'
    SKIP_HEADER = 1
    FIELD_OPTIONALLY_ENCLOSED_BY = '""'
    NULL_IF = ('', 'NULL');

COPY INTO retail
FROM @~/online_retail.csv
FILE_FORMAT = retail_csv_ff
ON_ERROR = CONTINUE;"
2;A;-1;ChatGPT5.2;1;1;"CREATE OR REPLACE TABLE retail (
    invoice_no   INTEGER,
    stock_code   STRING,
    description  STRING,
    quantity     INTEGER,
    invoice_date TIMESTAMP,
    unit_price   NUMBER(10, 2),
    customer_id  INTEGER,
    country      STRING
);

CREATE OR REPLACE FILE FORMAT retail_csv_format
    TYPE = CSV
    FIELD_DELIMITER = ';'
    SKIP_HEADER = 1
    FIELD_OPTIONALLY_ENCLOSED_BY = '""'
    NULL_IF = ('', 'NULL');

COPY INTO retail
FROM @~/online_retail.csv
FILE_FORMAT = retail_csv_format
ON_ERROR = CONTINUE;"
3;A;-1;ChatGPT5.2;2;1;"CREATE OR REPLACE TABLE retail (
    invoice_no   INTEGER,
    stock_code   STRING,
    description  STRING,
    quantity     INTEGER,
    invoice_date TIMESTAMP,
    unit_price   NUMBER(10, 2),
    customer_id  INTEGER,
    country      STRING
);

CREATE OR REPLACE FILE FORMAT retail_csv_format
    TYPE = CSV
    FIELD_DELIMITER = ';'
    SKIP_HEADER = 1
    FIELD_OPTIONALLY_ENCLOSED_BY = '""'
    NULL_IF = ('', 'NULL');

COPY INTO retail
FROM @~/online_retail.csv
FILE_FORMAT = retail_csv_format
ON_ERROR = CONTINUE;"
4;A;-1;ChatGPT5.2;3;1;"CREATE OR REPLACE TABLE retail (
  invoice_no INTEGER, stock_code STRING, description STRING, quantity INTEGER,
  invoice_date TIMESTAMP, unit_price NUMBER(10,2), customer_id INTEGER, country STRING
);
CREATE OR REPLACE FILE FORMAT ff_retail TYPE=CSV FIELD_DELIMITER=';' SKIP_HEADER=1 FIELD_OPTIONALLY_ENCLOSED_BY='""' NULL_IF=('', 'NULL');
COPY INTO retail FROM @~/online_retail.csv FILE_FORMAT=ff_retail ON_ERROR=CONTINUE;"
5;B;-1;ChatGPT5.2;0;1;"CREATE OR REPLACE TABLE games (
    id            INTEGER,
    name          STRING,
    platform      STRING,
    year          INTEGER,
    genre         STRING,
    publisher     STRING,
    na_sales      NUMBER(10,2),
    eu_sales      NUMBER(10,2),
    jp_sales      NUMBER(10,2),
    other_sales   NUMBER(10,2),
    global_sales  NUMBER(10,2)
);

CREATE OR REPLACE FILE FORMAT games_csv_ff
    TYPE = CSV
    FIELD_DELIMITER = ','
    SKIP_HEADER = 1
    FIELD_OPTIONALLY_ENCLOSED_BY = '""'
    NULL_IF = ('', 'NULL');

COPY INTO games
FROM @~/video_game_sales.csv
FILE_FORMAT = games_csv_ff
ON_ERROR = CONTINUE;"
6;B;-1;ChatGPT5.2;1;1;"CREATE OR REPLACE TABLE games (
    id            INTEGER,
    name          STRING,
    platform      STRING,
    year          INTEGER,
    genre         STRING,
    publisher     STRING,
    na_sales      NUMBER(10,2),
    eu_sales      NUMBER(10,2),
    jp_sales      NUMBER(10,2),
    other_sales   NUMBER(10,2),
    global_sales  NUMBER(10,2)
);

CREATE OR REPLACE FILE FORMAT games_csv_format
    TYPE = CSV
    FIELD_DELIMITER = ','
    SKIP_HEADER = 1
    FIELD_OPTIONALLY_ENCLOSED_BY = '""'
    NULL_IF = ('', 'NULL');

COPY INTO games
FROM @~/video_game_sales.csv
FILE_FORMAT = games_csv_format
ON_ERROR = CONTINUE;"
7;B;-1;ChatGPT5.2;2;1;"CREATE OR REPLACE TABLE games (
    id           INTEGER,
    name         STRING,
    platform     STRING,
    year         INTEGER,
    genre        STRING,
    publisher    STRING,
    na_sales     NUMBER(10,2),
    eu_sales     NUMBER(10,2),
    jp_sales     NUMBER(10,2),
    other_sales  NUMBER(10,2),
    global_sales NUMBER(10,2)
);

CREATE OR REPLACE FILE FORMAT games_csv_format
    TYPE = CSV
    FIELD_DELIMITER = ','
    SKIP_HEADER = 1
    FIELD_OPTIONALLY_ENCLOSED_BY = '""'
    NULL_IF = ('', 'NULL');

COPY INTO games
FROM @~/video_game_sales.csv
FILE_FORMAT = games_csv_format
ON_ERROR = CONTINUE;"
8;B;-1;ChatGPT5.2;3;1;"CREATE OR REPLACE TABLE games (
  id INTEGER, name STRING, platform STRING, year INTEGER, genre STRING, publisher STRING,
  na_sales NUMBER(10,2), eu_sales NUMBER(10,2), jp_sales NUMBER(10,2),
  other_sales NUMBER(10,2), global_sales NUMBER(10,2)
);
CREATE OR REPLACE FILE FORMAT ff_games TYPE=CSV FIELD_DELIMITER=',' SKIP_HEADER=1 FIELD_OPTIONALLY_ENCLOSED_BY='""' NULL_IF=('', 'NULL');
COPY INTO games FROM @~/video_game_sales.csv FILE_FORMAT=ff_games ON_ERROR=CONTINUE;"
9;C;-1;ChatGPT5.2;0;1;"CREATE OR REPLACE TABLE eshop (
    year            INTEGER,
    month           INTEGER,
    day             INTEGER,
    order_no        INTEGER,
    country         STRING,
    session_id      INTEGER,
    category        STRING,
    clothing_model  STRING,
    colour          STRING,
    location        STRING,
    model           INTEGER,
    price           INTEGER,
    page            STRING
);

CREATE OR REPLACE FILE FORMAT eshop_csv_ff
    TYPE = CSV
    FIELD_DELIMITER = ';'
    SKIP_HEADER = 1
    FIELD_OPTIONALLY_ENCLOSED_BY = '""'
    NULL_IF = ('', 'NULL');

COPY INTO eshop
FROM @~/eshop_clothing.csv
FILE_FORMAT = eshop_csv_ff
ON_ERROR = CONTINUE;"
10;C;-1;ChatGPT5.2;1;1;"CREATE OR REPLACE TABLE eshop (
    year            INTEGER,
    month           INTEGER,
    day             INTEGER,
    order_no        INTEGER,
    country         STRING,
    session_id      INTEGER,
    category        STRING,
    clothing_model  STRING,
    colour          STRING,
    location        STRING,
    model           INTEGER,
    price           INTEGER,
    page            STRING
);

CREATE OR REPLACE FILE FORMAT eshop_csv_format
    TYPE = CSV
    FIELD_DELIMITER = ';'
    SKIP_HEADER = 1
    FIELD_OPTIONALLY_ENCLOSED_BY = '""'
    NULL_IF = ('', 'NULL');

COPY INTO eshop
FROM @~/eshop_clothing.csv
FILE_FORMAT = eshop_csv_format
ON_ERROR = CONTINUE;"
11;C;-1;ChatGPT5.2;2;1;"CREATE OR REPLACE TABLE eshop (
    year           INTEGER,
    month          INTEGER,
    day            INTEGER,
    order_no       INTEGER,
    country        STRING,
    session_id     INTEGER,
    category       STRING,
    clothing_model STRING,
    colour         STRING,
    location       STRING,
    model          INTEGER,
    price          INTEGER,
    page           STRING
);

CREATE OR REPLACE FILE FORMAT eshop_csv_format
    TYPE = CSV
    FIELD_DELIMITER = ';'
    SKIP_HEADER = 1
    FIELD_OPTIONALLY_ENCLOSED_BY = '""'
    NULL_IF = ('', 'NULL');

COPY INTO eshop
FROM @~/eshop_clothing.csv
FILE_FORMAT = eshop_csv_format
ON_ERROR = CONTINUE;"
12;C;-1;ChatGPT5.2;3;1;"CREATE OR REPLACE TABLE eshop (
  year INTEGER, month INTEGER, day INTEGER, order_no INTEGER, country STRING,
  session_id INTEGER, category STRING, clothing_model STRING, colour STRING,
  location STRING, model INTEGER, price INTEGER, page STRING
);
CREATE OR REPLACE FILE FORMAT ff_eshop TYPE=CSV FIELD_DELIMITER=';' SKIP_HEADER=1 FIELD_OPTIONALLY_ENCLOSED_BY='""' NULL_IF=('', 'NULL');
COPY INTO eshop FROM @~/eshop_clothing.csv FILE_FORMAT=ff_eshop ON_ERROR=CONTINUE;"
13;D;-1;ChatGPT5.2;0;1;"CREATE OR REPLACE TABLE sales (
    order_id        STRING,
    order_date      DATE,
    status          STRING,
    fulfilment      STRING,
    ship_service    STRING,
    product         STRING,
    category        STRING,
    size            STRING,
    courier_status  STRING,
    quantity        INTEGER,
    amount          NUMBER(10,2),
    ship_state      STRING
);

CREATE OR REPLACE FILE FORMAT sales_csv_format
    TYPE = CSV
    FIELD_DELIMITER = ';'
    SKIP_HEADER = 1
    FIELD_OPTIONALLY_ENCLOSED_BY = '""'
    NULL_IF = ('', 'NULL');

COPY INTO sales
FROM @~/amazon_report.csv
FILE_FORMAT = sales_csv_format
ON_ERROR = CONTINUE;"
14;D;-1;ChatGPT5.2;1;1;"CREATE OR REPLACE TABLE sales (
    order_id       STRING,
    order_date     DATE,
    status         STRING,
    fulfilment     STRING,
    ship_service   STRING,
    product        STRING,
    category       STRING,
    size           STRING,
    courier_status STRING,
    quantity       INTEGER,
    amount         NUMBER(10,2),
    ship_state     STRING
);

CREATE OR REPLACE FILE FORMAT sales_csv_format
    TYPE = CSV
    FIELD_DELIMITER = ';'
    SKIP_HEADER = 1
    FIELD_OPTIONALLY_ENCLOSED_BY = '""'
    NULL_IF = ('', 'NULL');

COPY INTO sales
FROM @~/amazon_report.csv
FILE_FORMAT = sales_csv_format
ON_ERROR = CONTINUE;"
15;D;-1;ChatGPT5.2;2;1;"CREATE OR REPLACE TABLE sales (
    order_id        STRING,
    order_date      DATE,
    status          STRING,
    fulfilment      STRING,
    ship_service    STRING,
    product         STRING,
    category        STRING,
    size            STRING,
    courier_status  STRING,
    quantity        INTEGER,
    amount          NUMBER(10,2),
    ship_state      STRING
);

CREATE OR REPLACE FILE FORMAT sales_csv_format
    TYPE = CSV
    FIELD_DELIMITER = ';'
    SKIP_HEADER = 1
    FIELD_OPTIONALLY_ENCLOSED_BY = '""'
    NULL_IF = ('', 'NULL');

COPY INTO sales
FROM @~/amazon_report.csv
FILE_FORMAT = sales_csv_format
ON_ERROR = CONTINUE;"
16;D;-1;ChatGPT5.2;3;1;"CREATE OR REPLACE TABLE sales (
  order_id STRING, order_date DATE, status STRING, fulfilment STRING,
  ship_service STRING, product STRING, category STRING, size STRING,
  courier_status STRING, quantity INTEGER, amount NUMBER(10,2), ship_state STRING
);
CREATE OR REPLACE FILE FORMAT ff_sales TYPE=CSV FIELD_DELIMITER=';' SKIP_HEADER=1 FIELD_OPTIONALLY_ENCLOSED_BY='""' NULL_IF=('', 'NULL');
COPY INTO sales FROM @~/amazon_report.csv FILE_FORMAT=ff_sales ON_ERROR=CONTINUE;"
17;A;-1;ChatGPT5.2;0;2;"SELECT
    customer_id,
    SUM(quantity * unit_price) AS total_turnover_14_days
FROM retail
WHERE customer_id IS NOT NULL
  AND quantity <> 0
  AND invoice_date >= DATEADD(
        DAY,
        -14,
        (SELECT MAX(invoice_date) FROM retail)
      )
GROUP BY customer_id
ORDER BY total_turnover_14_days DESC;"
18;A;-1;ChatGPT5.2;1;2;"WITH max_date AS (
    SELECT MAX(invoice_date) AS max_invoice_date
    FROM retail
)
SELECT
    r.customer_id,
    SUM(r.quantity * r.unit_price) AS total_turnover_last_14_days
FROM retail r
CROSS JOIN max_date
WHERE r.customer_id IS NOT NULL
  AND r.quantity <> 0
  AND r.invoice_date >= DATEADD(DAY, -14, max_invoice_date)
GROUP BY r.customer_id
ORDER BY total_turnover_last_14_days DESC;"
19;A;-1;ChatGPT5.2;2;2;"WITH max_invoice_date AS (
    SELECT MAX(invoice_date) AS max_date
    FROM retail
),
recent_transactions AS (
    SELECT
        customer_id,
        quantity * unit_price AS amount
    FROM retail
    CROSS JOIN max_invoice_date
    WHERE customer_id IS NOT NULL
      AND quantity <> 0
      AND invoice_date >= DATEADD(DAY, -14, max_date)
)
SELECT
    customer_id,
    SUM(amount) AS total_turnover_last_14_days
FROM recent_transactions
GROUP BY customer_id
ORDER BY total_turnover_last_14_days DESC;"
20;A;-1;ChatGPT5.2;3;2;"SELECT customer_id, SUM(quantity*unit_price) AS turnover_14d
FROM retail
WHERE customer_id IS NOT NULL AND quantity<>0
  AND invoice_date >= DATEADD(DAY,-14,(SELECT MAX(invoice_date) FROM retail))
GROUP BY customer_id
ORDER BY turnover_14d DESC;"
21;B;-1;ChatGPT5.2;0;2;"WITH max_year AS (
    SELECT MAX(year) AS max_year FROM games
)
SELECT
    platform,
    year,
    SUM(global_sales) AS total_global_sales
FROM games, max_year
WHERE year >= max_year - 2
GROUP BY platform, year
ORDER BY platform, year;"
22;B;-1;ChatGPT5.2;1;2;"WITH max_year AS (
    SELECT MAX(year) AS max_year
    FROM games
)
SELECT
    platform,
    year,
    SUM(global_sales) AS total_global_sales
FROM games, max_year
WHERE year >= max_year - 2
GROUP BY platform, year
ORDER BY platform, year;"
23;B;-1;ChatGPT5.2;2;2;"WITH max_year_cte AS (
    SELECT MAX(year) AS max_year
    FROM games
),
filtered_games AS (
    SELECT *
    FROM games, max_year_cte
    WHERE year >= max_year - 2
)
SELECT
    platform,
    year,
    SUM(global_sales) AS total_global_sales
FROM filtered_games
GROUP BY platform, year
ORDER BY platform, year;"
24;B;-1;ChatGPT5.2;3;2;"SELECT platform, year, SUM(global_sales) total_global_sales
FROM games
WHERE year >= (SELECT MAX(year) FROM games) - 2
GROUP BY platform, year
ORDER BY platform, year;"
25;C;-1;ChatGPT5.2;0;2;"WITH daily_sales AS (
    SELECT
        country,
        DATE_FROM_PARTS(year, month, day) AS sales_date,
        SUM(price) AS daily_revenue
    FROM eshop
    GROUP BY country, sales_date
)
SELECT
    country,
    sales_date,
    daily_revenue,
    SUM(daily_revenue) OVER (
        PARTITION BY country
        ORDER BY sales_date
        ROWS BETWEEN 6 PRECEDING AND CURRENT ROW
    ) AS rolling_7_day_revenue
FROM daily_sales
ORDER BY country, sales_date;"
26;C;-1;ChatGPT5.2;1;2;"WITH daily_sales AS (
    SELECT
        country,
        DATE_FROM_PARTS(year, month, day) AS sales_date,
        SUM(price) AS daily_revenue
    FROM eshop
    GROUP BY country, sales_date
)
SELECT
    country,
    sales_date,
    daily_revenue,
    SUM(daily_revenue) OVER (
        PARTITION BY country
        ORDER BY sales_date
        ROWS BETWEEN 6 PRECEDING AND CURRENT ROW
    ) AS rolling_7_day_revenue
FROM daily_sales
ORDER BY country, sales_date;"
27;C;-1;ChatGPT5.2;2;2;"WITH daily_revenue AS (
    SELECT
        country,
        DATE_FROM_PARTS(year, month, day) AS sales_date,
        SUM(price) AS daily_price
    FROM eshop
    GROUP BY country, sales_date
)
SELECT
    country,
    sales_date,
    daily_price,
    SUM(daily_price) OVER (
        PARTITION BY country
        ORDER BY sales_date
        ROWS BETWEEN 6 PRECEDING AND CURRENT ROW
    ) AS rolling_7_day_sum
FROM daily_revenue
ORDER BY country, sales_date;"
28;C;-1;ChatGPT5.2;3;2;"SELECT country, d, daily_price,
       SUM(daily_price) OVER (PARTITION BY country ORDER BY d ROWS BETWEEN 6 PRECEDING AND CURRENT ROW) rolling_7d
FROM (
  SELECT country, DATE_FROM_PARTS(year,month,day) d, SUM(price) daily_price
  FROM eshop GROUP BY country, d
)
ORDER BY country, d;"
29;D;-1;ChatGPT5.2;0;2;"WITH daily_state_sales AS (
    SELECT
        ship_state,
        order_date,
        SUM(amount) AS daily_amount
    FROM sales
    GROUP BY ship_state, order_date
)
SELECT
    ship_state,
    order_date,
    daily_amount,
    SUM(daily_amount) OVER (
        PARTITION BY ship_state
        ORDER BY order_date
        ROWS BETWEEN 6 PRECEDING AND CURRENT ROW
    ) AS rolling_7_day_amount
FROM daily_state_sales
ORDER BY ship_state, order_date;"
30;D;-1;ChatGPT5.2;1;2;"WITH daily_sales AS (
    SELECT
        ship_state,
        order_date,
        SUM(amount) AS daily_amount
    FROM sales
    GROUP BY ship_state, order_date
)
SELECT
    ship_state,
    order_date,
    daily_amount,
    SUM(daily_amount) OVER (
        PARTITION BY ship_state
        ORDER BY order_date
        ROWS BETWEEN 6 PRECEDING AND CURRENT ROW
    ) AS rolling_7_day_amount
FROM daily_sales
ORDER BY ship_state, order_date;"
31;D;-1;ChatGPT5.2;2;2;"WITH daily_ship_state_sales AS (
    SELECT
        ship_state,
        order_date,
        SUM(amount) AS daily_amount
    FROM sales
    GROUP BY ship_state, order_date
)
SELECT
    ship_state,
    order_date,
    daily_amount,
    SUM(daily_amount) OVER (
        PARTITION BY ship_state
        ORDER BY order_date
        ROWS BETWEEN 6 PRECEDING AND CURRENT ROW
    ) AS rolling_7_day_amount
FROM daily_ship_state_sales
ORDER BY ship_state, order_date;"
32;D;-1;ChatGPT5.2;3;2;"SELECT ship_state, order_date, daily_amount,
       SUM(daily_amount) OVER (PARTITION BY ship_state ORDER BY order_date ROWS BETWEEN 6 PRECEDING AND CURRENT ROW) rolling_7d
FROM (
  SELECT ship_state, order_date, SUM(amount) daily_amount
  FROM sales GROUP BY ship_state, order_date
)
ORDER BY ship_state, order_date;"
33;A;-1;ChatGPT5.2;0;3;"SELECT
    customer_id,
    invoice_date,
    DATEDIFF(
        DAY,
        invoice_date,
        LEAD(invoice_date) OVER (
            PARTITION BY customer_id
            ORDER BY invoice_date
        )
    ) AS days_to_next_order
FROM retail
WHERE customer_id IS NOT NULL
  AND quantity <> 0
QUALIFY days_to_next_order IS NOT NULL
ORDER BY days_to_next_order DESC;"
34;A;-1;ChatGPT5.2;1;3;"SELECT
    customer_id,
    invoice_date,
    DATEDIFF(
        DAY,
        invoice_date,
        LEAD(invoice_date) OVER (
            PARTITION BY customer_id
            ORDER BY invoice_date
        )
    ) AS days_to_next_order
FROM retail
WHERE customer_id IS NOT NULL
  AND quantity <> 0
QUALIFY days_to_next_order IS NOT NULL
ORDER BY days_to_next_order DESC;"
35;A;-1;ChatGPT5.2;2;3;"WITH ordered_purchases AS (
    SELECT
        customer_id,
        invoice_date,
        LEAD(invoice_date) OVER (
            PARTITION BY customer_id
            ORDER BY invoice_date
        ) AS next_invoice_date
    FROM retail
    WHERE customer_id IS NOT NULL
      AND quantity <> 0
)
SELECT
    customer_id,
    invoice_date,
    DATEDIFF(DAY, invoice_date, next_invoice_date) AS days_to_next_order
FROM ordered_purchases
WHERE next_invoice_date IS NOT NULL
ORDER BY days_to_next_order DESC;"
36;A;-1;ChatGPT5.2;3;3;"SELECT customer_id, invoice_date,
       DATEDIFF(DAY, invoice_date,
         LEAD(invoice_date) OVER (PARTITION BY customer_id ORDER BY invoice_date)
       ) AS days_to_next_order
FROM retail
WHERE customer_id IS NOT NULL AND quantity<>0
QUALIFY days_to_next_order IS NOT NULL
ORDER BY days_to_next_order DESC;"
37;B;-1;ChatGPT5.2;0;3;"WITH yearly_genre_sales AS (
    SELECT
        genre,
        year,
        SUM(global_sales) AS total_global_sales
    FROM games
    GROUP BY genre, year
)
SELECT
    genre,
    year,
    total_global_sales,
    total_global_sales
      - LAG(total_global_sales) OVER (PARTITION BY genre ORDER BY year)
        AS diff_vs_previous_year
FROM yearly_genre_sales
ORDER BY genre, year;"
38;B;-1;ChatGPT5.2;1;3;"WITH yearly_genre_sales AS (
    SELECT
        genre,
        year,
        SUM(global_sales) AS total_global_sales
    FROM games
    GROUP BY genre, year
)
SELECT
    genre,
    year,
    total_global_sales,
    total_global_sales
      - LAG(total_global_sales)
        OVER (PARTITION BY genre ORDER BY year) AS diff_vs_previous_year
FROM yearly_genre_sales
ORDER BY genre, year;"
39;B;-1;ChatGPT5.2;2;3;"WITH yearly_genre_sales AS (
    SELECT
        genre,
        year,
        SUM(global_sales) AS total_global_sales
    FROM games
    GROUP BY genre, year
)
SELECT
    genre,
    year,
    total_global_sales,
    total_global_sales
      - LAG(total_global_sales)
        OVER (PARTITION BY genre ORDER BY year) AS diff_vs_previous_year
FROM yearly_genre_sales
ORDER BY genre, year;"
40;B;-1;ChatGPT5.2;3;3;"SELECT genre, year, total_global_sales,
       total_global_sales - LAG(total_global_sales) OVER (PARTITION BY genre ORDER BY year) diff_vs_prev_year
FROM (
  SELECT genre, year, SUM(global_sales) total_global_sales
  FROM games
  GROUP BY genre, year
)
ORDER BY genre, year;"
41;C;-1;ChatGPT5.2;0;3;"SELECT
    clothing_model,
    DATE_FROM_PARTS(year, month, day) AS sales_date,
    price,
    price - LAG(price) OVER (
        PARTITION BY clothing_model
        ORDER BY DATE_FROM_PARTS(year, month, day)
    ) AS price_change
FROM eshop
ORDER BY clothing_model, sales_date"
42;C;-1;ChatGPT5.2;1;3;"SELECT
    clothing_model,
    DATE_FROM_PARTS(year, month, day) AS sales_date,
    price,
    price - LAG(price) OVER (
        PARTITION BY clothing_model
        ORDER BY DATE_FROM_PARTS(year, month, day)
    ) AS price_change
FROM eshop
ORDER BY clothing_model, sales_date;"
43;C;-1;ChatGPT5.2;2;3;"WITH model_prices AS (
    SELECT
        clothing_model,
        DATE_FROM_PARTS(year, month, day) AS sales_date,
        price
    FROM eshop
)
SELECT
    clothing_model,
    sales_date,
    price,
    price - LAG(price) OVER (
        PARTITION BY clothing_model
        ORDER BY sales_date
    ) AS price_change
FROM model_prices
ORDER BY clothing_model, sales_date;"
44;C;-1;ChatGPT5.2;3;3;"SELECT clothing_model, d, price,
       price - LAG(price) OVER (PARTITION BY clothing_model ORDER BY d) price_change
FROM (
  SELECT clothing_model, DATE_FROM_PARTS(year,month,day) d, price FROM eshop
)
ORDER BY clothing_model, d;"
45;D;-1;ChatGPT5.2;0;3;"SELECT
    ship_state,
    order_id,
    order_date,
    DATEDIFF(
        DAY,
        order_date,
        MAX(order_date) OVER (PARTITION BY ship_state)
    ) AS days_late_vs_latest
FROM sales
ORDER BY days_late_vs_latest DESC;"
46;D;-1;ChatGPT5.2;1;3;"SELECT
    ship_state,
    order_id,
    order_date,
    DATEDIFF(
        DAY,
        order_date,
        MAX(order_date) OVER (PARTITION BY ship_state)
    ) AS days_difference
FROM sales
ORDER BY days_difference DESC;"
47;D;-1;ChatGPT5.2;2;3;"WITH latest_order_per_state AS (
    SELECT
        ship_state,
        MAX(order_date) AS latest_order_date
    FROM sales
    GROUP BY ship_state
)
SELECT
    s.ship_state,
    s.order_id,
    s.order_date,
    DATEDIFF(
        DAY,
        s.order_date,
        l.latest_order_date
    ) AS days_difference
FROM sales s
JOIN latest_order_per_state l
  ON s.ship_state = l.ship_state
ORDER BY days_difference DESC;"
48;D;-1;ChatGPT5.2;3;3;"SELECT ship_state, order_id, order_date,
       DATEDIFF(DAY, order_date, MAX(order_date) OVER (PARTITION BY ship_state)) days_diff
FROM sales
ORDER BY days_diff DESC;"
49;A;-1;ChatGPT5.2;0;4;"SELECT
    customer_id,
    total_amount,
    NTILE(4) OVER (ORDER BY total_amount DESC) AS turnover_quartile
FROM (
    SELECT
        customer_id,
        SUM(quantity * unit_price) AS total_amount
    FROM retail
    WHERE customer_id IS NOT NULL
      AND quantity <> 0
    GROUP BY customer_id
)
ORDER BY total_amount DESC;"
50;A;-1;ChatGPT5.2;1;4;"WITH customer_turnover AS (
    SELECT
        customer_id,
        SUM(quantity * unit_price) AS total_amount
    FROM retail
    WHERE customer_id IS NOT NULL
      AND quantity <> 0
    GROUP BY customer_id
)
SELECT
    customer_id,
    total_amount,
    NTILE(4) OVER (ORDER BY total_amount DESC) AS turnover_quartile
FROM customer_turnover
ORDER BY total_amount DESC;"
51;A;-1;ChatGPT5.2;2;4;"WITH customer_turnover AS (
    SELECT
        customer_id,
        SUM(quantity * unit_price) AS total_amount
    FROM retail
    WHERE customer_id IS NOT NULL
      AND quantity <> 0
    GROUP BY customer_id
)
SELECT
    customer_id,
    total_amount,
    NTILE(4) OVER (ORDER BY total_amount DESC) AS turnover_quartile
FROM customer_turnover
ORDER BY total_amount DESC;"
52;A;-1;ChatGPT5.2;3;4;"SELECT customer_id, total_amount,
       NTILE(4) OVER (ORDER BY total_amount DESC) AS quartile
FROM (
  SELECT customer_id, SUM(quantity*unit_price) AS total_amount
  FROM retail
  WHERE customer_id IS NOT NULL AND quantity<>0
  GROUP BY customer_id
)
ORDER BY total_amount DESC;"
53;B;-1;ChatGPT5.2;0;4;"SELECT
    year,
    name,
    global_sales,
    NTILE(4) OVER (
        PARTITION BY year
        ORDER BY global_sales DESC
    ) AS sales_quartile
FROM games
WHERE year IS NOT NULL
ORDER BY year DESC, sales_quartile;"
54;B;-1;ChatGPT5.2;1;4;"SELECT
    year,
    name,
    global_sales,
    NTILE(4) OVER (
        PARTITION BY year
        ORDER BY global_sales DESC
    ) AS sales_quartile
FROM games
WHERE year IS NOT NULL
ORDER BY year DESC, sales_quartile;"
55;B;-1;ChatGPT5.2;2;4;"WITH games_with_quartiles AS (
    SELECT
        year,
        name,
        global_sales,
        NTILE(4) OVER (
            PARTITION BY year
            ORDER BY global_sales DESC
        ) AS sales_quartile
    FROM games
    WHERE year IS NOT NULL
)
SELECT
    year,
    name,
    global_sales,
    sales_quartile
FROM games_with_quartiles
ORDER BY year DESC, sales_quartile;"
56;B;-1;ChatGPT5.2;3;4;"SELECT year, name, global_sales,
       NTILE(4) OVER (PARTITION BY year ORDER BY global_sales DESC) sales_quartile
FROM games
WHERE year IS NOT NULL
ORDER BY year DESC, sales_quartile;"
57;C;-1;ChatGPT5.2;0;4;"WITH category_revenue AS (
    SELECT
        category,
        SUM(price) AS total_revenue
    FROM eshop
    GROUP BY category
)
SELECT
    category,
    total_revenue,
    NTILE(4) OVER (ORDER BY total_revenue DESC) AS revenue_quartile
FROM category_revenue
ORDER BY revenue_quartile;"
58;C;-1;ChatGPT5.2;1;4;"WITH category_sales AS (
    SELECT
        category,
        SUM(price) AS total_revenue
    FROM eshop
    GROUP BY category
)
SELECT
    category,
    total_revenue,
    NTILE(4) OVER (ORDER BY total_revenue DESC) AS revenue_quartile
FROM category_sales
ORDER BY revenue_quartile;"
59;C;-1;ChatGPT5.2;2;4;"WITH category_revenue AS (
    SELECT
        category,
        SUM(price) AS total_price
    FROM eshop
    GROUP BY category
)
SELECT
    category,
    total_price,
    NTILE(4) OVER (ORDER BY total_price DESC) AS revenue_quartile
FROM category_revenue
ORDER BY revenue_quartile;"
60;C;-1;ChatGPT5.2;3;4;"SELECT category, total_price,
       NTILE(4) OVER (ORDER BY total_price DESC) quartile
FROM (
  SELECT category, SUM(price) total_price FROM eshop GROUP BY category
)
ORDER BY quartile;"
61;D;-1;ChatGPT5.2;0;4;"WITH state_revenue AS (
    SELECT
        ship_state,
        SUM(amount) AS total_amount
    FROM sales
    GROUP BY ship_state
)
SELECT
    ship_state,
    total_amount,
    NTILE(4) OVER (ORDER BY total_amount DESC) AS revenue_quartile
FROM state_revenue;"
62;D;-1;ChatGPT5.2;1;4;"WITH state_revenue AS (
    SELECT
        ship_state,
        SUM(amount) AS total_amount
    FROM sales
    GROUP BY ship_state
)
SELECT
    ship_state,
    total_amount,
    NTILE(4) OVER (ORDER BY total_amount DESC) AS revenue_quartile
FROM state_revenue;"
63;D;-1;ChatGPT5.2;2;4;"WITH ship_state_revenue AS (
    SELECT
        ship_state,
        SUM(amount) AS total_amount
    FROM sales
    GROUP BY ship_state
)
SELECT
    ship_state,
    total_amount,
    NTILE(4) OVER (ORDER BY total_amount DESC) AS revenue_quartile
FROM ship_state_revenue
ORDER BY revenue_quartile;"
64;D;-1;ChatGPT5.2;3;4;"SELECT ship_state, total_amount,
       NTILE(4) OVER (ORDER BY total_amount DESC) quartile
FROM (
  SELECT ship_state, SUM(amount) total_amount FROM sales GROUP BY ship_state
);"
65;A;-1;ChatGPT5.2;0;5;"SELECT
    customer_id,
    invoice_no,
    invoice_date,
    stock_code,
    description,
    quantity,
    unit_price,
    country
FROM (
    SELECT
        *,
        ROW_NUMBER() OVER (
            PARTITION BY customer_id
            ORDER BY invoice_date
        ) AS rn
    FROM retail
    WHERE customer_id IS NOT NULL
      AND quantity <> 0
)
WHERE rn = 1
ORDER BY customer_id;"
66;A;-1;ChatGPT5.2;1;5;"WITH ranked_purchases AS (
    SELECT
        customer_id,
        invoice_no,
        invoice_date,
        stock_code,
        description,
        quantity,
        unit_price,
        country,
        ROW_NUMBER() OVER (
            PARTITION BY customer_id
            ORDER BY invoice_date
        ) AS rn
    FROM retail
    WHERE customer_id IS NOT NULL
      AND quantity <> 0
)
SELECT
    customer_id,
    invoice_no,
    invoice_date,
    stock_code,
    description,
    quantity,
    unit_price,
    country
FROM ranked_purchases
WHERE rn = 1
ORDER BY customer_id;"
67;A;-1;ChatGPT5.2;2;5;"WITH ranked_purchases AS (
    SELECT
        customer_id,
        invoice_no,
        invoice_date,
        stock_code,
        description,
        quantity,
        unit_price,
        country,
        ROW_NUMBER() OVER (
            PARTITION BY customer_id
            ORDER BY invoice_date
        ) AS purchase_rank
    FROM retail
    WHERE customer_id IS NOT NULL
      AND quantity <> 0
)
SELECT
    customer_id,
    invoice_no,
    invoice_date,
    stock_code,
    description,
    quantity,
    unit_price,
    country
FROM ranked_purchases
WHERE purchase_rank = 1
ORDER BY customer_id;"
68;A;-1;ChatGPT5.2;3;5;"SELECT customer_id, invoice_no, invoice_date, stock_code, description, quantity, unit_price, country
FROM (
  SELECT *, ROW_NUMBER() OVER (PARTITION BY customer_id ORDER BY invoice_date) rn
  FROM retail
  WHERE customer_id IS NOT NULL AND quantity<>0
)
WHERE rn=1
ORDER BY customer_id;"
69;B;-1;ChatGPT5.2;0;5;"SELECT
    publisher,
    year,
    ranking,
    name,
    eu_sales
FROM (
    SELECT
        publisher,
        year,
        name,
        eu_sales,
        ROW_NUMBER() OVER (
            PARTITION BY publisher, year
            ORDER BY eu_sales DESC
        ) AS ranking
    FROM games
    WHERE year IS NOT NULL
)
WHERE ranking <= 3
ORDER BY publisher, year, ranking;"
70;B;-1;ChatGPT5.2;1;5;"SELECT
    publisher,
    year,
    ranking,
    name,
    eu_sales
FROM (
    SELECT
        publisher,
        year,
        name,
        eu_sales,
        ROW_NUMBER() OVER (
            PARTITION BY publisher, year
            ORDER BY eu_sales DESC
        ) AS ranking
    FROM games
    WHERE year IS NOT NULL
)
WHERE ranking <= 3
ORDER BY publisher, year, ranking;"
71;B;-1;ChatGPT5.2;2;5;"WITH ranked_eu_sales AS (
    SELECT
        publisher,
        year,
        name,
        eu_sales,
        ROW_NUMBER() OVER (
            PARTITION BY publisher, year
            ORDER BY eu_sales DESC
        ) AS ranking
    FROM games
    WHERE year IS NOT NULL
)
SELECT
    publisher,
    year,
    ranking,
    name,
    eu_sales
FROM ranked_eu_sales
WHERE ranking <= 3
ORDER BY publisher, year, ranking;"
72;B;-1;ChatGPT5.2;3;5;"SELECT publisher, year, ranking, name, eu_sales
FROM (
  SELECT publisher, year, name, eu_sales,
         ROW_NUMBER() OVER (PARTITION BY publisher, year ORDER BY eu_sales DESC) ranking
  FROM games
  WHERE year IS NOT NULL
)
WHERE ranking <= 3
ORDER BY publisher, year, ranking;"
73;C;-1;ChatGPT5.2;0;5;"WITH model_revenue AS (
    SELECT
        country,
        clothing_model,
        SUM(price) AS total_revenue
    FROM eshop
    GROUP BY country, clothing_model
),
ranked_models AS (
    SELECT
        country,
        clothing_model,
        total_revenue,
        ROW_NUMBER() OVER (
            PARTITION BY country
            ORDER BY total_revenue DESC
        ) AS ranking
    FROM model_revenue
)
SELECT
    country,
    ranking,
    clothing_model,
    total_revenue
FROM ranked_models
WHERE ranking <= 3
ORDER BY country, ranking;
"
74;C;-1;ChatGPT5.2;1;5;"WITH model_sales AS (
    SELECT
        country,
        clothing_model,
        SUM(price) AS total_revenue
    FROM eshop
    GROUP BY country, clothing_model
),
ranked_models AS (
    SELECT
        country,
        clothing_model,
        total_revenue,
        ROW_NUMBER() OVER (
            PARTITION BY country
            ORDER BY total_revenue DESC
        ) AS ranking
    FROM model_sales
)
SELECT
    country,
    ranking,
    clothing_model,
    total_revenue
FROM ranked_models
WHERE ranking <= 3
ORDER BY country, ranking;"
75;C;-1;ChatGPT5.2;2;5;"WITH model_revenue AS (
    SELECT
        country,
        clothing_model,
        SUM(price) AS total_price
    FROM eshop
    GROUP BY country, clothing_model
),
ranked_models AS (
    SELECT
        country,
        clothing_model,
        total_price,
        ROW_NUMBER() OVER (
            PARTITION BY country
            ORDER BY total_price DESC
        ) AS ranking
    FROM model_revenue
)
SELECT
    country,
    ranking,
    clothing_model,
    total_price
FROM ranked_models
WHERE ranking <= 3
ORDER BY country, ranking;"
76;C;-1;ChatGPT5.2;3;5;"SELECT country, ranking, clothing_model, total_price
FROM (
  SELECT country, clothing_model, SUM(price) total_price,
         ROW_NUMBER() OVER (PARTITION BY country ORDER BY SUM(price) DESC) ranking
  FROM eshop GROUP BY country, clothing_model
)
WHERE ranking<=3
ORDER BY country, ranking;"
77;D;-1;ChatGPT5.2;0;5;"WITH product_revenue AS (
    SELECT
        ship_state,
        product,
        SUM(amount) AS total_amount
    FROM sales
    WHERE amount IS NOT NULL
    GROUP BY ship_state, product
),
ranked_products AS (
    SELECT
        ship_state,
        product,
        total_amount,
        ROW_NUMBER() OVER (
            PARTITION BY ship_state
            ORDER BY total_amount DESC
        ) AS ranking
    FROM product_revenue
)
SELECT
    ship_state,
    ranking,
    product,
    total_amount
FROM ranked_products
WHERE ranking <= 5
ORDER BY ship_state, ranking;"
78;D;-1;ChatGPT5.2;1;5;"WITH product_revenue AS (
    SELECT
        ship_state,
        product,
        SUM(amount) AS total_amount
    FROM sales
    WHERE amount IS NOT NULL
    GROUP BY ship_state, product
),
ranked_products AS (
    SELECT
        ship_state,
        product,
        total_amount,
        ROW_NUMBER() OVER (
            PARTITION BY ship_state
            ORDER BY total_amount DESC
        ) AS ranking
    FROM product_revenue
)
SELECT
    ship_state,
    ranking,
    product,
    total_amount
FROM ranked_products
WHERE ranking <= 5
ORDER BY ship_state, ranking;"
79;D;-1;ChatGPT5.2;2;5;"WITH product_revenue AS (
    SELECT
        ship_state,
        product,
        SUM(amount) AS total_amount
    FROM sales
    WHERE amount IS NOT NULL
    GROUP BY ship_state, product
),
ranked_products AS (
    SELECT
        ship_state,
        product,
        total_amount,
        ROW_NUMBER() OVER (
            PARTITION BY ship_state
            ORDER BY total_amount DESC
        ) AS product_rank
    FROM product_revenue
)
SELECT
    ship_state,
    product_rank,
    product,
    total_amount
FROM ranked_products
WHERE product_rank <= 5
ORDER BY ship_state, product_rank;"
80;D;-1;ChatGPT5.2;3;5;"SELECT ship_state, ranking, product, total_amount
FROM (
  SELECT ship_state, product, SUM(amount) total_amount,
         ROW_NUMBER() OVER (PARTITION BY ship_state ORDER BY SUM(amount) DESC) ranking
  FROM sales WHERE amount IS NOT NULL
  GROUP BY ship_state, product
)
WHERE ranking<=5
ORDER BY ship_state, ranking;"
81;A;-1;ChatGPT5.2;0;6;"SELECT
    country,
    invoice_month,
    ranking,
    customer_id,
    monthly_amount
FROM (
    SELECT
        country,
        DATE_TRUNC('MONTH', invoice_date) AS invoice_month,
        customer_id,
        SUM(quantity * unit_price) AS monthly_amount,
        ROW_NUMBER() OVER (
            PARTITION BY country, DATE_TRUNC('MONTH', invoice_date)
            ORDER BY SUM(quantity * unit_price) DESC
        ) AS ranking
    FROM retail
    WHERE customer_id IS NOT NULL
      AND quantity <> 0
    GROUP BY country, invoice_month, customer_id
)
WHERE ranking <= 5
ORDER BY country, invoice_month, ranking, customer_id;"
82;A;-1;ChatGPT5.2;1;6;"WITH monthly_sales AS (
    SELECT
        country,
        DATE_TRUNC('MONTH', invoice_date) AS invoice_month,
        customer_id,
        SUM(quantity * unit_price) AS monthly_amount
    FROM retail
    WHERE customer_id IS NOT NULL
      AND quantity <> 0
    GROUP BY country, invoice_month, customer_id
),
ranked_customers AS (
    SELECT
        country,
        invoice_month,
        customer_id,
        monthly_amount,
        ROW_NUMBER() OVER (
            PARTITION BY country, invoice_month
            ORDER BY monthly_amount DESC
        ) AS ranking
    FROM monthly_sales
)
SELECT
    country,
    invoice_month,
    ranking,
    customer_id,
    monthly_amount
FROM ranked_customers
WHERE ranking <= 5
ORDER BY country, invoice_month, ranking, customer_id;"
83;A;-1;ChatGPT5.2;2;6;"WITH monthly_turnover AS (
    SELECT
        country,
        DATE_TRUNC('MONTH', invoice_date) AS invoice_month,
        customer_id,
        SUM(quantity * unit_price) AS monthly_amount
    FROM retail
    WHERE customer_id IS NOT NULL
      AND quantity <> 0
    GROUP BY country, invoice_month, customer_id
),
ranked_customers AS (
    SELECT
        country,
        invoice_month,
        customer_id,
        monthly_amount,
        ROW_NUMBER() OVER (
            PARTITION BY country, invoice_month
            ORDER BY monthly_amount DESC
        ) AS customer_rank
    FROM monthly_turnover
)
SELECT
    country,
    invoice_month,
    customer_rank,
    customer_id,
    monthly_amount
FROM ranked_customers
WHERE customer_rank <= 5
ORDER BY country, invoice_month, customer_rank, customer_id;"
84;A;-1;ChatGPT5.2;3;6;"SELECT country, invoice_month, ranking, customer_id, monthly_amount
FROM (
  SELECT country, DATE_TRUNC('MONTH',invoice_date) invoice_month, customer_id,
         SUM(quantity*unit_price) monthly_amount,
         ROW_NUMBER() OVER (
           PARTITION BY country, DATE_TRUNC('MONTH',invoice_date)
           ORDER BY SUM(quantity*unit_price) DESC
         ) ranking
  FROM retail
  WHERE customer_id IS NOT NULL AND quantity<>0
  GROUP BY country, invoice_month, customer_id
)
WHERE ranking<=5
ORDER BY country, invoice_month, ranking, customer_id;"
85;B;-1;ChatGPT5.2;0;6;"SELECT
    genre,
    year,
    total_na_sales
FROM (
    SELECT
        genre,
        year,
        SUM(na_sales) AS total_na_sales,
        ROW_NUMBER() OVER (
            PARTITION BY genre
            ORDER BY SUM(na_sales) DESC
        ) AS ranking
    FROM games
    WHERE year IS NOT NULL
    GROUP BY genre, year
)
WHERE ranking <= 3
ORDER BY genre, ranking;"
86;B;-1;ChatGPT5.2;1;6;"SELECT
    genre,
    year,
    total_na_sales
FROM (
    SELECT
        genre,
        year,
        SUM(na_sales) AS total_na_sales,
        ROW_NUMBER() OVER (
            PARTITION BY genre
            ORDER BY SUM(na_sales) DESC
        ) AS ranking
    FROM games
    WHERE year IS NOT NULL
    GROUP BY genre, year
)
WHERE ranking <= 3
ORDER BY genre, ranking;"
87;B;-1;ChatGPT5.2;2;6;"WITH yearly_na_sales AS (
    SELECT
        genre,
        year,
        SUM(na_sales) AS total_na_sales
    FROM games
    WHERE year IS NOT NULL
    GROUP BY genre, year
),
ranked_years AS (
    SELECT
        genre,
        year,
        total_na_sales,
        ROW_NUMBER() OVER (
            PARTITION BY genre
            ORDER BY total_na_sales DESC
        ) AS ranking
    FROM yearly_na_sales
)
SELECT
    genre,
    year,
    total_na_sales
FROM ranked_years
WHERE ranking <= 3
ORDER BY genre, ranking;"
88;B;-1;ChatGPT5.2;3;6;"SELECT genre, year, total_na_sales
FROM (
  SELECT genre, year, SUM(na_sales) total_na_sales,
         ROW_NUMBER() OVER (PARTITION BY genre ORDER BY SUM(na_sales) DESC) ranking
  FROM games
  WHERE year IS NOT NULL
  GROUP BY genre, year
)
WHERE ranking <= 3
ORDER BY genre, ranking;"
89;C;-1;ChatGPT5.2;0;6;"WITH daily_category_sales AS (
    SELECT
        country,
        DATE_FROM_PARTS(year, month, day) AS sales_date,
        category,
        SUM(price) AS total_revenue
    FROM eshop
    GROUP BY country, sales_date, category
),
ranked_categories AS (
    SELECT
        country,
        sales_date,
        category,
        total_revenue,
        RANK() OVER (
            PARTITION BY country, sales_date
            ORDER BY total_revenue DESC
        ) AS ranking
    FROM daily_category_sales
)
SELECT
    country,
    sales_date,
    ranking,
    category,
    total_revenue
FROM ranked_categories
WHERE ranking <= 3
ORDER BY country, sales_date, ranking;"
90;C;-1;ChatGPT5.2;1;6;"WITH daily_category_sales AS (
    SELECT
        country,
        DATE_FROM_PARTS(year, month, day) AS sales_date,
        category,
        SUM(price) AS total_revenue
    FROM eshop
    GROUP BY country, sales_date, category
),
ranked_categories AS (
    SELECT
        country,
        sales_date,
        category,
        total_revenue,
        RANK() OVER (
            PARTITION BY country, sales_date
            ORDER BY total_revenue DESC
        ) AS ranking
    FROM daily_category_sales
)
SELECT
    country,
    sales_date,
    ranking,
    category,
    total_revenue
FROM ranked_categories
WHERE ranking <= 3
ORDER BY country, sales_date, ranking;"
91;C;-1;ChatGPT5.2;2;6;"WITH daily_category_revenue AS (
    SELECT
        country,
        DATE_FROM_PARTS(year, month, day) AS sales_date,
        category,
        SUM(price) AS total_price
    FROM eshop
    GROUP BY country, sales_date, category
),
ranked_categories AS (
    SELECT
        country,
        sales_date,
        category,
        total_price,
        RANK() OVER (
            PARTITION BY country, sales_date
            ORDER BY total_price DESC
        ) AS ranking
    FROM daily_category_revenue
)
SELECT
    country,
    sales_date,
    ranking,
    category,
    total_price
FROM ranked_categories
WHERE ranking <= 3
ORDER BY country, sales_date, ranking;"
92;C;-1;ChatGPT5.2;3;6;"SELECT country, d, ranking, category, total_price
FROM (
  SELECT country, DATE_FROM_PARTS(year,month,day) d, category, SUM(price) total_price,
         RANK() OVER (PARTITION BY country, DATE_FROM_PARTS(year,month,day) ORDER BY SUM(price) DESC) ranking
  FROM eshop GROUP BY country, d, category
)
WHERE ranking<=3
ORDER BY country, d, ranking;"
93;D;-1;ChatGPT5.2;0;6;"WITH daily_state_revenue AS (
    SELECT
        order_date,
        ship_state,
        SUM(amount) AS total_amount
    FROM sales
    GROUP BY order_date, ship_state
),
ranked_states AS (
    SELECT
        order_date,
        ship_state,
        total_amount,
        RANK() OVER (
            PARTITION BY order_date
            ORDER BY total_amount DESC
        ) AS ranking
    FROM daily_state_revenue
)
SELECT
    order_date,
    ranking,
    ship_state,
    total_amount
FROM ranked_states
WHERE ranking <= 3
ORDER BY order_date, ranking;"
94;D;-1;ChatGPT5.2;1;6;"WITH daily_state_sales AS (
    SELECT
        order_date,
        ship_state,
        SUM(amount) AS total_amount
    FROM sales
    GROUP BY order_date, ship_state
),
ranked_states AS (
    SELECT
        order_date,
        ship_state,
        total_amount,
        RANK() OVER (
            PARTITION BY order_date
            ORDER BY total_amount DESC
        ) AS ranking
    FROM daily_state_sales
)
SELECT
    order_date,
    ranking,
    ship_state,
    total_amount
FROM ranked_states
WHERE ranking <= 3
ORDER BY order_date, ranking;"
95;D;-1;ChatGPT5.2;2;6;"WITH daily_state_revenue AS (
    SELECT
        order_date,
        ship_state,
        SUM(amount) AS total_amount
    FROM sales
    GROUP BY order_date, ship_state
),
ranked_states AS (
    SELECT
        order_date,
        ship_state,
        total_amount,
        RANK() OVER (
            PARTITION BY order_date
            ORDER BY total_amount DESC
        ) AS state_rank
    FROM daily_state_revenue
)
SELECT
    order_date,
    state_rank,
    ship_state,
    total_amount
FROM ranked_states
WHERE state_rank <= 3
ORDER BY order_date, state_rank;"
96;D;-1;ChatGPT5.2;3;6;"SELECT order_date, ranking, ship_state, total_amount
FROM (
  SELECT order_date, ship_state, SUM(amount) total_amount,
         RANK() OVER (PARTITION BY order_date ORDER BY SUM(amount) DESC) ranking
  FROM sales GROUP BY order_date, ship_state
)
WHERE ranking<=3
ORDER BY order_date, ranking;"
97;A;-1;ChatGPT5.2;0;7;"CREATE OR REPLACE TABLE cities_pop (
    data VARIANT
);

CREATE OR REPLACE FILE FORMAT cities_json_ff
    TYPE = JSON;

COPY INTO cities_pop
FROM @~/cities_population.json
FILE_FORMAT = cities_json_ff
ON_ERROR = CONTINUE;"
98;A;-1;ChatGPT5.2;1;7;"CREATE OR REPLACE TABLE cities_pop (
    data VARIANT
);

CREATE OR REPLACE FILE FORMAT cities_json_format
    TYPE = JSON;

COPY INTO cities_pop
FROM @~/cities_population.json
FILE_FORMAT = cities_json_format
ON_ERROR = CONTINUE;"
99;A;-1;ChatGPT5.2;2;7;"CREATE OR REPLACE TABLE cities_pop (
    data VARIANT
);

CREATE OR REPLACE FILE FORMAT cities_json_format
    TYPE = JSON;

COPY INTO cities_pop
FROM @~/cities_population.json
FILE_FORMAT = cities_json_format
ON_ERROR = CONTINUE;"
100;A;-1;ChatGPT5.2;3;7;"CREATE OR REPLACE TABLE cities_pop (data VARIANT);
CREATE OR REPLACE FILE FORMAT ff_json TYPE=JSON;
COPY INTO cities_pop FROM @~/cities_population.json FILE_FORMAT=ff_json ON_ERROR=CONTINUE;"
101;B;-1;ChatGPT5.2;0;7;"CREATE OR REPLACE TABLE house_price (
    data VARIANT
);

CREATE OR REPLACE FILE FORMAT house_parquet_ff
    TYPE = PARQUET;

COPY INTO house_price
FROM @~/house_price.json
FILE_FORMAT = house_parquet_ff
ON_ERROR = CONTINUE;"
102;B;-1;ChatGPT5.2;1;7;"CREATE OR REPLACE TABLE house_price (
    data VARIANT
);

CREATE OR REPLACE FILE FORMAT house_parquet_format
    TYPE = PARQUET;

COPY INTO house_price
FROM @~/house_price.json
FILE_FORMAT = house_parquet_format
ON_ERROR = CONTINUE;"
103;B;-1;ChatGPT5.2;2;7;"CREATE OR REPLACE TABLE house_price (
    data VARIANT
);

CREATE OR REPLACE FILE FORMAT house_parquet_format
    TYPE = PARQUET;

COPY INTO house_price
FROM @~/house_price.json
FILE_FORMAT = house_parquet_format
ON_ERROR = CONTINUE;"
104;B;-1;ChatGPT5.2;3;7;"CREATE OR REPLACE TABLE house_price (data VARIANT);
CREATE OR REPLACE FILE FORMAT ff_house TYPE=PARQUET;
COPY INTO house_price FROM @~/house_price.json FILE_FORMAT=ff_house ON_ERROR=CONTINUE;"
105;C;-1;ChatGPT5.2;0;7;"CREATE OR REPLACE TABLE forbes (
    data VARIANT
);

CREATE OR REPLACE FILE FORMAT forbes_json_ff
    TYPE = JSON;

COPY INTO forbes
FROM @~/forbes.json
FILE_FORMAT = forbes_json_ff
ON_ERROR = CONTINUE;"
106;C;-1;ChatGPT5.2;1;7;"CREATE OR REPLACE TABLE forbes (
    data VARIANT
);

CREATE OR REPLACE FILE FORMAT forbes_json_format
    TYPE = JSON;

COPY INTO forbes
FROM @~/forbes.json
FILE_FORMAT = forbes_json_format
ON_ERROR = CONTINUE;"
107;C;-1;ChatGPT5.2;2;7;"CREATE OR REPLACE TABLE forbes (
    data VARIANT
);

CREATE OR REPLACE FILE FORMAT forbes_json_format
    TYPE = JSON;

COPY INTO forbes
FROM @~/forbes.json
FILE_FORMAT = forbes_json_format
ON_ERROR = CONTINUE;"
108;C;-1;ChatGPT5.2;3;7;"CREATE OR REPLACE TABLE forbes (data VARIANT);
CREATE OR REPLACE FILE FORMAT ff_forbes TYPE=JSON;
COPY INTO forbes FROM @~/forbes.json FILE_FORMAT=ff_forbes ON_ERROR=CONTINUE;"
109;D;-1;ChatGPT5.2;0;7;"CREATE OR REPLACE TABLE weather (
    data VARIANT
);

CREATE OR REPLACE FILE FORMAT weather_parquet_format
    TYPE = PARQUET;

COPY INTO weather
FROM @~/weather.json
FILE_FORMAT = weather_parquet_format
ON_ERROR = CONTINUE;"
110;D;-1;ChatGPT5.2;1;7;"CREATE OR REPLACE TABLE weather (
    data VARIANT
);

CREATE OR REPLACE FILE FORMAT weather_parquet_format
    TYPE = PARQUET;

COPY INTO weather
FROM @~/weather.json
FILE_FORMAT = weather_parquet_format
ON_ERROR = CONTINUE;"
111;D;-1;ChatGPT5.2;2;7;"CREATE OR REPLACE TABLE weather (
    data VARIANT
);

CREATE OR REPLACE FILE FORMAT weather_parquet_format
    TYPE = PARQUET;

COPY INTO weather
FROM @~/weather.json
FILE_FORMAT = weather_parquet_format
ON_ERROR = CONTINUE;"
112;D;-1;ChatGPT5.2;3;7;"CREATE OR REPLACE TABLE weather (data VARIANT);
CREATE OR REPLACE FILE FORMAT ff_weather TYPE=PARQUET;
COPY INTO weather FROM @~/weather.json FILE_FORMAT=ff_weather ON_ERROR=CONTINUE;"
113;A;-1;ChatGPT5.2;0;8;"SELECT
    city.value:name::STRING AS city_name,
    city.value:rank::INTEGER AS rank
FROM cities_pop,
     LATERAL FLATTEN(input => data:cities) city
WHERE data:country::STRING = 'India'
ORDER BY rank;"
114;A;-1;ChatGPT5.2;1;8;"SELECT
    city.value:name::STRING AS city_name,
    city.value:rank::INTEGER AS rank
FROM cities_pop,
     LATERAL FLATTEN(input => data:cities) city
WHERE data:country::STRING = 'India'
ORDER BY rank;"
115;A;-1;ChatGPT5.2;2;8;"WITH flattened_cities AS (
    SELECT
        data:country::STRING AS country,
        city.value:name::STRING AS city_name,
        city.value:rank::INTEGER AS city_rank
    FROM cities_pop,
         LATERAL FLATTEN(input => data:cities) city
)
SELECT
    city_name,
    city_rank
FROM flattened_cities
WHERE country = 'India'
ORDER BY city_rank;"
116;A;-1;ChatGPT5.2;3;8;"SELECT c.value:name::STRING city, c.value:rank::INT rank
FROM cities_pop, LATERAL FLATTEN(input=>data:cities) c
WHERE data:country::STRING='India'
ORDER BY rank;"
117;B;-1;ChatGPT5.2;0;8;"SELECT
    AVG(data:price::NUMBER) AS avg_price,
    MEDIAN(data:price::NUMBER) AS median_price
FROM house_price
WHERE data:price IS NOT NULL;"
118;B;-1;ChatGPT5.2;1;8;"SELECT
    AVG(data:price::NUMBER) AS avg_price,
    MEDIAN(data:price::NUMBER) AS median_price
FROM house_price
WHERE data:price IS NOT NULL;"
119;B;-1;ChatGPT5.2;2;8;"SELECT
    AVG(data:price::NUMBER)    AS avg_price,
    MEDIAN(data:price::NUMBER) AS median_price
FROM house_price
WHERE data:price IS NOT NULL;"
120;B;-1;ChatGPT5.2;3;8;"SELECT AVG(data:price::NUMBER) avg_price, MEDIAN(data:price::NUMBER) median_price
FROM house_price
WHERE data:price IS NOT NULL;"
121;C;-1;ChatGPT5.2;0;8;"SELECT
    data:name::STRING AS name,
    data:current_worth::NUMBER AS current_worth
FROM forbes
WHERE data:country::STRING = 'United States'
ORDER BY current_worth DESC;"
122;C;-1;ChatGPT5.2;1;8;"SELECT
    data:name::STRING AS name,
    data:current_worth::NUMBER AS current_worth
FROM forbes
WHERE data:country::STRING = 'United States'
ORDER BY current_worth DESC;"
123;C;-1;ChatGPT5.2;2;8;"SELECT
    data:name::STRING AS name,
    data:current_worth::NUMBER AS current_worth
FROM forbes
WHERE data:country::STRING = 'United States'
ORDER BY current_worth DESC;"
124;C;-1;ChatGPT5.2;3;8;"SELECT data:name::STRING name, data:current_worth::NUMBER current_worth
FROM forbes
WHERE data:country::STRING='United States'
ORDER BY current_worth DESC;"
125;D;-1;ChatGPT5.2;0;8;"SELECT
    AVG(data:MaxTemp::NUMBER)    AS avg_max_temp,
    MEDIAN(data:MaxTemp::NUMBER) AS median_max_temp,
    AVG(data:MinTemp::NUMBER)    AS avg_min_temp,
    MEDIAN(data:MinTemp::NUMBER) AS median_min_temp
FROM weather
WHERE data:MaxTemp IS NOT NULL
  AND data:MinTemp IS NOT NULL;"
126;D;-1;ChatGPT5.2;1;8;"SELECT
    AVG(data:MaxTemp::NUMBER)    AS avg_max_temp,
    MEDIAN(data:MaxTemp::NUMBER) AS median_max_temp,
    AVG(data:MinTemp::NUMBER)    AS avg_min_temp,
    MEDIAN(data:MinTemp::NUMBER) AS median_min_temp
FROM weather
WHERE data:MaxTemp IS NOT NULL
  AND data:MinTemp IS NOT NULL;"
127;D;-1;ChatGPT5.2;2;8;"SELECT
    AVG(data:MaxTemp::NUMBER)    AS avg_max_temp,
    MEDIAN(data:MaxTemp::NUMBER) AS median_max_temp,
    AVG(data:MinTemp::NUMBER)    AS avg_min_temp,
    MEDIAN(data:MinTemp::NUMBER) AS median_min_temp
FROM weather
WHERE data:MaxTemp IS NOT NULL
  AND data:MinTemp IS NOT NULL;"
128;D;-1;ChatGPT5.2;3;8;"SELECT
  AVG(data:MaxTemp::NUMBER) avg_max, MEDIAN(data:MaxTemp::NUMBER) med_max,
  AVG(data:MinTemp::NUMBER) avg_min, MEDIAN(data:MinTemp::NUMBER) med_min
FROM weather
WHERE data:MaxTemp IS NOT NULL AND data:MinTemp IS NOT NULL;"
129;A;-1;ChatGPT5.2;0;9;"SELECT
    data:country::STRING AS country,
    COUNT(*) AS city_count
FROM cities_pop,
     LATERAL FLATTEN(input => data:cities)
GROUP BY country
ORDER BY city_count;"
130;A;-1;ChatGPT5.2;1;9;"SELECT
    data:country::STRING AS country,
    COUNT(city.value) AS city_count
FROM cities_pop,
     LATERAL FLATTEN(input => data:cities) city
GROUP BY country
ORDER BY city_count;"
131;A;-1;ChatGPT5.2;2;9;"WITH flattened_cities AS (
    SELECT
        data:country::STRING AS country,
        city.value:name::STRING AS city_name
    FROM cities_pop,
         LATERAL FLATTEN(input => data:cities) city
)
SELECT
    country,
    COUNT(city_name) AS city_count
FROM flattened_cities
GROUP BY country
ORDER BY city_count;"
132;A;-1;ChatGPT5.2;3;9;"SELECT data:country::STRING country, COUNT(*) city_count
FROM cities_pop, LATERAL FLATTEN(input=>data:cities)
GROUP BY country
ORDER BY city_count;"
133;B;-1;ChatGPT5.2;0;9;"SELECT
    data:furnishingstatus::STRING AS furnishing_status,
    COUNT(*) AS house_count,
    AVG(data:price::NUMBER) AS avg_price
FROM house_price
WHERE data:price IS NOT NULL
GROUP BY furnishing_status
ORDER BY furnishing_status;"
134;B;-1;ChatGPT5.2;1;9;"SELECT
    data:furnishingstatus::STRING AS furnishingstatus,
    COUNT(*) AS house_count,
    AVG(data:price::NUMBER) AS avg_price
FROM house_price
WHERE data:price IS NOT NULL
GROUP BY furnishingstatus
ORDER BY furnishingstatus;"
135;B;-1;ChatGPT5.2;2;9;"SELECT
    data:furnishingstatus::STRING AS furnishingstatus,
    COUNT(*) AS house_count,
    AVG(data:price::NUMBER) AS avg_price
FROM house_price
WHERE data:price IS NOT NULL
GROUP BY furnishingstatus
ORDER BY furnishingstatus;"
136;B;-1;ChatGPT5.2;3;9;"SELECT data:furnishingstatus::STRING furnishingstatus,
       COUNT(*) house_count,
       AVG(data:price::NUMBER) avg_price
FROM house_price
WHERE data:price IS NOT NULL
GROUP BY furnishingstatus
ORDER BY furnishingstatus;"
137;C;-1;ChatGPT5.2;0;9;"SELECT
    data:name::STRING AS name,
    data:current_worth::NUMBER AS current_worth,
    ARRAY_SIZE(data:industries) AS industry_count
FROM forbes
ORDER BY current_worth DESC;"
138;C;-1;ChatGPT5.2;1;9;"SELECT
    data:name::STRING AS name,
    data:current_worth::NUMBER AS current_worth,
    ARRAY_SIZE(data:industries) AS industry_count
FROM forbes
ORDER BY current_worth DESC;"
139;C;-1;ChatGPT5.2;2;9;"SELECT
    data:name::STRING AS name,
    data:current_worth::NUMBER AS current_worth,
    ARRAY_SIZE(data:industries) AS industry_count
FROM forbes
ORDER BY current_worth DESC;"
140;C;-1;ChatGPT5.2;3;9;"SELECT data:name::STRING name, data:current_worth::NUMBER current_worth,
       ARRAY_SIZE(data:industries) industry_count
FROM forbes
ORDER BY current_worth DESC;"
141;D;-1;ChatGPT5.2;0;9;"SELECT
    data:WindGustDir::STRING AS wind_direction,
    AVG(data:Rainfall::NUMBER) AS avg_rainfall
FROM weather
WHERE data:Rainfall IS NOT NULL
GROUP BY wind_direction
ORDER BY avg_rainfall;
"
142;D;-1;ChatGPT5.2;1;9;"SELECT
    data:WindGustDir::STRING AS wind_direction,
    AVG(data:Rainfall::NUMBER) AS avg_rainfall
FROM weather
WHERE data:Rainfall IS NOT NULL
GROUP BY wind_direction
ORDER BY avg_rainfall;"
143;D;-1;ChatGPT5.2;2;9;"SELECT
    data:WindGustDir::STRING AS wind_gust_dir,
    AVG(data:Rainfall::NUMBER) AS avg_rainfall
FROM weather
WHERE data:Rainfall IS NOT NULL
GROUP BY wind_gust_dir
ORDER BY avg_rainfall;"
144;D;-1;ChatGPT5.2;3;9;"SELECT data:WindGustDir::STRING wind_dir, AVG(data:Rainfall::NUMBER) avg_rainfall
FROM weather
WHERE data:Rainfall IS NOT NULL
GROUP BY wind_dir
ORDER BY avg_rainfall;"
145;A;-1;ChatGPT5.2;0;10;"SELECT
    city.value:name::STRING AS city_name,
    SUM(district.value:area_km2:area_km2::NUMBER) AS total_area_km2
FROM cities_pop,
     LATERAL FLATTEN(input => data:cities) city,
     LATERAL FLATTEN(input => city.value:districts) district
GROUP BY city_name
ORDER BY total_area_km2 DESC;"
146;A;-1;ChatGPT5.2;1;10;"SELECT
    city.value:name::STRING AS city_name,
    SUM(district.value:area_km2:area_km2::NUMBER) AS total_area_km2
FROM cities_pop,
     LATERAL FLATTEN(input => data:cities) city,
     LATERAL FLATTEN(input => city.value:districts) district
GROUP BY city_name
ORDER BY total_area_km2 DESC;"
147;A;-1;ChatGPT5.2;2;10;"WITH flattened_districts AS (
    SELECT
        city.value:name::STRING AS city_name,
        district.value:area_km2:area_km2::NUMBER AS area_km2
    FROM cities_pop,
         LATERAL FLATTEN(input => data:cities) city,
         LATERAL FLATTEN(input => city.value:districts) district
)
SELECT
    city_name,
    SUM(area_km2) AS total_area_km2
FROM flattened_districts
GROUP BY city_name
ORDER BY total_area_km2 DESC;"
148;A;-1;ChatGPT5.2;3;10;"SELECT c.value:name::STRING city,
       SUM(d.value:area_km2:area_km2::NUMBER) total_area_km2
FROM cities_pop,
     LATERAL FLATTEN(input=>data:cities) c,
     LATERAL FLATTEN(input=>c.value:districts) d
GROUP BY city
ORDER BY total_area_km2 DESC;"
149;B;-1;ChatGPT5.2;0;10;"SELECT
    furnishing_status,
    price,
    ranking
FROM (
    SELECT
        data:furnishingstatus::STRING AS furnishing_status,
        data:price::NUMBER AS price,
        ROW_NUMBER() OVER (
            PARTITION BY data:furnishingstatus::STRING
            ORDER BY data:price::NUMBER DESC
        ) AS ranking
    FROM house_price
    WHERE data:price IS NOT NULL
)
WHERE ranking <= 3
ORDER BY furnishing_status, ranking;





"
150;B;-1;ChatGPT5.2;1;10;"SELECT
    furnishingstatus,
    price,
    ranking
FROM (
    SELECT
        data:furnishingstatus::STRING AS furnishingstatus,
        data:price::NUMBER AS price,
        ROW_NUMBER() OVER (
            PARTITION BY data:furnishingstatus::STRING
            ORDER BY data:price::NUMBER DESC
        ) AS ranking
    FROM house_price
    WHERE data:price IS NOT NULL
)
WHERE ranking <= 3
ORDER BY furnishingstatus, ranking;"
151;B;-1;ChatGPT5.2;2;10;"WITH ranked_houses AS (
    SELECT
        data:furnishingstatus::STRING AS furnishingstatus,
        data:price::NUMBER AS price,
        ROW_NUMBER() OVER (
            PARTITION BY data:furnishingstatus::STRING
            ORDER BY data:price::NUMBER DESC
        ) AS ranking
    FROM house_price
    WHERE data:price IS NOT NULL
)
SELECT
    furnishingstatus,
    price,
    ranking
FROM ranked_houses
WHERE ranking <= 3
ORDER BY furnishingstatus, ranking;"
152;B;-1;ChatGPT5.2;3;10;"SELECT furnishingstatus, price, ranking
FROM (
  SELECT data:furnishingstatus::STRING furnishingstatus,
         data:price::NUMBER price,
         ROW_NUMBER() OVER (
           PARTITION BY data:furnishingstatus::STRING
           ORDER BY data:price::NUMBER DESC
         ) ranking
  FROM house_price
  WHERE data:price IS NOT NULL
)
WHERE ranking <= 3
ORDER BY furnishingstatus, ranking;"
153;C;-1;ChatGPT5.2;0;10;"SELECT
    industry.value::STRING AS industry,
    COUNT(*) AS billionaire_count
FROM forbes,
     LATERAL FLATTEN(input => data:industries) industry
GROUP BY industry
ORDER BY billionaire_count DESC;"
154;C;-1;ChatGPT5.2;1;10;"SELECT
    industry.value::STRING AS industry,
    COUNT(*) AS billionaire_count
FROM forbes,
     LATERAL FLATTEN(input => data:industries) industry
GROUP BY industry
ORDER BY billionaire_count DESC;"
155;C;-1;ChatGPT5.2;2;10;"SELECT
    industry.value::STRING AS industry,
    COUNT(*) AS billionaire_count
FROM forbes,
     LATERAL FLATTEN(input => data:industries) industry
GROUP BY industry
ORDER BY billionaire_count DESC;"
156;C;-1;ChatGPT5.2;3;10;"SELECT i.value::STRING industry, COUNT(*) billionaire_count
FROM forbes, LATERAL FLATTEN(input=>data:industries) i
GROUP BY industry
ORDER BY billionaire_count DESC;"
157;D;-1;ChatGPT5.2;0;10;"WITH ranked_temps AS (
    SELECT
        data:WindGustDir::STRING AS wind_direction,
        data:Temp3pm::NUMBER AS temp_3pm,
        ROW_NUMBER() OVER (
            PARTITION BY data:WindGustDir::STRING
            ORDER BY data:Temp3pm::NUMBER DESC
        ) AS ranking
    FROM weather
    WHERE data:Temp3pm IS NOT NULL
)
SELECT
    wind_direction,
    ranking,
    temp_3pm
FROM ranked_temps
WHERE ranking <= 3
ORDER BY wind_direction, ranking;"
158;D;-1;ChatGPT5.2;1;10;"WITH ranked_temperatures AS (
    SELECT
        data:WindGustDir::STRING AS wind_direction,
        data:Temp3pm::NUMBER AS temp_3pm,
        ROW_NUMBER() OVER (
            PARTITION BY data:WindGustDir::STRING
            ORDER BY data:Temp3pm::NUMBER DESC
        ) AS ranking
    FROM weather
    WHERE data:Temp3pm IS NOT NULL
)
SELECT
    wind_direction,
    ranking,
    temp_3pm
FROM ranked_temperatures
WHERE ranking <= 3
ORDER BY wind_direction, ranking;





"
159;D;-1;ChatGPT5.2;2;10;"WITH ranked_temperatures AS (
    SELECT
        data:WindGustDir::STRING AS wind_gust_dir,
        data:Temp3pm::NUMBER AS temp_3pm,
        ROW_NUMBER() OVER (
            PARTITION BY data:WindGustDir::STRING
            ORDER BY data:Temp3pm::NUMBER DESC
        ) AS temp_rank
    FROM weather
    WHERE data:Temp3pm IS NOT NULL
)
SELECT
    wind_gust_dir,
    temp_rank,
    temp_3pm
FROM ranked_temperatures
WHERE temp_rank <= 3
ORDER BY wind_gust_dir, temp_rank;"
160;D;-1;ChatGPT5.2;3;10;"SELECT wind_dir, ranking, temp_3pm
FROM (
  SELECT data:WindGustDir::STRING wind_dir, data:Temp3pm::NUMBER temp_3pm,
         ROW_NUMBER() OVER (PARTITION BY data:WindGustDir::STRING ORDER BY data:Temp3pm::NUMBER DESC) ranking
  FROM weather WHERE data:Temp3pm IS NOT NULL
)
WHERE ranking<=3
ORDER BY wind_dir, ranking;"
161;A;-1;CortexAI;0;1;"CREATE OR REPLACE TABLE retail (
    invoice_no INTEGER,
    stock_code TEXT,
    description TEXT,
    quantity INTEGER,
    invoice_date TIMESTAMP,
    unit_price DECIMAL,
    customer_id INTEGER,
    country TEXT
);

COPY INTO retail 
FROM '@my_stage/online_retail.csv'
FILE_FORMAT = (
    TYPE = 'CSV' 
    FIELD_DELIMITER = ';'
    SKIP_HEADER = 1
)
ON_ERROR = 'CONTINUE';"
162;A;-1;CortexAI;1;1;"CREATE TABLE retail (
    invoice_no INTEGER,
    stock_code TEXT,
    description TEXT,
    quantity INTEGER,
    invoice_date TIMESTAMP,
    unit_price DECIMAL,
    customer_id INTEGER,
    country TEXT
);

COPY INTO retail 
FROM '@my_stage/online_retail.csv'
FILE_FORMAT = (
    TYPE = 'CSV' 
    FIELD_DELIMITER = ';'
    SKIP_HEADER = 1
)
ON_ERROR = 'CONTINUE';"
163;A;-1;CortexAI;2;1;"CREATE TABLE retail (
    invoice_no INTEGER,
    stock_code TEXT,
    description TEXT,
    quantity INTEGER,
    invoice_date TIMESTAMP,
    unit_price DECIMAL,
    customer_id INTEGER,
    country TEXT
);

COPY INTO retail 
FROM '@my_stage/online_retail.csv'
FILE_FORMAT = (
    TYPE = 'CSV' 
    FIELD_DELIMITER = ';'
    SKIP_HEADER = 1
)
ON_ERROR = 'CONTINUE';"
164;A;-1;CortexAI;3;1;"CREATE TABLE retail (
    invoice_no INTEGER,
    stock_code TEXT,
    description TEXT,
    quantity INTEGER,
    invoice_date TIMESTAMP,
    unit_price DECIMAL,
    customer_id INTEGER,
    country TEXT
);

COPY INTO retail 
FROM '@my_stage/online_retail.csv'
FILE_FORMAT = (
    TYPE = 'CSV' 
    FIELD_DELIMITER = ';'
    SKIP_HEADER = 1
)
ON_ERROR = 'CONTINUE';"
165;B;-1;CortexAI;0;1;"CREATE TABLE games (
    id INTEGER,
    name TEXT,
    platform TEXT,
    year INTEGER,
    genre TEXT,
    publisher TEXT,
    na_sales DECIMAL,
    eu_sales DECIMAL,
    jp_sales DECIMAL,
    other_sales DECIMAL,
    global_sales DECIMAL
);

COPY INTO games 
FROM '@my_stage/video_game_sales.csv'
FILE_FORMAT = (
    TYPE = 'CSV'
    SKIP_HEADER = 1
)
ON_ERROR = 'CONTINUE';"
166;B;-1;CortexAI;1;1;"CREATE TABLE games (
    id INTEGER,
    name TEXT,
    platform TEXT,
    year INTEGER,
    genre TEXT,
    publisher TEXT,
    na_sales DECIMAL,
    eu_sales DECIMAL,
    jp_sales DECIMAL,
    other_sales DECIMAL,
    global_sales DECIMAL
);

COPY INTO games 
FROM '@my_stage/video_game_sales.csv'
FILE_FORMAT = (
    TYPE = 'CSV'
    SKIP_HEADER = 1
)
ON_ERROR = 'CONTINUE';"
167;B;-1;CortexAI;2;1;"CREATE TABLE games (
    id INTEGER,
    name TEXT,
    platform TEXT,
    year INTEGER,
    genre TEXT,
    publisher TEXT,
    na_sales DECIMAL,
    eu_sales DECIMAL,
    jp_sales DECIMAL,
    other_sales DECIMAL,
    global_sales DECIMAL
);

COPY INTO games 
FROM '@my_stage/video_game_sales.csv'
FILE_FORMAT = (
    TYPE = 'CSV'
    SKIP_HEADER = 1
)
ON_ERROR = 'CONTINUE';"
168;B;-1;CortexAI;3;1;"CREATE TABLE games (
    id INTEGER,
    name TEXT,
    platform TEXT,
    year INTEGER,
    genre TEXT,
    publisher TEXT,
    na_sales DECIMAL,
    eu_sales DECIMAL,
    jp_sales DECIMAL,
    other_sales DECIMAL,
    global_sales DECIMAL
);

COPY INTO games 
FROM '@my_stage/video_game_sales.csv'
FILE_FORMAT = (
    TYPE = 'CSV'
    SKIP_HEADER = 1
)
ON_ERROR = 'CONTINUE';"
169;C;-1;CortexAI;0;1;"CREATE TABLE eshop (
    year INTEGER,
    month INTEGER,
    day INTEGER,
    order_no INTEGER,
    country TEXT,
    session_id INTEGER,
    category TEXT,
    clothing_model TEXT,
    colour TEXT,
    location TEXT,
    model INTEGER,
    price INTEGER,
    page TEXT
);

COPY INTO eshop 
FROM '@my_stage/eshop_clothing.csv'
FILE_FORMAT = (
    TYPE = 'CSV' 
    FIELD_DELIMITER = ';'
    SKIP_HEADER = 1
)
ON_ERROR = 'CONTINUE';"
170;C;-1;CortexAI;1;1;"CREATE TABLE eshop (
    year INTEGER,
    month INTEGER,
    day INTEGER,
    order_no INTEGER,
    country TEXT,
    session_id INTEGER,
    category TEXT,
    clothing_model TEXT,
    colour TEXT,
    location TEXT,
    model INTEGER,
    price INTEGER,
    page TEXT
);

COPY INTO eshop 
FROM '@my_stage/eshop_clothing.csv'
FILE_FORMAT = (
    TYPE = 'CSV' 
    FIELD_DELIMITER = ';'
    SKIP_HEADER = 1
)
ON_ERROR = 'CONTINUE';"
171;C;-1;CortexAI;2;1;"CREATE TABLE eshop (
    year INTEGER,
    month INTEGER,
    day INTEGER,
    order_no INTEGER,
    country TEXT,
    session_id INTEGER,
    category TEXT,
    clothing_model TEXT,
    colour TEXT,
    location TEXT,
    model INTEGER,
    price INTEGER,
    page TEXT
);

COPY INTO eshop 
FROM '@my_stage/eshop_clothing.csv'
FILE_FORMAT = (
    TYPE = 'CSV' 
    FIELD_DELIMITER = ';'
    SKIP_HEADER = 1
)
ON_ERROR = 'CONTINUE';"
172;C;-1;CortexAI;3;1;"CREATE TABLE eshop (
    year INTEGER,
    month INTEGER,
    day INTEGER,
    order_no INTEGER,
    country TEXT,
    session_id INTEGER,
    category TEXT,
    clothing_model TEXT,
    colour TEXT,
    location TEXT,
    model INTEGER,
    price INTEGER,
    page TEXT
);

COPY INTO eshop 
FROM '@my_stage/eshop_clothing.csv'
FILE_FORMAT = (
    TYPE = 'CSV' 
    FIELD_DELIMITER = ';'
    SKIP_HEADER = 1
)
ON_ERROR = 'CONTINUE';"
173;D;-1;CortexAI;0;1;"CREATE TABLE sales (
    order_id TEXT,
    order_date DATE,
    status TEXT,
    fulfilment TEXT,
    ship_service TEXT,
    product TEXT,
    category TEXT,
    size TEXT,
    courier_status TEXT,
    quantity INTEGER,
    amount DECIMAL,
    ship_state TEXT
);

COPY INTO sales 
FROM '@my_stage/amazon_report.csv'
FILE_FORMAT = (
    TYPE = 'CSV' 
    FIELD_DELIMITER = ';'
    SKIP_HEADER = 1
)
ON_ERROR = 'CONTINUE';"
174;D;-1;CortexAI;1;1;"CREATE TABLE sales (
    order_id TEXT,
    order_date DATE,
    status TEXT,
    fulfilment TEXT,
    ship_service TEXT,
    product TEXT,
    category TEXT,
    size TEXT,
    courier_status TEXT,
    quantity INTEGER,
    amount DECIMAL,
    ship_state TEXT
);

COPY INTO sales 
FROM '@my_stage/amazon_report.csv'
FILE_FORMAT = (
    TYPE = 'CSV' 
    FIELD_DELIMITER = ';'
    SKIP_HEADER = 1
)
ON_ERROR = 'CONTINUE';"
175;D;-1;CortexAI;2;1;"CREATE TABLE sales (
    order_id TEXT,
    order_date DATE,
    status TEXT,
    fulfilment TEXT,
    ship_service TEXT,
    product TEXT,
    category TEXT,
    size TEXT,
    courier_status TEXT,
    quantity INTEGER,
    amount DECIMAL,
    ship_state TEXT
);

COPY INTO sales 
FROM '@my_stage/amazon_report.csv'
FILE_FORMAT = (
    TYPE = 'CSV' 
    FIELD_DELIMITER = ';'
    SKIP_HEADER = 1
)
ON_ERROR = 'CONTINUE';"
176;D;-1;CortexAI;3;1;"CREATE TABLE sales (
    order_id TEXT,
    order_date DATE,
    status TEXT,
    fulfilment TEXT,
    ship_service TEXT,
    product TEXT,
    category TEXT,
    size TEXT,
    courier_status TEXT,
    quantity INTEGER,
    amount DECIMAL,
    ship_state TEXT
);

COPY INTO sales 
FROM '@my_stage/amazon_report.csv'
FILE_FORMAT = (
    TYPE = 'CSV' 
    FIELD_DELIMITER = ';'
    SKIP_HEADER = 1
)
ON_ERROR = 'CONTINUE';"
177;A;-1;CortexAI;0;2;"SELECT 
    customer_id,
    invoice_date,
    quantity * unit_price as amount,
    SUM(quantity * unit_price) OVER (
        PARTITION BY customer_id 
        ORDER BY invoice_date 
        RANGE BETWEEN INTERVAL '14 DAYS' PRECEDING AND CURRENT ROW
    ) as rolling_14day_sum
FROM retail
ORDER BY customer_id, invoice_date;"
178;A;-1;CortexAI;1;2;"SELECT 
    customer_id,
    invoice_date,
    quantity * unit_price as amount,
    SUM(quantity * unit_price) OVER (
        PARTITION BY customer_id 
        ORDER BY invoice_date 
        RANGE BETWEEN INTERVAL '14 DAYS' PRECEDING AND CURRENT ROW
    ) as rolling_14day_sum
FROM retail
ORDER BY customer_id, invoice_date;"
179;A;-1;CortexAI;2;2;"WITH daily_sales AS (
    SELECT 
        customer_id,
        invoice_date::DATE as sale_date,
        SUM(quantity * unit_price) as daily_amount
    FROM retail
    GROUP BY customer_id, sale_date
)
SELECT 
    customer_id,
    sale_date,
    daily_amount,
    SUM(daily_amount) OVER (
        PARTITION BY customer_id 
        ORDER BY sale_date 
        ROWS BETWEEN 13 PRECEDING AND CURRENT ROW
    ) as rolling_14day_sum
FROM daily_sales
ORDER BY customer_id, sale_date;"
180;A;-1;CortexAI;3;2;"SELECT 
    customer_id,
    invoice_date,
    quantity * unit_price as amount,
    SUM(quantity * unit_price) OVER (PARTITION BY customer_id ORDER BY invoice_date ROWS BETWEEN 13 PRECEDING AND CURRENT ROW) as rolling_14day_sum
FROM retail
ORDER BY customer_id, invoice_date;"
181;B;-1;CortexAI;0;2;"SELECT 
    platform,
    year,
    SUM(global_sales) as yearly_sales,
    SUM(SUM(global_sales)) OVER (PARTITION BY platform ORDER BY year ROWS BETWEEN 2 PRECEDING AND CURRENT ROW) as rolling_3year_sum
FROM games
GROUP BY platform, year
ORDER BY platform, year;"
182;B;-1;CortexAI;1;2;"SELECT 
    platform,
    year,
    SUM(global_sales) as yearly_sales,
    SUM(SUM(global_sales)) OVER (PARTITION BY platform ORDER BY year ROWS BETWEEN 2 PRECEDING AND CURRENT ROW) as rolling_3year_sum
FROM games
GROUP BY platform, year
ORDER BY platform, year;"
183;B;-1;CortexAI;2;2;"SELECT 
    platform,
    year,
    SUM(global_sales) as yearly_sales,
    SUM(SUM(global_sales)) OVER (
        PARTITION BY platform 
        ORDER BY year 
        ROWS BETWEEN 2 PRECEDING AND CURRENT ROW
    ) as rolling_3year_sum
FROM games
GROUP BY platform, year
ORDER BY platform, year;"
184;B;-1;CortexAI;3;2;"SELECT 
    platform,
    year,
    SUM(global_sales) as yearly_sales,
    SUM(SUM(global_sales)) OVER (PARTITION BY platform ORDER BY year ROWS BETWEEN 2 PRECEDING AND CURRENT ROW) as rolling_3year_sum
FROM games
GROUP BY platform, year
ORDER BY platform, year;"
185;C;-1;CortexAI;0;2;"SELECT 
    ship_state,
    order_date,
    SUM(amount) as daily_amount,
    SUM(SUM(amount)) OVER (PARTITION BY ship_state ORDER BY order_date ROWS BETWEEN 6 PRECEDING AND CURRENT ROW) as rolling_7day_sum
FROM sales
GROUP BY ship_state, order_date
ORDER BY ship_state, order_date;"
186;C;-1;CortexAI;1;2;"SELECT 
    country,
    DATE_FROM_PARTS(year, month, day) as order_date,
    SUM(price) as daily_amount,
    SUM(SUM(price)) OVER (PARTITION BY country ORDER BY DATE_FROM_PARTS(year, month, day) ROWS BETWEEN 6 PRECEDING AND CURRENT ROW) as rolling_7day_sum
FROM eshop
GROUP BY country, order_date
ORDER BY country, order_date;"
187;C;-1;CortexAI;2;2;"WITH daily_sales AS (
    SELECT 
        country,
        DATE_FROM_PARTS(year, month, day) as sale_date,
        SUM(price) as daily_amount
    FROM eshop
    GROUP BY country, sale_date
)
SELECT 
    country,
    sale_date,
    daily_amount,
    SUM(daily_amount) OVER (
        PARTITION BY country 
        ORDER BY sale_date 
        ROWS BETWEEN 6 PRECEDING AND CURRENT ROW
    ) as rolling_7day_sum
FROM daily_sales
ORDER BY country, sale_date;"
188;C;-1;CortexAI;3;2;"SELECT 
    country,
    DATE_FROM_PARTS(year, month, day) as order_date,
    SUM(price) as daily_amount,
    SUM(SUM(price)) OVER (PARTITION BY country ORDER BY DATE_FROM_PARTS(year, month, day) ROWS BETWEEN 6 PRECEDING AND CURRENT ROW) as rolling_7day_sum
FROM eshop
GROUP BY country, order_date
ORDER BY country, order_date;"
189;D;-1;CortexAI;0;2;"SELECT 
    ship_state,
    order_date,
    SUM(amount) as daily_amount,
    SUM(SUM(amount)) OVER (PARTITION BY ship_state ORDER BY order_date ROWS BETWEEN 6 PRECEDING AND CURRENT ROW) as rolling_7day_sum
FROM sales
GROUP BY ship_state, order_date
ORDER BY ship_state, order_date;"
190;D;-1;CortexAI;1;2;"SELECT 
    ship_state,
    order_date,
    SUM(amount) as daily_amount,
    SUM(SUM(amount)) OVER (PARTITION BY ship_state ORDER BY order_date ROWS BETWEEN 6 PRECEDING AND CURRENT ROW) as rolling_7day_sum
FROM sales
GROUP BY ship_state, order_date
ORDER BY ship_state, order_date;"
191;D;-1;CortexAI;2;2;"SELECT 
    ship_state,
    order_date,
    SUM(amount) as daily_amount,
    SUM(SUM(amount)) OVER (PARTITION BY ship_state ORDER BY order_date ROWS BETWEEN 6 PRECEDING AND CURRENT ROW) as rolling_7day_sum
FROM sales
GROUP BY ship_state, order_date
ORDER BY ship_state, order_date;"
192;D;-1;CortexAI;3;2;"SELECT 
    ship_state,
    order_date,
    SUM(amount) as daily_amount,
    SUM(SUM(amount)) OVER (PARTITION BY ship_state ORDER BY order_date ROWS BETWEEN 6 PRECEDING AND CURRENT ROW) as rolling_7day_sum
FROM sales
GROUP BY ship_state, order_date
ORDER BY ship_state, order_date;"
193;A;-1;CortexAI;0;3;"SELECT 
    customer_id,
    invoice_date,
    DATEDIFF('day', invoice_date, 
        LEAD(invoice_date) OVER (
            PARTITION BY customer_id 
            ORDER BY invoice_date
        )
    ) as days_to_next_order
FROM retail
WHERE quantity > 0
ORDER BY days_to_next_order DESC;"
194;A;-1;CortexAI;1;3;"SELECT 
    customer_id,
    invoice_date,
    DATEDIFF('day', invoice_date, 
        LEAD(invoice_date) OVER (
            PARTITION BY customer_id 
            ORDER BY invoice_date
        )
    ) as days_to_next_order
FROM retail
WHERE quantity > 0
ORDER BY days_to_next_order DESC;"
195;A;-1;CortexAI;2;3;"SELECT 
    customer_id,
    invoice_date,
    DATEDIFF('day', invoice_date, 
        LEAD(invoice_date) OVER (
            PARTITION BY customer_id 
            ORDER BY invoice_date
        )
    ) as days_to_next_order
FROM retail
WHERE quantity > 0
ORDER BY days_to_next_order DESC NULLS LAST;"
196;A;-1;CortexAI;3;3;"SELECT 
    customer_id,
    invoice_date,
    DATEDIFF('day', invoice_date, LEAD(invoice_date) OVER (PARTITION BY customer_id ORDER BY invoice_date)) as days_to_next_order
FROM retail
WHERE quantity > 0
ORDER BY days_to_next_order DESC NULLS LAST;"
197;B;-1;CortexAI;0;3;"SELECT 
    genre,
    year,
    SUM(global_sales) as yearly_sales,
    SUM(global_sales) - LAG(SUM(global_sales)) OVER (PARTITION BY genre ORDER BY year) as sales_difference
FROM games
GROUP BY genre, year
ORDER BY genre, year;"
198;B;-1;CortexAI;1;3;"SELECT 
    genre,
    year,
    SUM(global_sales) as yearly_sales,
    SUM(global_sales) - LAG(SUM(global_sales)) OVER (PARTITION BY genre ORDER BY year) as sales_diff_prev_year
FROM games
GROUP BY genre, year
ORDER BY genre, year;"
199;B;-1;CortexAI;2;3;"WITH yearly_sales AS (
    SELECT 
        genre,
        year,
        SUM(global_sales) as total_sales
    FROM games
    GROUP BY genre, year
)
SELECT 
    genre,
    year,
    total_sales,
    total_sales - LAG(total_sales) OVER (
        PARTITION BY genre 
        ORDER BY year
    ) as sales_difference
FROM yearly_sales
ORDER BY genre, year;"
200;B;-1;CortexAI;3;3;"SELECT 
    genre,
    year,
    SUM(global_sales) as yearly_sales,
    SUM(global_sales) - LAG(SUM(global_sales)) OVER (PARTITION BY genre ORDER BY year) as sales_diff
FROM games
GROUP BY genre, year
ORDER BY genre, year;"
201;C;-1;CortexAI;0;3;"SELECT 
    clothing_model,
    DATE_FROM_PARTS(year, month, day) as date,
    price,
    LAG(price) OVER (PARTITION BY clothing_model ORDER BY DATE_FROM_PARTS(year, month, day)) as previous_price,
    price - LAG(price) OVER (PARTITION BY clothing_model ORDER BY DATE_FROM_PARTS(year, month, day)) as price_change
FROM eshop
ORDER BY clothing_model, date;"
202;C;-1;CortexAI;1;3;"SELECT 
    clothing_model,
    DATE_FROM_PARTS(year, month, day) as order_date,
    price,
    LAG(price) OVER (PARTITION BY clothing_model ORDER BY DATE_FROM_PARTS(year, month, day)) as prev_price,
    price - LAG(price) OVER (PARTITION BY clothing_model ORDER BY DATE_FROM_PARTS(year, month, day)) as price_change
FROM eshop
ORDER BY clothing_model, order_date;"
203;C;-1;CortexAI;2;3;"SELECT 
    clothing_model,
    DATE_FROM_PARTS(year, month, day) as sale_date,
    price,
    LAG(price) OVER (
        PARTITION BY clothing_model 
        ORDER BY DATE_FROM_PARTS(year, month, day)
    ) as prev_price,
    price - LAG(price) OVER (
        PARTITION BY clothing_model 
        ORDER BY DATE_FROM_PARTS(year, month, day)
    ) as price_change
FROM eshop
ORDER BY clothing_model, sale_date;"
204;C;-1;CortexAI;3;3;"SELECT 
    clothing_model,
    DATE_FROM_PARTS(year, month, day) as order_date,
    price,
    LAG(price) OVER (PARTITION BY clothing_model ORDER BY DATE_FROM_PARTS(year, month, day)) as prev_price,
    price - LAG(price) OVER (PARTITION BY clothing_model ORDER BY DATE_FROM_PARTS(year, month, day)) as price_change
FROM eshop
ORDER BY clothing_model, order_date;"
205;D;-1;CortexAI;0;3;"SELECT 
    ship_state,
    order_date,
    DATEDIFF('day', order_date, LEAD(order_date) OVER (PARTITION BY ship_state ORDER BY order_date)) as days_diff
FROM sales
WHERE ship_state IS NOT NULL
ORDER BY days_diff DESC;"
206;D;-1;CortexAI;1;3;"SELECT 
    s1.ship_state,
    s1.order_date as current_date,
    s2.order_date as compare_date,
    DATEDIFF('day', s1.order_date, s2.order_date) as days_difference
FROM sales s1
JOIN sales s2 ON s1.ship_state = s2.ship_state
WHERE s2.order_date > s1.order_date
ORDER BY days_difference DESC;"
207;D;-1;CortexAI;2;3;"SELECT 
    s1.ship_state,
    s1.order_date as current_date,
    s2.order_date as compare_date,
    DATEDIFF('day', s1.order_date, s2.order_date) as days_difference
FROM sales s1
JOIN sales s2 ON s1.ship_state = s2.ship_state
WHERE s2.order_date > s1.order_date
ORDER BY days_difference DESC;"
208;D;-1;CortexAI;3;3;"SELECT 
    s1.ship_state,
    s1.order_date as current_date,
    s2.order_date as compare_date,
    DATEDIFF('day', s1.order_date, s2.order_date) as days_difference
FROM sales s1
JOIN sales s2 ON s1.ship_state = s2.ship_state AND s1.order_date < s2.order_date
ORDER BY days_difference DESC;"
209;A;-1;CortexAI;0;4;"SELECT 
    customer_id,
    SUM(quantity * unit_price) as total_amount,
    NTILE(4) OVER (ORDER BY SUM(quantity * unit_price) DESC) as quartile
FROM retail
GROUP BY customer_id
ORDER BY total_amount DESC;"
210;A;-1;CortexAI;1;4;"SELECT 
    customer_id,
    SUM(quantity * unit_price) as total_amount,
    NTILE(4) OVER (ORDER BY SUM(quantity * unit_price) DESC) as quartile
FROM retail
GROUP BY customer_id
ORDER BY total_amount DESC;"
211;A;-1;CortexAI;2;4;"WITH customer_totals AS (
    SELECT 
        customer_id,
        SUM(quantity * unit_price) as total_amount,
        NTILE(4) OVER (ORDER BY SUM(quantity * unit_price)) as quartile
    FROM retail
    GROUP BY customer_id
)
SELECT *
FROM customer_totals
ORDER BY total_amount DESC;"
212;A;-1;CortexAI;3;4;"SELECT 
    customer_id,
    SUM(quantity * unit_price) as total_amount,
    NTILE(4) OVER (ORDER BY SUM(quantity * unit_price) DESC) as quartile
FROM retail
GROUP BY customer_id
ORDER BY total_amount DESC;"
213;B;-1;CortexAI;0;4;"SELECT 
    name,
    year,
    global_sales,
    NTILE(4) OVER (PARTITION BY year ORDER BY global_sales) as quartile
FROM games
ORDER BY year DESC;"
214;B;-1;CortexAI;1;4;"SELECT 
    name,
    year,
    global_sales,
    NTILE(4) OVER (PARTITION BY year ORDER BY global_sales) as sales_quartile
FROM games
ORDER BY year DESC;"
215;B;-1;CortexAI;2;4;"SELECT 
    name,
    year,
    global_sales,
    NTILE(4) OVER (
        PARTITION BY year 
        ORDER BY global_sales
    ) as sales_quartile
FROM games
ORDER BY year DESC;"
216;B;-1;CortexAI;3;4;"SELECT 
    name,
    year,
    global_sales,
    NTILE(4) OVER (PARTITION BY year ORDER BY global_sales) as quartile
FROM games
ORDER BY year DESC;"
217;C;-1;CortexAI;0;4;"SELECT 
    category,
    SUM(amount) as total_amount,
    NTILE(4) OVER (ORDER BY SUM(amount)) as quartile
FROM sales
GROUP BY category
ORDER BY quartile;"
218;C;-1;CortexAI;1;4;"SELECT 
    category,
    SUM(price) as total_revenue,
    NTILE(4) OVER (ORDER BY SUM(price)) as quartile
FROM eshop
GROUP BY category
ORDER BY quartile;"
219;C;-1;CortexAI;2;4;"WITH category_sales AS (
    SELECT 
        category,
        SUM(price) as total_sales
    FROM eshop
    GROUP BY category
)
SELECT 
    category,
    total_sales,
    NTILE(4) OVER (ORDER BY total_sales) as quartile
FROM category_sales
ORDER BY quartile;"
220;C;-1;CortexAI;3;4;"SELECT 
    category,
    SUM(price) as total_revenue,
    NTILE(4) OVER (ORDER BY SUM(price)) as quartile
FROM eshop
GROUP BY category
ORDER BY quartile;"
221;D;-1;CortexAI;0;4;"SELECT 
    ship_state,
    SUM(amount) as total_amount,
    NTILE(4) OVER (ORDER BY SUM(amount) DESC) as quartile
FROM sales
GROUP BY ship_state;"
222;D;-1;CortexAI;1;4;"SELECT 
    ship_state,
    SUM(amount) as total_amount,
    NTILE(4) OVER (ORDER BY SUM(amount) DESC) as quartile
FROM sales
GROUP BY ship_state;"
223;D;-1;CortexAI;2;4;"WITH state_totals AS (
    SELECT 
        ship_state,
        SUM(amount) as total_amount
    FROM sales
    GROUP BY ship_state
)
SELECT 
    ship_state,
    total_amount,
    NTILE(4) OVER (ORDER BY total_amount DESC) as quartile
FROM state_totals
ORDER BY quartile, total_amount DESC;"
224;D;-1;CortexAI;3;4;"SELECT 
    ship_state,
    SUM(amount) as total_amount,
    NTILE(4) OVER (ORDER BY SUM(amount) DESC) as quartile
FROM sales
GROUP BY ship_state;"
225;A;-1;CortexAI;0;5;"SELECT *
FROM retail r1
WHERE invoice_date = (
    SELECT MIN(invoice_date)
    FROM retail r2
    WHERE r1.customer_id = r2.customer_id
)
ORDER BY customer_id;"
226;A;-1;CortexAI;1;5;"SELECT 
    customer_id,
    invoice_date,
    invoice_no,
    quantity * unit_price as amount
FROM (
    SELECT *,
        ROW_NUMBER() OVER (
            PARTITION BY customer_id 
            ORDER BY invoice_date
        ) as rn
    FROM retail
)
WHERE rn = 1
ORDER BY customer_id;"
227;A;-1;CortexAI;2;5;"WITH first_purchases AS (
    SELECT *,
        ROW_NUMBER() OVER (
            PARTITION BY customer_id 
            ORDER BY invoice_date
        ) as purchase_order
    FROM retail
)
SELECT *
FROM first_purchases
WHERE purchase_order = 1
ORDER BY customer_id;"
228;A;-1;CortexAI;3;5;"SELECT DISTINCT
    customer_id,
    FIRST_VALUE(invoice_date) OVER (PARTITION BY customer_id ORDER BY invoice_date) as first_purchase_date,
    FIRST_VALUE(invoice_no) OVER (PARTITION BY customer_id ORDER BY invoice_date) as first_invoice_no
FROM retail
ORDER BY customer_id;"
229;B;-1;CortexAI;0;5;"SELECT *
FROM (
    SELECT 
        publisher,
        year,
        name,
        eu_sales,
        ROW_NUMBER() OVER (PARTITION BY publisher, year ORDER BY eu_sales DESC) as rank
    FROM games
) 
WHERE rank <= 3
ORDER BY publisher, year, rank;"
230;B;-1;CortexAI;1;5;"SELECT *
FROM (
    SELECT 
        publisher,
        year,
        name,
        eu_sales,
        ROW_NUMBER() OVER (PARTITION BY publisher, year ORDER BY eu_sales DESC) as rank
    FROM games
) 
WHERE rank <= 3
ORDER BY publisher, year, rank;"
231;B;-1;CortexAI;2;5;"WITH ranked_games AS (
    SELECT 
        publisher,
        year,
        name,
        eu_sales,
        ROW_NUMBER() OVER (
            PARTITION BY publisher, year 
            ORDER BY eu_sales DESC
        ) as rank
    FROM games
)
SELECT *
FROM ranked_games
WHERE rank <= 3
ORDER BY publisher, year, rank;"
232;B;-1;CortexAI;3;5;"SELECT *
FROM (
    SELECT 
        publisher,
        year,
        name,
        eu_sales,
        ROW_NUMBER() OVER (PARTITION BY publisher, year ORDER BY eu_sales DESC) as rank
    FROM games
) 
WHERE rank <= 3
ORDER BY publisher, year, rank;"
233;C;-1;CortexAI;0;5;"SELECT 
    ship_state,
    product,
    SUM(amount) as total_amount,
    ROW_NUMBER() OVER (PARTITION BY ship_state ORDER BY SUM(amount) DESC) as rank
FROM sales
GROUP BY ship_state, product
QUALIFY rank <= 3
ORDER BY ship_state, rank;"
234;C;-1;CortexAI;1;5;"SELECT 
    country,
    clothing_model,
    SUM(price) as total_revenue,
    ROW_NUMBER() OVER (PARTITION BY country ORDER BY SUM(price) DESC) as rank
FROM eshop
GROUP BY country, clothing_model
QUALIFY rank <= 3
ORDER BY country, rank;"
235;C;-1;CortexAI;2;5;"WITH model_sales AS (
    SELECT 
        country,
        clothing_model,
        SUM(price) as total_sales,
        RANK() OVER (
            PARTITION BY country 
            ORDER BY SUM(price) DESC
        ) as sales_rank
    FROM eshop
    GROUP BY country, clothing_model
)
SELECT *
FROM model_sales
WHERE sales_rank <= 3
ORDER BY country, sales_rank;"
236;C;-1;CortexAI;3;5;"SELECT *
FROM (
    SELECT 
        country,
        clothing_model,
        SUM(price) as total_revenue,
        RANK() OVER (PARTITION BY country ORDER BY SUM(price) DESC) as rank
    FROM eshop
    GROUP BY country, clothing_model
) 
WHERE rank <= 3
ORDER BY country, rank;"
237;D;-1;CortexAI;0;5;"SELECT *
FROM (
    SELECT 
        ship_state,
        product,
        SUM(amount) as total_amount,
        RANK() OVER (PARTITION BY ship_state ORDER BY SUM(amount) DESC) as rank
    FROM sales
    WHERE amount IS NOT NULL
    GROUP BY ship_state, product
)
WHERE rank <= 5
ORDER BY ship_state, rank;"
238;D;-1;CortexAI;1;5;"SELECT *
FROM (
    SELECT 
        ship_state,
        product,
        SUM(amount) as total_amount,
        RANK() OVER (PARTITION BY ship_state ORDER BY SUM(amount) DESC) as rank
    FROM sales
    WHERE amount IS NOT NULL
    GROUP BY ship_state, product
) ranked
WHERE rank <= 5
ORDER BY ship_state, rank;"
239;D;-1;CortexAI;2;5;"WITH ranked_products AS (
    SELECT 
        ship_state,
        product,
        SUM(amount) as total_amount,
        RANK() OVER (PARTITION BY ship_state ORDER BY SUM(amount) DESC) as rank
    FROM sales
    WHERE amount IS NOT NULL
    GROUP BY ship_state, product
)
SELECT *
FROM ranked_products
WHERE rank <= 5
ORDER BY ship_state, rank;"
240;D;-1;CortexAI;3;5;"SELECT *
FROM (
    SELECT 
        ship_state,
        product,
        SUM(amount) as total_amount,
        ROW_NUMBER() OVER (PARTITION BY ship_state ORDER BY SUM(amount) DESC) as rank
    FROM sales
    WHERE amount IS NOT NULL
    GROUP BY ship_state, product
) 
WHERE rank <= 5
ORDER BY ship_state, rank;"
241;A;-1;CortexAI;0;6;"SELECT *
FROM (
    SELECT 
        country,
        DATE_TRUNC('MONTH', invoice_date) as month,
        customer_id,
        SUM(quantity * unit_price) as monthly_amount,
        ROW_NUMBER() OVER (
            PARTITION BY country, DATE_TRUNC('MONTH', invoice_date)
            ORDER BY SUM(quantity * unit_price) DESC
        ) as rank
    FROM retail
    GROUP BY country, month, customer_id
) 
WHERE rank <= 5
ORDER BY country, month, rank, customer_id;"
242;A;-1;CortexAI;1;6;"SELECT 
    country,
    DATE_TRUNC('MONTH', invoice_date) as month,
    customer_id,
    monthly_amount,
    customer_rank
FROM (
    SELECT 
        country,
        invoice_date,
        customer_id,
        SUM(quantity * unit_price) as monthly_amount,
        ROW_NUMBER() OVER (
            PARTITION BY country, DATE_TRUNC('MONTH', invoice_date)
            ORDER BY SUM(quantity * unit_price) DESC
        ) as customer_rank
    FROM retail
    GROUP BY country, DATE_TRUNC('MONTH', invoice_date), customer_id
)
WHERE customer_rank <= 5
ORDER BY country, month, customer_rank, customer_id;"
243;A;-1;CortexAI;2;6;"WITH monthly_sales AS (
    SELECT 
        customer_id,
        country,
        DATE_TRUNC('month', invoice_date) as month,
        SUM(quantity * unit_price) as monthly_amount,
        ROW_NUMBER() OVER (
            PARTITION BY country, DATE_TRUNC('month', invoice_date)
            ORDER BY SUM(quantity * unit_price) DESC
        ) as rank
    FROM retail
    GROUP BY customer_id, country, month
)
SELECT *
FROM monthly_sales
WHERE rank <= 5
ORDER BY country, month, rank, customer_id;"
244;A;-1;CortexAI;3;6;"SELECT *
FROM (
    SELECT 
        country,
        DATE_TRUNC('MONTH', invoice_date) as month,
        customer_id,
        SUM(quantity * unit_price) as monthly_amount,
        ROW_NUMBER() OVER (PARTITION BY country, DATE_TRUNC('MONTH', invoice_date) 
                          ORDER BY SUM(quantity * unit_price) DESC) as rank
    FROM retail
    GROUP BY country, month, customer_id
) 
WHERE rank <= 5
ORDER BY country, month, rank, customer_id;"
245;B;-1;CortexAI;0;6;"SELECT *
FROM (
    SELECT 
        genre,
        year,
        SUM(na_sales) as total_na_sales,
        ROW_NUMBER() OVER (PARTITION BY genre ORDER BY SUM(na_sales) DESC) as rank
    FROM games
    GROUP BY genre, year
)
WHERE rank <= 3
ORDER BY genre, rank;"
246;B;-1;CortexAI;1;6;"SELECT *
FROM (
    SELECT 
        genre,
        year,
        SUM(na_sales) as total_na_sales,
        ROW_NUMBER() OVER (PARTITION BY genre ORDER BY SUM(na_sales) DESC) as rank
    FROM games
    GROUP BY genre, year
)
WHERE rank <= 3
ORDER BY genre, rank;"
247;B;-1;CortexAI;2;6;"WITH yearly_sales AS (
    SELECT 
        genre,
        year,
        SUM(na_sales) as total_na_sales,
        RANK() OVER (
            PARTITION BY genre 
            ORDER BY SUM(na_sales) DESC
        ) as rank
    FROM games
    GROUP BY genre, year
)
SELECT *
FROM yearly_sales
WHERE rank <= 3
ORDER BY genre, rank;"
248;B;-1;CortexAI;3;6;"SELECT *
FROM (
    SELECT 
        genre,
        year,
        SUM(na_sales) as total_na_sales,
        ROW_NUMBER() OVER (PARTITION BY genre ORDER BY SUM(na_sales) DESC) as rank
    FROM games
    GROUP BY genre, year
)
WHERE rank <= 3
ORDER BY genre, rank;"
249;C;-1;CortexAI;0;6;"SELECT 
    ship_state,
    order_date,
    category,
    SUM(amount) as total_amount,
    DENSE_RANK() OVER (PARTITION BY ship_state, order_date ORDER BY SUM(amount) DESC) as category_rank
FROM sales
GROUP BY ship_state, order_date, category
QUALIFY category_rank <= 3
ORDER BY ship_state, order_date;"
250;C;-1;CortexAI;1;6;"SELECT 
    country,
    DATE_FROM_PARTS(year, month, day) as order_date,
    category,
    SUM(price) as daily_revenue,
    DENSE_RANK() OVER (PARTITION BY country, DATE_FROM_PARTS(year, month, day) ORDER BY SUM(price) DESC) as rank
FROM eshop
GROUP BY country, order_date, category
QUALIFY rank <= 3
ORDER BY country, order_date;"
251;C;-1;CortexAI;2;6;"WITH daily_category_sales AS (
    SELECT 
        DATE_FROM_PARTS(year, month, day) as sale_date,
        country,
        category,
        SUM(price) as total_sales,
        DENSE_RANK() OVER (
            PARTITION BY DATE_FROM_PARTS(year, month, day), country 
            ORDER BY SUM(price) DESC
        ) as sales_rank
    FROM eshop
    GROUP BY sale_date, country, category
)
SELECT *
FROM daily_category_sales
WHERE sales_rank <= 3
ORDER BY country, sale_date;"
252;C;-1;CortexAI;3;6;"SELECT *
FROM (
    SELECT 
        country,
        DATE_FROM_PARTS(year, month, day) as order_date,
        category,
        SUM(price) as daily_revenue,
        DENSE_RANK() OVER (PARTITION BY country, DATE_FROM_PARTS(year, month, day) ORDER BY SUM(price) DESC) as rank
    FROM eshop
    GROUP BY country, order_date, category
)
WHERE rank <= 3
ORDER BY country, order_date;"
253;D;-1;CortexAI;0;6;"WITH daily_rankings AS (
    SELECT 
        order_date,
        ship_state,
        SUM(amount) as total_amount,
        DENSE_RANK() OVER (PARTITION BY order_date ORDER BY SUM(amount) DESC) as rank
    FROM sales
    GROUP BY order_date, ship_state
)
SELECT *
FROM daily_rankings
WHERE rank <= 3
ORDER BY order_date;"
254;D;-1;CortexAI;1;6;"SELECT *
FROM (
    SELECT 
        order_date,
        ship_state,
        SUM(amount) as total_amount,
        DENSE_RANK() OVER (PARTITION BY order_date ORDER BY SUM(amount) DESC) as rank
    FROM sales
    GROUP BY order_date, ship_state
) ranked
WHERE rank <= 3
ORDER BY order_date;"
255;D;-1;CortexAI;2;6;"WITH daily_state_ranks AS (
    SELECT 
        order_date,
        ship_state,
        SUM(amount) as total_amount,
        DENSE_RANK() OVER (PARTITION BY order_date ORDER BY SUM(amount) DESC) as rank
    FROM sales
    GROUP BY order_date, ship_state
)
SELECT *
FROM daily_state_ranks
WHERE rank <= 3
ORDER BY order_date, rank;"
256;D;-1;CortexAI;3;6;"SELECT *
FROM (
    SELECT 
        order_date,
        ship_state,
        SUM(amount) as total_amount,
        DENSE_RANK() OVER (PARTITION BY order_date ORDER BY SUM(amount) DESC) as rank
    FROM sales
    GROUP BY order_date, ship_state
)
WHERE rank <= 3
ORDER BY order_date;"
257;A;-1;CortexAI;0;7;"CREATE OR REPLACE TABLE cities_pop (
    data VARIANT
);

COPY INTO cities_pop 
FROM '@my_stage/cities_population.json'
FILE_FORMAT = (TYPE = 'JSON');"
258;A;-1;CortexAI;1;7;"CREATE TABLE cities_pop (
    data VARIANT
);

COPY INTO cities_pop 
FROM '@my_stage/cities_population.json'
FILE_FORMAT = (TYPE = 'JSON');"
259;A;-1;CortexAI;2;7;"CREATE TABLE cities_pop (
    data VARIANT
);

COPY INTO cities_pop 
FROM '@my_stage/cities_population.json'
FILE_FORMAT = (TYPE = 'JSON');"
260;A;-1;CortexAI;3;7;"CREATE TABLE cities_pop (
    data VARIANT
);

COPY INTO cities_pop 
FROM '@my_stage/cities_population.json'
FILE_FORMAT = (TYPE = 'JSON');"
261;B;-1;CortexAI;0;7;"CREATE TABLE house_price (
    data VARIANT
);

COPY INTO house_price
FROM '@my_stage/house_price.json'
FILE_FORMAT = (TYPE = 'PARQUET');"
262;B;-1;CortexAI;1;7;"CREATE TABLE house_price (
    data VARIANT
);

COPY INTO house_price
FROM '@my_stage/house_price.json'
FILE_FORMAT = (TYPE = 'PARQUET');"
263;B;-1;CortexAI;2;7;"CREATE TABLE house_price (
    data VARIANT
);

COPY INTO house_price
FROM '@my_stage/house_price.json'
FILE_FORMAT = (TYPE = 'PARQUET');"
264;B;-1;CortexAI;3;7;"CREATE TABLE house_price (
    data VARIANT
);

COPY INTO house_price
FROM '@my_stage/house_price.json'
FILE_FORMAT = (TYPE = 'PARQUET');"
265;C;-1;CortexAI;0;7;"CREATE OR REPLACE TABLE forbes (
    data VARIANT
);

COPY INTO forbes 
FROM '@my_stage/forbes.json'
FILE_FORMAT = (TYPE = 'JSON');"
266;C;-1;CortexAI;1;7;"CREATE TABLE forbes (
    data VARIANT
);

COPY INTO forbes 
FROM '@my_stage/forbes.json'
FILE_FORMAT = (TYPE = 'JSON');"
267;C;-1;CortexAI;2;7;"CREATE TABLE forbes (
    data VARIANT
);

COPY INTO forbes 
FROM '@my_stage/forbes.json'
FILE_FORMAT = (TYPE = 'JSON');"
268;C;-1;CortexAI;3;7;"CREATE TABLE forbes (
    data VARIANT
);

COPY INTO forbes 
FROM '@my_stage/forbes.json'
FILE_FORMAT = (TYPE = 'JSON');"
269;D;-1;CortexAI;0;7;"CREATE TABLE weather (
    data VARIANT
);

COPY INTO weather
FROM '@my_stage/weather.json'
FILE_FORMAT = (TYPE = 'PARQUET');"
270;D;-1;CortexAI;1;7;"CREATE TABLE weather (
    data VARIANT
);

COPY INTO weather
FROM '@my_stage/weather.json'
FILE_FORMAT = (TYPE = 'PARQUET');"
271;D;-1;CortexAI;2;7;"CREATE TABLE weather (
    data VARIANT
);

COPY INTO weather
FROM '@my_stage/weather.json'
FILE_FORMAT = (TYPE = 'PARQUET');"
272;D;-1;CortexAI;3;7;"CREATE TABLE weather (data VARIANT);

COPY INTO weather FROM '@my_stage/weather.json'
FILE_FORMAT = (TYPE = 'PARQUET');"
273;A;-1;CortexAI;0;8;"SELECT 
    data:city::STRING as city,
    data:rank::INTEGER as rank
FROM cities_pop,
LATERAL FLATTEN(input => data:data)
WHERE data:country::STRING = 'India'
ORDER BY rank;"
274;A;-1;CortexAI;1;8;"SELECT 
    data:city::STRING as city,
    data:rank::INTEGER as rank
FROM cities_pop,
LATERAL FLATTEN(input => data:data)
WHERE data:country::STRING = 'India'
ORDER BY rank;"
275;A;-1;CortexAI;2;8;"SELECT 
    data:city::STRING as city,
    data:rank::INTEGER as rank
FROM cities_pop,
LATERAL FLATTEN(input => data:data)
WHERE data:country::STRING = 'India'
ORDER BY rank;"
276;A;-1;CortexAI;3;8;"SELECT 
    data:city::STRING as city,
    data:rank::INTEGER as rank
FROM cities_pop
WHERE data:country::STRING = 'India'
ORDER BY rank;"
277;B;-1;CortexAI;0;8;"SELECT 
    AVG(data:price::FLOAT) as avg_price,
    MEDIAN(data:price::FLOAT) as median_price
FROM house_price
WHERE data:price IS NOT NULL;"
278;B;-1;CortexAI;1;8;"SELECT 
    AVG(data:price::FLOAT) as avg_price,
    MEDIAN(data:price::FLOAT) as median_price
FROM house_price
WHERE data:price IS NOT NULL;"
279;B;-1;CortexAI;2;8;"SELECT 
    AVG(data:price::FLOAT) as avg_price,
    MEDIAN(data:price::FLOAT) as median_price
FROM house_price
WHERE data:price IS NOT NULL;"
280;B;-1;CortexAI;3;8;"SELECT 
    AVG(data:price::FLOAT) as avg_price,
    MEDIAN(data:price::FLOAT) as median_price
FROM house_price
WHERE data:price IS NOT NULL;"
281;C;-1;CortexAI;0;8;"SELECT *
FROM forbes
WHERE LOWER(country) = 'united states'
ORDER BY current_worth DESC;"
282;C;-1;CortexAI;1;8;"SELECT 
    data:name::STRING as name,
    data:current_worth::NUMBER as worth,
    data:country::STRING as country
FROM forbes
WHERE data:country::STRING = 'United States'
ORDER BY worth DESC;"
283;C;-1;CortexAI;2;8;"SELECT 
    data:name::STRING as name,
    data:current_worth::NUMBER as current_worth,
    data:country::STRING as country
FROM forbes
WHERE data:country::STRING = 'United States'
ORDER BY data:current_worth::NUMBER DESC;"
284;C;-1;CortexAI;3;8;"SELECT 
    data:name::STRING as name,
    data:current_worth::NUMBER as worth,
    data:country::STRING as country
FROM forbes
WHERE data:country::STRING = 'United States'
ORDER BY worth DESC;"
285;D;-1;CortexAI;0;8;"SELECT 
    AVG(CAST(data:MaxTemp AS FLOAT)) as avg_max_temp,
    MEDIAN(CAST(data:MaxTemp AS FLOAT)) as median_max_temp,
    AVG(CAST(data:MinTemp AS FLOAT)) as avg_min_temp,
    MEDIAN(CAST(data:MinTemp AS FLOAT)) as median_min_temp
FROM weather
WHERE data:MaxTemp IS NOT NULL 
AND data:MinTemp IS NOT NULL;"
286;D;-1;CortexAI;1;8;"SELECT 
    AVG(CAST(data:MaxTemp::FLOAT as FLOAT)) as avg_max_temp,
    MEDIAN(CAST(data:MaxTemp::FLOAT as FLOAT)) as median_max_temp,
    AVG(CAST(data:MinTemp::FLOAT as FLOAT)) as avg_min_temp,
    MEDIAN(CAST(data:MinTemp::FLOAT as FLOAT)) as median_min_temp
FROM weather
WHERE data:MaxTemp IS NOT NULL 
AND data:MinTemp IS NOT NULL;"
287;D;-1;CortexAI;2;8;"SELECT 
    AVG(CAST(data:MaxTemp::FLOAT as FLOAT)) as avg_max_temp,
    MEDIAN(CAST(data:MaxTemp::FLOAT as FLOAT)) as median_max_temp,
    AVG(CAST(data:MinTemp::FLOAT as FLOAT)) as avg_min_temp,
    MEDIAN(CAST(data:MinTemp::FLOAT as FLOAT)) as median_min_temp
FROM weather
WHERE data:MaxTemp IS NOT NULL 
AND data:MinTemp IS NOT NULL;"
288;D;-1;CortexAI;3;8;"SELECT 
    AVG(CAST(data:MaxTemp::FLOAT as FLOAT)) as avg_max_temp,
    MEDIAN(CAST(data:MaxTemp::FLOAT as FLOAT)) as median_max_temp,
    AVG(CAST(data:MinTemp::FLOAT as FLOAT)) as avg_min_temp,
    MEDIAN(CAST(data:MinTemp::FLOAT as FLOAT)) as median_min_temp
FROM weather
WHERE data:MaxTemp IS NOT NULL AND data:MinTemp IS NOT NULL;"
289;A;-1;CortexAI;0;9;"SELECT 
    data:country::STRING as country,
    COUNT(*) as city_count
FROM cities_pop,
LATERAL FLATTEN(input => data:data)
GROUP BY country
ORDER BY city_count;"
290;A;-1;CortexAI;1;9;"SELECT 
    data:country::STRING as country,
    COUNT(*) as city_count
FROM cities_pop,
LATERAL FLATTEN(input => data:data)
GROUP BY country
ORDER BY city_count;"
291;A;-1;CortexAI;2;9;"SELECT 
    data:country::STRING as country,
    COUNT(*) as city_count
FROM cities_pop,
LATERAL FLATTEN(input => data:data)
GROUP BY country
ORDER BY city_count;"
292;A;-1;CortexAI;3;9;"SELECT 
    data:country::STRING as country,
    COUNT(*) as city_count
FROM cities_pop
GROUP BY country
ORDER BY city_count;"
293;B;-1;CortexAI;0;9;"SELECT 
    data:furnishing_status::STRING as furnishing_status,
    COUNT(*) as count,
    AVG(data:price::FLOAT) as avg_price
FROM house_price
GROUP BY data:furnishing_status;"
294;B;-1;CortexAI;1;9;"SELECT 
    data:furnishing_status::STRING as furnishing_status,
    COUNT(*) as count_houses,
    AVG(data:price::FLOAT) as avg_price
FROM house_price
GROUP BY data:furnishing_status;"
295;B;-1;CortexAI;2;9;"SELECT 
    data:furnishing_status::STRING as furnishing_status,
    COUNT(*) as count_houses,
    AVG(data:price::FLOAT) as avg_price
FROM house_price
GROUP BY data:furnishing_status;"
296;B;-1;CortexAI;3;9;"SELECT 
    data:furnishing_status::STRING as furnishing_status,
    COUNT(*) as count,
    AVG(data:price::FLOAT) as avg_price
FROM house_price
GROUP BY data:furnishing_status;"
297;C;-1;CortexAI;0;9;"SELECT 
    name:data::STRING as name,
    current_worth:data::NUMBER as worth,
    ARRAY_SIZE(industries:data) as industry_count
FROM forbes
ORDER BY worth DESC;"
298;C;-1;CortexAI;1;9;"SELECT 
    data:name::STRING as name,
    data:current_worth::NUMBER as worth,
    ARRAY_SIZE(data:industries) as industry_count
FROM forbes
ORDER BY worth DESC;"
299;C;-1;CortexAI;2;9;"SELECT 
    data:name::STRING as name,
    data:current_worth::NUMBER as current_worth,
    ARRAY_SIZE(data:industries) as industry_count
FROM forbes
ORDER BY data:current_worth::NUMBER DESC;"
300;C;-1;CortexAI;3;9;"SELECT 
    data:name::STRING as name,
    data:current_worth::NUMBER as worth,
    ARRAY_SIZE(data:industries) as industry_count
FROM forbes
ORDER BY worth DESC;"
301;D;-1;CortexAI;0;9;"SELECT 
    data:WindGustDir::STRING as wind_direction,
    AVG(CAST(data:Rainfall AS FLOAT)) as avg_rainfall
FROM weather
WHERE data:WindGustDir IS NOT NULL
GROUP BY wind_direction
ORDER BY avg_rainfall;"
302;D;-1;CortexAI;1;9;"SELECT 
    data:WindGustDir::STRING as wind_direction,
    AVG(CAST(data:Rainfall::FLOAT as FLOAT)) as avg_rainfall
FROM weather
WHERE data:WindGustDir IS NOT NULL
GROUP BY data:WindGustDir
ORDER BY avg_rainfall;"
303;D;-1;CortexAI;2;9;"SELECT 
    data:WindGustDir::STRING as wind_direction,
    AVG(CAST(data:Rainfall::FLOAT as FLOAT)) as avg_rainfall
FROM weather
WHERE data:WindGustDir IS NOT NULL
AND data:Rainfall IS NOT NULL
GROUP BY wind_direction
ORDER BY avg_rainfall;"
304;D;-1;CortexAI;3;9;"SELECT 
    data:WindGustDir::STRING as wind_direction,
    AVG(CAST(data:Rainfall::FLOAT as FLOAT)) as avg_rainfall
FROM weather
WHERE data:WindGustDir IS NOT NULL
GROUP BY data:WindGustDir
ORDER BY avg_rainfall;"
305;A;-1;CortexAI;0;10;"SELECT 
    data:city::STRING as city,
    SUM(f.value:area_km2::FLOAT) as total_area
FROM cities_pop,
LATERAL FLATTEN(input => data:data) d,
LATERAL FLATTEN(input => d.value:districts) f
GROUP BY city
ORDER BY total_area DESC;"
306;A;-1;CortexAI;1;10;"SELECT 
    data:city::STRING as city,
    SUM(districts.value:area_km2::FLOAT) as total_area
FROM cities_pop,
LATERAL FLATTEN(input => data:data) cities,
LATERAL FLATTEN(input => cities.value:districts) districts
GROUP BY city
ORDER BY total_area DESC;"
307;A;-1;CortexAI;2;10;"SELECT 
    data:city::STRING as city,
    SUM(d.value:area_km2::FLOAT) as total_area
FROM cities_pop,
LATERAL FLATTEN(input => data:data) cities,
LATERAL FLATTEN(input => cities.value:districts) d
GROUP BY city
ORDER BY total_area DESC;"
308;A;-1;CortexAI;3;10;"SELECT 
    data:city::STRING as city,
    SUM(f.value:area_km2::FLOAT) as total_area
FROM cities_pop,
LATERAL FLATTEN(input => data:districts) f
GROUP BY city
ORDER BY total_area DESC;"
309;B;-1;CortexAI;0;10;"SELECT *
FROM (
    SELECT 
        data:furnishing_status::STRING as furnishing_status,
        data:price::FLOAT as price,
        ROW_NUMBER() OVER (PARTITION BY data:furnishing_status ORDER BY data:price::FLOAT DESC) as rank
    FROM house_price
    WHERE data:price IS NOT NULL
)
WHERE rank <= 3
ORDER BY furnishing_status, price DESC;"
310;B;-1;CortexAI;1;10;"SELECT 
    data:furnishing_status::STRING as furnishing_status,
    data:price::FLOAT as price
FROM (
    SELECT *,
        ROW_NUMBER() OVER (PARTITION BY data:furnishing_status ORDER BY data:price::FLOAT DESC) as rank
    FROM house_price
)
WHERE rank <= 3
ORDER BY data:furnishing_status, price DESC;"
311;B;-1;CortexAI;2;10;"WITH ranked_houses AS (
    SELECT 
        data:furnishing_status::STRING as furnishing_status,
        data:price::FLOAT as price,
        ROW_NUMBER() OVER (
            PARTITION BY data:furnishing_status 
            ORDER BY data:price::FLOAT DESC
        ) as rank
    FROM house_price
    WHERE data:price IS NOT NULL
)
SELECT *
FROM ranked_houses
WHERE rank <= 3
ORDER BY furnishing_status, price DESC;"
312;B;-1;CortexAI;3;10;"SELECT *
FROM (
    SELECT 
        data:furnishing_status::STRING as furnishing_status,
        data:price::FLOAT as price,
        ROW_NUMBER() OVER (PARTITION BY data:furnishing_status ORDER BY data:price::FLOAT DESC) as rank
    FROM house_price
    WHERE data:price IS NOT NULL
)
WHERE rank <= 3
ORDER BY furnishing_status, price DESC;"
313;C;-1;CortexAI;0;10;"SELECT 
    value:data:industry::STRING as industry,
    COUNT(*) as billionaire_count
FROM forbes,
LATERAL FLATTEN(input => forbes.data)
GROUP BY industry
ORDER BY billionaire_count DESC;"
314;C;-1;CortexAI;1;10;"SELECT 
    value::STRING as industry,
    COUNT(*) as billionaire_count
FROM forbes,
LATERAL FLATTEN(input => data:industries)
GROUP BY industry
ORDER BY billionaire_count DESC;"
315;C;-1;CortexAI;2;10;"SELECT 
    f.industry,
    COUNT(*) as billionaire_count
FROM forbes,
LATERAL FLATTEN(input => data:industries) f
GROUP BY f.industry
ORDER BY billionaire_count DESC;"
316;C;-1;CortexAI;3;10;"SELECT 
    f.industry,
    COUNT(*) as billionaire_count
FROM forbes,
LATERAL FLATTEN(input => data:industries) f
GROUP BY f.industry
ORDER BY billionaire_count DESC;"
317;D;-1;CortexAI;0;10;"WITH ranked_temps AS (
    SELECT 
        data:WindGustDir::STRING as wind_direction,
        data:Temp3pm::FLOAT as temp_3pm,
        RANK() OVER (PARTITION BY data:WindGustDir ORDER BY data:Temp3pm DESC) as rank
    FROM weather
    WHERE data:WindGustDir IS NOT NULL
    AND data:Temp3pm IS NOT NULL
)
SELECT *
FROM ranked_temps
WHERE rank <= 3
ORDER BY wind_direction, rank;"
318;D;-1;CortexAI;1;10;"SELECT *
FROM (
    SELECT 
        data:WindGustDir::STRING as wind_direction,
        data:Temp3pm::FLOAT as afternoon_temp,
        RANK() OVER (PARTITION BY data:WindGustDir ORDER BY data:Temp3pm DESC) as temp_rank
    FROM weather
    WHERE data:WindGustDir IS NOT NULL 
    AND data:Temp3pm IS NOT NULL
) ranked
WHERE temp_rank <= 3
ORDER BY wind_direction, temp_rank;"
319;D;-1;CortexAI;2;10;"WITH ranked_temps AS (
    SELECT 
        data:WindGustDir::STRING as wind_direction,
        data:Temp3pm::FLOAT as afternoon_temp,
        RANK() OVER (PARTITION BY data:WindGustDir ORDER BY data:Temp3pm DESC) as temp_rank
    FROM weather
    WHERE data:WindGustDir IS NOT NULL
    AND data:Temp3pm IS NOT NULL
)
SELECT *
FROM ranked_temps
WHERE temp_rank <= 3
ORDER BY wind_direction, temp_rank;"
320;D;-1;CortexAI;3;10;"SELECT *
FROM (
    SELECT 
        data:WindGustDir::STRING as wind_direction,
        data:Temp3pm::FLOAT as afternoon_temp,
        ROW_NUMBER() OVER (PARTITION BY data:WindGustDir ORDER BY data:Temp3pm DESC) as rn
    FROM weather
    WHERE data:WindGustDir IS NOT NULL AND data:Temp3pm IS NOT NULL
)
WHERE rn <= 3
ORDER BY wind_direction;"
321;A;-1;Claude_4.5_Sonnet;0;1;"CREATE TABLE retail (
    invoice_no INTEGER,
    stock_code TEXT,
    description TEXT,
    quantity INTEGER,
    invoice_date TIMESTAMP,
    unit_price DECIMAL(10,2),
    customer_id INTEGER,
    country TEXT
);


COPY retail(invoice_no, stock_code, description, quantity, invoice_date, unit_price, customer_id, country)
FROM '/path/to/online_retail.csv'
DELIMITER ';'
CSV HEADER
ON_ERROR CONTINUE;"
322;A;-1;Claude_4.5_Sonnet;1;1;"CREATE OR REPLACE TABLE retail (
    invoice_no INTEGER,
    stock_code TEXT,
    description TEXT,
    quantity INTEGER,
    invoice_date TIMESTAMP,
    unit_price DECIMAL(10,2),
    customer_id INTEGER,
    country TEXT
);

COPY INTO retail
FROM @your_stage/online_retail.csv
FILE_FORMAT = (TYPE = 'CSV' FIELD_DELIMITER = ';' SKIP_HEADER = 1)
ON_ERROR = 'CONTINUE';"
323;A;-1;Claude_4.5_Sonnet;2;1;"CREATE OR REPLACE TABLE retail (
    invoice_no INTEGER,
    stock_code TEXT,
    description TEXT,
    quantity INTEGER,
    invoice_date TIMESTAMP,
    unit_price DECIMAL(10,2),
    customer_id INTEGER,
    country TEXT
);

COPY INTO retail
FROM @your_stage/online_retail.csv
FILE_FORMAT = (TYPE = 'CSV' FIELD_DELIMITER = ';' SKIP_HEADER = 1)
ON_ERROR = 'CONTINUE';"
324;A;-1;Claude_4.5_Sonnet;3;1;"CREATE OR REPLACE TABLE retail (
    invoice_no INT,
    stock_code STRING,
    description STRING,
    quantity INT,
    invoice_date TIMESTAMP,
    unit_price DECIMAL(10, 2),
    customer_id INT,
    country STRING
);
COPY INTO retail
FROM @your_stage/online_retail.csv 
FILE_FORMAT = (TYPE = 'CSV' FIELD_DELIMITER = ';' HEADER = TRUE)
ON_ERROR = 'CONTINUE';"
325;B;-1;Claude_4.5_Sonnet;0;1;"CREATE OR REPLACE TABLE games (
    id INT,
    name STRING,
    platform STRING,
    year INT,
    genre STRING,
    publisher STRING,
    na_sales DECIMAL(10, 2),
    eu_sales DECIMAL(10, 2),
    jp_sales DECIMAL(10, 2),
    other_sales DECIMAL(10, 2),
    global_sales DECIMAL(10, 2)
);
COPY INTO games
FROM @your_stage/video_game_sales.csv 
FILE_FORMAT = (TYPE = 'CSV' FIELD_DELIMITER = ',' HEADER = TRUE)
ON_ERROR = 'CONTINUE';"
326;B;-1;Claude_4.5_Sonnet;1;1;"CREATE OR REPLACE TABLE games (
    id INT,
    name STRING,
    platform STRING,
    year INT,
    genre STRING,
    publisher STRING,
    na_sales DECIMAL(10, 2),
    eu_sales DECIMAL(10, 2),
    jp_sales DECIMAL(10, 2),
    other_sales DECIMAL(10, 2),
    global_sales DECIMAL(10, 2)
);

COPY INTO games
FROM @your_stage/video_game_sales.csv 
FILE_FORMAT = (TYPE = 'CSV' FIELD_DELIMITER = ',' HEADER = TRUE)
ON_ERROR = 'CONTINUE';"
327;B;-1;Claude_4.5_Sonnet;2;1;"CREATE OR REPLACE TABLE games (
    id INTEGER,
    name STRING,
    platform STRING,
    year INTEGER,
    genre STRING,
    publisher STRING,
    na_sales FLOAT,
    eu_sales FLOAT,
    jp_sales FLOAT,
    other_sales FLOAT,
    global_sales FLOAT
);

COPY INTO games
FROM @~/video_game_sales.csv
FILE_FORMAT = (
    TYPE = CSV
    FIELD_DELIMITER = ','
    SKIP_HEADER = 1
    ERROR_ON_COLUMN_COUNT_MISMATCH = FALSE
)
ON_ERROR = 'CONTINUE';"
328;B;-1;Claude_4.5_Sonnet;3;1;"CREATE OR REPLACE TABLE games(id INT,name STRING,platform STRING,year INT,genre STRING,publisher STRING,na_sales FLOAT,eu_sales FLOAT,jp_sales FLOAT,other_sales FLOAT,global_sales FLOAT);
COPY INTO games FROM @~/video_game_sales.csv FILE_FORMAT=(TYPE=CSV FIELD_DELIMITER=',' SKIP_HEADER=1 ERROR_ON_COLUMN_COUNT_MISMATCH=FALSE) ON_ERROR='CONTINUE';"
329;C;-1;Claude_4.5_Sonnet;0;1;"CREATE OR REPLACE TABLE eshop ( year INTEGER, month INTEGER, day INTEGER, order_no INTEGER, country STRING, session_id INTEGER, category STRING, clothing_model STRING, colour STRING, location STRING, model INTEGER, price INTEGER, page STRING ); COPY INTO eshop FROM @my_stage/eshop_clothing.csv FILE_FORMAT = ( TYPE = 'CSV' FIELD_DELIMITER = ';' SKIP_HEADER = 1 ) ON_ERROR = 'CONTINUE';"
330;C;-1;Claude_4.5_Sonnet;1;1;"CREATE OR REPLACE TABLE eshop (
    year INTEGER,
    month INTEGER,
    day INTEGER,
    order_no INTEGER,
    country STRING,
    session_id INTEGER,
    category STRING,
    clothing_model STRING,
    colour STRING,
    location STRING,
    model INTEGER,
    price INTEGER,
    page STRING
);

COPY INTO eshop
FROM @~/eshop_clothing.csv
FILE_FORMAT = (
    TYPE = 'CSV'
    FIELD_DELIMITER = ';'
    SKIP_HEADER = 1
)
ON_ERROR = 'CONTINUE';"
331;C;-1;Claude_4.5_Sonnet;2;1;"CREATE OR REPLACE TABLE eshop (
    year INTEGER,
    month INTEGER,
    day INTEGER,
    order_no INTEGER,
    country STRING,
    session_id INTEGER,
    category STRING,
    clothing_model STRING,
    colour STRING,
    location STRING,
    model INTEGER,
    price INTEGER,
    page STRING
);

COPY INTO eshop
FROM @~/eshop_clothing.csv
FILE_FORMAT = (
    TYPE = 'CSV'
    FIELD_DELIMITER = ';'
    SKIP_HEADER = 1
)
ON_ERROR = 'CONTINUE';"
332;C;-1;Claude_4.5_Sonnet;3;1;"CREATE OR REPLACE TABLE eshop(year INT,month INT,day INT,order_no INT,country STRING,session_id INT,category STRING,clothing_model STRING,colour STRING,location STRING,model INT,price INT,page STRING);
COPY INTO eshop FROM @~/eshop_clothing.csv FILE_FORMAT=(TYPE=CSV FIELD_DELIMITER=';' SKIP_HEADER=1 ERROR_ON_COLUMN_COUNT_MISMATCH=FALSE) ON_ERROR='CONTINUE';"
333;D;-1;Claude_4.5_Sonnet;0;1;"CREATE OR REPLACE TABLE sales (
    order_id STRING,
    order_date DATE,
    status STRING,
    fulfilment STRING,
    ship_service STRING,
    product STRING,
    category STRING,
    size STRING,
    courier_status STRING,
    quantity INTEGER,
    amount NUMBER(10, 2),
    ship_state STRING
);

COPY INTO sales
FROM @~/amazon_report.csv
FILE_FORMAT = (
    TYPE = 'CSV'
    FIELD_DELIMITER = ';'
    SKIP_HEADER = 1
)
ON_ERROR = 'CONTINUE';"
334;D;-1;Claude_4.5_Sonnet;1;1;"CREATE OR REPLACE TABLE sales (
    order_id STRING,
    order_date DATE,
    status STRING,
    fulfilment STRING,
    ship_service STRING,
    product STRING,
    category STRING,
    size STRING,
    courier_status STRING,
    quantity INTEGER,
    amount NUMBER(15,2),
    ship_state STRING
);

COPY INTO sales FROM @~/amazon_report.csv
FILE_FORMAT = (TYPE = 'CSV' FIELD_DELIMITER = ';' SKIP_HEADER = 1)
ON_ERROR = 'CONTINUE';"
335;D;-1;Claude_4.5_Sonnet;2;1;"CREATE OR REPLACE TABLE sales (
    order_id STRING, order_date DATE, status STRING, fulfilment STRING, ship_service STRING,
    product STRING, category STRING, size STRING, courier_status STRING, quantity INTEGER,
    amount NUMBER(15,2), ship_state STRING
);

COPY INTO sales FROM @~/amazon_report.csv
FILE_FORMAT = (TYPE = 'CSV' FIELD_DELIMITER = ';' SKIP_HEADER = 1)
ON_ERROR = 'CONTINUE';"
336;D;-1;Claude_4.5_Sonnet;3;1;"CREATE TABLE sales (order_id STRING, order_date DATE, status STRING, fulfilment STRING, ship_service STRING, product STRING, category STRING, size STRING, courier_status STRING, quantity INTEGER, amount NUMBER(15,2), ship_state STRING);
COPY INTO sales FROM @~/amazon_report.csv FILE_FORMAT=(TYPE=CSV FIELD_DELIMITER=';' SKIP_HEADER=1) ON_ERROR=CONTINUE;"
337;A;-1;Claude_4.5_Sonnet;0;2;"SELECT 
    customer_id,
    invoice_date,
    quantity * unit_price AS amount,
    SUM(quantity * unit_price) OVER (
        PARTITION BY customer_id 
        ORDER BY invoice_date 
        ROWS BETWEEN 13 PRECEDING AND CURRENT ROW
    ) AS rolling_14day_revenue
FROM retail
WHERE customer_id IS NOT NULL
ORDER BY customer_id, invoice_date;"
338;A;-1;Claude_4.5_Sonnet;1;2;"SELECT 
    customer_id,
    invoice_date,
    quantity * unit_price AS amount,
    SUM(quantity * unit_price) OVER (
        PARTITION BY customer_id 
        ORDER BY invoice_date 
        ROWS BETWEEN 13 PRECEDING AND CURRENT ROW
    ) AS rolling_14day_revenue
FROM retail
WHERE customer_id IS NOT NULL
ORDER BY customer_id, invoice_date;"
339;A;-1;Claude_4.5_Sonnet;2;2;"WITH customer_transactions AS (
    SELECT 
        customer_id,
        invoice_date,
        quantity * unit_price AS amount
    FROM retail
    WHERE customer_id IS NOT NULL
)
SELECT 
    customer_id,
    invoice_date,
    amount,
    SUM(amount) OVER (
        PARTITION BY customer_id 
        ORDER BY invoice_date 
        ROWS BETWEEN 13 PRECEDING AND CURRENT ROW
    ) AS rolling_14day_revenue
FROM customer_transactions
ORDER BY customer_id, invoice_date;"
340;A;-1;Claude_4.5_Sonnet;3;2;"SELECT customer_id, SUM(quantity * unit_price) AS total_revenue
FROM retail
WHERE invoice_date >= DATEADD(DAY, -14, CURRENT_TIMESTAMP())
GROUP BY customer_id;"
341;B;-1;Claude_4.5_Sonnet;0;2;"SELECT platform, year, SUM(global_sales) AS total_global_sales
FROM games
WHERE year >= YEAR(CURRENT_TIMESTAMP()) - 2
GROUP BY platform, year
ORDER BY platform, year;"
342;B;-1;Claude_4.5_Sonnet;1;2;"SELECT platform, year, SUM(global_sales) AS total_global_sales
FROM games
WHERE year >= YEAR(CURRENT_TIMESTAMP()) - 2
GROUP BY platform, year
ORDER BY platform, year;"
343;B;-1;Claude_4.5_Sonnet;2;2;"WITH ranked_years AS (
    SELECT DISTINCT year,
           ROW_NUMBER() OVER (ORDER BY year DESC) AS rn
    FROM games
    WHERE year IS NOT NULL
)
SELECT 
    g.platform,
    g.year,
    SUM(g.global_sales) AS total_global_sales
FROM games g
INNER JOIN ranked_years ry ON g.year = ry.year AND ry.rn <= 3
GROUP BY g.platform, g.year
ORDER BY g.platform, g.year;"
344;B;-1;Claude_4.5_Sonnet;3;2;"SELECT platform,year,SUM(global_sales) total_global_sales FROM games WHERE year IN(SELECT year FROM(SELECT DISTINCT year,ROW_NUMBER() OVER(ORDER BY year DESC) rn FROM games WHERE year IS NOT NULL)WHERE rn<=3)GROUP BY platform,year ORDER BY platform,year;"
345;C;-1;Claude_4.5_Sonnet;0;2;"SELECT 
    country,
    DATE_FROM_PARTS(year, month, day) AS order_date,
    SUM(price) AS daily_revenue,
    SUM(daily_revenue) OVER (
        PARTITION BY country 
        ORDER BY order_date 
        ROWS BETWEEN 6 PRECEDING AND CURRENT ROW
    ) AS rolling_7d_total
FROM eshop
GROUP BY country, order_date
ORDER BY country, order_date;"
346;C;-1;Claude_4.5_Sonnet;1;2;"SELECT 
    country,
    DATE_FROM_PARTS(year, month, day) AS order_date,
    SUM(price) AS daily_revenue,
    SUM(SUM(price)) OVER (
        PARTITION BY country 
        ORDER BY DATE_FROM_PARTS(year, month, day) 
        ROWS BETWEEN 6 PRECEDING AND CURRENT ROW
    ) AS rolling_7d_total
FROM eshop
GROUP BY country, order_date
ORDER BY country, order_date;"
347;C;-1;Claude_4.5_Sonnet;2;2;"WITH daily_revenue_cte AS (
    SELECT 
        country,
        DATE_FROM_PARTS(year, month, day) AS order_date,
        SUM(price) AS daily_price_sum
    FROM eshop
    GROUP BY country, order_date
)
SELECT 
    country,
    order_date,
    daily_price_sum,
    SUM(daily_price_sum) OVER (
        PARTITION BY country 
        ORDER BY order_date 
        ROWS BETWEEN 6 PRECEDING AND CURRENT ROW
    ) AS rolling_7d_revenue
FROM daily_revenue_cte
ORDER BY country, order_date;"
348;C;-1;Claude_4.5_Sonnet;3;2;"SELECT country,order_date,daily_revenue,SUM(daily_revenue) OVER(PARTITION BY country ORDER BY order_date ROWS BETWEEN 6 PRECEDING AND CURRENT ROW) rolling_7d FROM(SELECT country,DATE_FROM_PARTS(year,month,day) order_date,SUM(price) daily_revenue FROM eshop GROUP BY 1,2)ORDER BY country,order_date;"
349;D;-1;Claude_4.5_Sonnet;0;2;"WITH daily_sales AS (
    SELECT 
        ship_state,
        order_date,
        SUM(amount) AS daily_amount
    FROM sales
    GROUP BY ship_state, order_date
)
SELECT 
    ship_state,
    order_date,
    daily_amount,
    SUM(daily_amount) OVER (
        PARTITION BY ship_state 
        ORDER BY order_date 
        ROWS BETWEEN 7 PRECEDING AND 1 PRECEDING
    ) AS rolling_7d_previous_sum
FROM daily_sales
ORDER BY ship_state, order_date;"
350;D;-1;Claude_4.5_Sonnet;1;2;"SELECT ship_state, order_date, SUM(amount) AS daily_amount,
       SUM(SUM(amount)) OVER (PARTITION BY ship_state ORDER BY order_date ROWS BETWEEN 7 PRECEDING AND 1 PRECEDING) AS sum_7d_prev
FROM sales GROUP BY 1, 2 ORDER BY 1, 2;"
351;D;-1;Claude_4.5_Sonnet;2;2;"WITH DailySales AS (
    SELECT ship_state, order_date, SUM(amount) AS daily_amount
    FROM sales GROUP BY ship_state, order_date
)
SELECT ship_state, order_date, daily_amount,
       SUM(daily_amount) OVER (PARTITION BY ship_state ORDER BY order_date ROWS BETWEEN 7 PRECEDING AND 1 PRECEDING) AS rolling_7d_prev
FROM DailySales
ORDER BY ship_state, order_date;"
352;D;-1;Claude_4.5_Sonnet;3;2;"SELECT ship_state, order_date, SUM(amount) amt, SUM(SUM(amount)) OVER (PARTITION BY ship_state ORDER BY order_date ROWS BETWEEN 7 PRECEDING AND 1 PRECEDING) FROM sales GROUP BY 1,2;"
353;A;-1;Claude_4.5_Sonnet;0;3;"SELECT 
    customer_id,
    invoice_date,
    LEAD(invoice_date) OVER (
        PARTITION BY customer_id 
        ORDER BY invoice_date
    ) AS next_order_date,
    LEAD(invoice_date) OVER (
        PARTITION BY customer_id 
        ORDER BY invoice_date
    ) - invoice_date AS days_to_next_order
FROM retail
WHERE customer_id IS NOT NULL
    AND quantity > 0
ORDER BY days_to_next_order DESC NULLS LAST;"
354;A;-1;Claude_4.5_Sonnet;1;3;"SELECT 
    customer_id,
    invoice_date,
    LEAD(invoice_date) OVER (
        PARTITION BY customer_id 
        ORDER BY invoice_date
    ) AS next_order_date,
    DATEDIFF(day, invoice_date, LEAD(invoice_date) OVER (
        PARTITION BY customer_id 
        ORDER BY invoice_date
    )) AS days_to_next_order
FROM retail
WHERE customer_id IS NOT NULL
    AND quantity > 0
ORDER BY days_to_next_order DESC NULLS LAST;"
355;A;-1;Claude_4.5_Sonnet;2;3;"WITH valid_orders AS (
    SELECT 
        customer_id,
        invoice_date
    FROM retail
    WHERE customer_id IS NOT NULL
        AND quantity > 0
),
orders_with_next AS (
    SELECT 
        customer_id,
        invoice_date,
        LEAD(invoice_date) OVER (
            PARTITION BY customer_id 
            ORDER BY invoice_date
        ) AS next_order_date
    FROM valid_orders
)
SELECT 
    customer_id,
    invoice_date,
    next_order_date,
    DATEDIFF(day, invoice_date, next_order_date) AS days_to_next_order
FROM orders_with_next
WHERE next_order_date IS NOT NULL
ORDER BY days_to_next_order DESC;"
356;A;-1;Claude_4.5_Sonnet;3;3;"SELECT customer_id, 
       LEAD(invoice_date) OVER (PARTITION BY customer_id ORDER BY invoice_date) - invoice_date AS days_until_next_order
FROM retail
WHERE quantity > 0
ORDER BY days_until_next_order DESC;"
357;B;-1;Claude_4.5_Sonnet;0;3;"SELECT genre, year, 
       SUM(global_sales) - LAG(SUM(global_sales)) OVER (PARTITION BY genre ORDER BY year) AS sales_difference
FROM games
GROUP BY genre, year
ORDER BY genre, year;"
358;B;-1;Claude_4.5_Sonnet;1;3;"SELECT genre, year, 
       SUM(global_sales) - LAG(SUM(global_sales)) OVER (PARTITION BY genre ORDER BY year) AS sales_difference
FROM games
GROUP BY genre, year
ORDER BY genre, year;"
359;B;-1;Claude_4.5_Sonnet;2;3;"SELECT 
    genre,
    year,
    total_sales,
    total_sales - LAG(total_sales, 1, 0) OVER (PARTITION BY genre ORDER BY year) AS sales_diff
FROM (
    SELECT 
        genre,
        year,
        SUM(global_sales) AS total_sales
    FROM games
    WHERE year IS NOT NULL
    GROUP BY genre, year
)
ORDER BY genre, year;"
360;B;-1;Claude_4.5_Sonnet;3;3;"SELECT genre,year,total_sales,total_sales-LAG(total_sales) OVER(PARTITION BY genre ORDER BY year) diff FROM(SELECT genre,year,SUM(global_sales) total_sales FROM games GROUP BY genre,year HAVING year IS NOT NULL)ORDER BY genre,year;"
361;C;-1;Claude_4.5_Sonnet;0;3;"SELECT 
    clothing_model,
    DATE_FROM_PARTS(year, month, day) AS order_date,
    price,
    LAG(price) OVER (PARTITION BY clothing_model ORDER BY order_date) AS prev_price,
    (price - prev_price) AS price_change
FROM eshop
ORDER BY clothing_model, order_date;"
362;C;-1;Claude_4.5_Sonnet;1;3;"SELECT 
    clothing_model,
    DATE_FROM_PARTS(year, month, day) AS order_date,
    price,
    LAG(price) OVER (PARTITION BY clothing_model ORDER BY DATE_FROM_PARTS(year, month, day)) AS previous_price,
    (price - previous_price) AS price_diff
FROM eshop
ORDER BY clothing_model, order_date;"
363;C;-1;Claude_4.5_Sonnet;2;3;"WITH model_prices AS (
    SELECT 
        clothing_model,
        DATE_FROM_PARTS(year, month, day) AS order_date,
        price
    FROM eshop
)
SELECT 
    clothing_model,
    order_date,
    price,
    LAG(price) OVER (PARTITION BY clothing_model ORDER BY order_date) AS previous_price,
    (price - previous_price) AS price_difference
FROM model_prices
ORDER BY clothing_model, order_date;"
364;C;-1;Claude_4.5_Sonnet;3;3;"SELECT clothing_model,order_date,price,price-LAG(price) OVER(PARTITION BY clothing_model ORDER BY order_date) price_change FROM(SELECT clothing_model,DATE_FROM_PARTS(year,month,day) order_date,price FROM eshop)ORDER BY clothing_model,order_date;"
365;D;-1;Claude_4.5_Sonnet;0;3;"SELECT 
    ship_state,
    order_id,
    order_date,
    LEAD(order_date) OVER (PARTITION BY ship_state ORDER BY order_date) AS next_order_date,
    DATEDIFF('day', order_date, next_order_date) AS days_difference
FROM sales
ORDER BY days_difference DESC NULLS LAST;"
366;D;-1;Claude_4.5_Sonnet;1;3;"SELECT ship_state, order_id, order_date,
       DATEDIFF('day', order_date, LEAD(order_date) OVER (PARTITION BY ship_state ORDER BY order_date)) AS days_diff
FROM sales ORDER BY days_diff DESC NULLS LAST;"
367;D;-1;Claude_4.5_Sonnet;2;3;"WITH DeliverySequence AS (
    SELECT ship_state, order_id, order_date,
           LEAD(order_date) OVER (PARTITION BY ship_state ORDER BY order_date) AS next_shipment_date
    FROM sales
)
SELECT ship_state, order_id, order_date, next_shipment_date,
       DATEDIFF('day', order_date, next_shipment_date) AS days_later
FROM DeliverySequence
ORDER BY days_later DESC NULLS LAST;"
368;D;-1;Claude_4.5_Sonnet;3;3;"SELECT *, DATEDIFF(day, order_date, LEAD(order_date) OVER(PARTITION BY ship_state ORDER BY order_date)) diff FROM sales ORDER BY diff DESC;"
369;A;-1;Claude_4.5_Sonnet;0;4;"SELECT 
    customer_id,
    SUM(quantity * unit_price) AS total_amount,
    NTILE(4) OVER (ORDER BY SUM(quantity * unit_price) DESC) AS quartile
FROM retail
WHERE customer_id IS NOT NULL
GROUP BY customer_id
ORDER BY total_amount DESC;"
370;A;-1;Claude_4.5_Sonnet;1;4;"SELECT 
    customer_id,
    SUM(quantity * unit_price) AS total_amount,
    NTILE(4) OVER (ORDER BY SUM(quantity * unit_price) DESC) AS quartile
FROM retail
WHERE customer_id IS NOT NULL
GROUP BY customer_id
ORDER BY total_amount DESC;"
371;A;-1;Claude_4.5_Sonnet;2;4;"WITH customer_total_revenue AS (
    SELECT 
        customer_id,
        SUM(quantity * unit_price) AS total_amount
    FROM retail
    WHERE customer_id IS NOT NULL
    GROUP BY customer_id
)
SELECT 
    customer_id,
    total_amount,
    NTILE(4) OVER (ORDER BY total_amount DESC) AS quartile
FROM customer_total_revenue
ORDER BY total_amount DESC;"
372;A;-1;Claude_4.5_Sonnet;3;4;"WITH customer_revenue AS (
    SELECT customer_id, SUM(quantity * unit_price) AS total_amount
    FROM retail
    GROUP BY customer_id
)
SELECT customer_id, total_amount,
       NTILE(4) OVER (ORDER BY total_amount DESC) AS revenue_quartile
FROM customer_revenue
ORDER BY total_amount DESC;"
373;B;-1;Claude_4.5_Sonnet;0;4;"WITH sales_ranked AS (
    SELECT *, NTILE(4) OVER (PARTITION BY year ORDER BY global_sales DESC) AS sales_quartile
    FROM games
)
SELECT year, name, global_sales, sales_quartile
FROM sales_ranked
ORDER BY year DESC;"
374;B;-1;Claude_4.5_Sonnet;1;4;"WITH sales_ranked AS (
    SELECT *, NTILE(4) OVER (PARTITION BY year ORDER BY global_sales DESC) AS sales_quartile
    FROM games
)
SELECT year, name, global_sales, sales_quartile
FROM sales_ranked
ORDER BY year DESC;"
375;B;-1;Claude_4.5_Sonnet;2;4;"SELECT 
    name,
    platform,
    year,
    global_sales,
    NTILE(4) OVER (PARTITION BY year ORDER BY global_sales DESC NULLS LAST) AS quartile
FROM games
WHERE year IS NOT NULL
ORDER BY year DESC, global_sales DESC;"
376;B;-1;Claude_4.5_Sonnet;3;4;"SELECT name,platform,year,global_sales,NTILE(4) OVER(PARTITION BY year ORDER BY global_sales DESC) quartile FROM games WHERE year IS NOT NULL ORDER BY year DESC,global_sales DESC;"
377;C;-1;Claude_4.5_Sonnet;0;4;"WITH category_sales AS (
    SELECT 
        category,
        SUM(price) AS total_revenue
    FROM eshop
    GROUP BY category
)
SELECT 
    category,
    total_revenue,
    NTILE(4) OVER (ORDER BY total_revenue DESC) AS quartile
FROM category_sales
ORDER BY quartile;"
378;C;-1;Claude_4.5_Sonnet;1;4;"SELECT 
    category,
    SUM(price) AS total_revenue,
    NTILE(4) OVER (ORDER BY SUM(price) DESC) AS quartile
FROM eshop
GROUP BY category
ORDER BY quartile;"
379;C;-1;Claude_4.5_Sonnet;2;4;"WITH category_totals AS (
    SELECT 
        category,
        SUM(price) AS total_revenue
    FROM eshop
    GROUP BY category
)
SELECT 
    category,
    total_revenue,
    NTILE(4) OVER (ORDER BY total_revenue DESC) AS revenue_quartile
FROM category_totals
ORDER BY revenue_quartile;"
380;C;-1;Claude_4.5_Sonnet;3;4;"SELECT category,SUM(price) revenue,NTILE(4) OVER(ORDER BY SUM(price) DESC) quartile FROM eshop GROUP BY category ORDER BY quartile,SUM(price) DESC;"
381;D;-1;Claude_4.5_Sonnet;0;4;"WITH state_revenue AS (
    SELECT 
        ship_state,
        SUM(amount) AS total_revenue
    FROM sales
    GROUP BY ship_state
)
SELECT 
    ship_state,
    total_revenue,
    NTILE(4) OVER (ORDER BY total_revenue DESC) AS revenue_quartile
FROM state_revenue
ORDER BY revenue_quartile;"
382;D;-1;Claude_4.5_Sonnet;1;4;"SELECT ship_state, SUM(amount) AS total_amount,
       NTILE(4) OVER (ORDER BY SUM(amount) DESC) AS revenue_quartile
FROM sales GROUP BY 1 ORDER BY revenue_quartile;"
383;D;-1;Claude_4.5_Sonnet;2;4;"WITH StateTotals AS (
    SELECT ship_state, SUM(amount) AS total_amount
    FROM sales GROUP BY ship_state
)
SELECT ship_state, total_amount,
       NTILE(4) OVER (ORDER BY total_amount DESC) AS quartile
FROM StateTotals
ORDER BY total_amount DESC;"
384;D;-1;Claude_4.5_Sonnet;3;4;"SELECT ship_state, SUM(amount) total, NTILE(4) OVER(ORDER BY total DESC) FROM sales GROUP BY 1;"
385;A;-1;Claude_4.5_Sonnet;0;5;"SELECT 
    customer_id,
    invoice_no,
    invoice_date,
    stock_code,
    description,
    quantity,
    unit_price,
    country
FROM (
    SELECT 
        *,
        ROW_NUMBER() OVER (
            PARTITION BY customer_id 
            ORDER BY invoice_date
        ) AS rn
    FROM retail
    WHERE customer_id IS NOT NULL
) AS ranked
WHERE rn = 1
ORDER BY customer_id;"
386;A;-1;Claude_4.5_Sonnet;1;5;"SELECT 
    customer_id,
    invoice_no,
    invoice_date,
    stock_code,
    description,
    quantity,
    unit_price,
    country
FROM (
    SELECT 
        *,
        ROW_NUMBER() OVER (
            PARTITION BY customer_id 
            ORDER BY invoice_date
        ) AS rn
    FROM retail
    WHERE customer_id IS NOT NULL
) AS ranked
WHERE rn = 1
ORDER BY customer_id;"
387;A;-1;Claude_4.5_Sonnet;2;5;"WITH ranked_purchases AS (
    SELECT 
        customer_id,
        invoice_no,
        invoice_date,
        stock_code,
        description,
        quantity,
        unit_price,
        country,
        ROW_NUMBER() OVER (
            PARTITION BY customer_id 
            ORDER BY invoice_date
        ) AS purchase_rank
    FROM retail
    WHERE customer_id IS NOT NULL
)
SELECT 
    customer_id,
    invoice_no,
    invoice_date,
    stock_code,
    description,
    quantity,
    unit_price,
    country
FROM ranked_purchases
WHERE purchase_rank = 1
ORDER BY customer_id;"
388;A;-1;Claude_4.5_Sonnet;3;5;"SELECT customer_id, MIN(invoice_date) AS first_purchase
FROM retail
GROUP BY customer_id
ORDER BY customer_id;"
389;B;-1;Claude_4.5_Sonnet;0;5;"SELECT publisher, name, year, eu_sales,
       ROW_NUMBER() OVER (PARTITION BY publisher, year ORDER BY eu_sales DESC) AS rank
FROM games
WHERE rank <= 3
ORDER BY publisher, year, rank;"
390;B;-1;Claude_4.5_Sonnet;1;5;"SELECT publisher, name, year, eu_sales,
       ROW_NUMBER() OVER (PARTITION BY publisher, year ORDER BY eu_sales DESC) AS rank
FROM games
WHERE rank <= 3
ORDER BY publisher, year, rank;"
391;B;-1;Claude_4.5_Sonnet;2;5;"SELECT 
    publisher,
    year,
    name,
    eu_sales,
    ROW_NUMBER() OVER (PARTITION BY publisher, year ORDER BY eu_sales DESC NULLS LAST) AS game_rank
FROM games
WHERE year IS NOT NULL
QUALIFY game_rank <= 3
ORDER BY publisher, year, game_rank;"
392;B;-1;Claude_4.5_Sonnet;3;5;"SELECT publisher,year,name,eu_sales,ROW_NUMBER() OVER(PARTITION BY publisher,year ORDER BY eu_sales DESC) game_rank FROM games WHERE year IS NOT NULL QUALIFY game_rank<=3 ORDER BY publisher,year,game_rank;"
393;C;-1;Claude_4.5_Sonnet;0;5;"SELECT * FROM (
    SELECT 
        country,
        clothing_model,
        SUM(price) AS model_revenue,
        RANK() OVER (PARTITION BY country ORDER BY SUM(price) DESC) as rank
    FROM eshop
    GROUP BY country, clothing_model
)
WHERE rank <= 3
ORDER BY country, rank;"
394;C;-1;Claude_4.5_Sonnet;1;5;"SELECT * FROM (
    SELECT 
        country,
        clothing_model,
        SUM(price) AS model_revenue,
        ROW_NUMBER() OVER (PARTITION BY country ORDER BY SUM(price) DESC) as rank
    FROM eshop
    GROUP BY country, clothing_model
)
WHERE rank <= 3
ORDER BY country, rank;"
395;C;-1;Claude_4.5_Sonnet;2;5;"WITH model_revenue_per_country AS (
    SELECT 
        country,
        clothing_model,
        SUM(price) AS total_model_revenue
    FROM eshop
    GROUP BY country, clothing_model
),
ranked_models AS (
    SELECT 
        country,
        clothing_model,
        total_model_revenue,
        ROW_NUMBER() OVER (PARTITION BY country ORDER BY total_model_revenue DESC) AS rank
    FROM model_revenue_per_country
)
SELECT * FROM ranked_models 
WHERE rank <= 3
ORDER BY country, rank;"
396;C;-1;Claude_4.5_Sonnet;3;5;"SELECT country,clothing_model,SUM(price) total_price,ROW_NUMBER() OVER(PARTITION BY country ORDER BY SUM(price) DESC) rnk FROM eshop GROUP BY country,clothing_model QUALIFY rnk<=3 ORDER BY country,rnk;"
397;D;-1;Claude_4.5_Sonnet;0;5;"WITH product_ranking AS (
    SELECT 
        ship_state,
        product,
        SUM(amount) AS product_revenue,
        ROW_NUMBER() OVER (PARTITION BY ship_state ORDER BY SUM(amount) DESC) AS rank
    FROM sales
    WHERE amount IS NOT NULL
    GROUP BY ship_state, product
)
SELECT * FROM product_ranking 
WHERE rank <= 5
ORDER BY ship_state, rank;"
398;D;-1;Claude_4.5_Sonnet;1;5;"SELECT * FROM (
    SELECT ship_state, product, SUM(amount) AS prod_revenue,
           ROW_NUMBER() OVER (PARTITION BY ship_state ORDER BY SUM(amount) DESC) AS rank
    FROM sales WHERE amount IS NOT NULL GROUP BY 1, 2
) WHERE rank <= 5 ORDER BY ship_state;"
399;D;-1;Claude_4.5_Sonnet;2;5;"WITH ProductRevenue AS (
    SELECT ship_state, product, SUM(amount) AS revenue
    FROM sales WHERE amount IS NOT NULL GROUP BY ship_state, product
),
RankedProducts AS (
    SELECT ship_state, product, revenue,
           ROW_NUMBER() OVER (PARTITION BY ship_state ORDER BY revenue DESC) AS product_rank
    FROM ProductRevenue
)
SELECT * FROM RankedProducts WHERE product_rank <= 5;"
400;D;-1;Claude_4.5_Sonnet;3;5;"SELECT * FROM (SELECT ship_state, product, SUM(amount) r, ROW_NUMBER() OVER(PARTITION BY ship_state ORDER BY r DESC) rn FROM sales WHERE amount IS NOT NULL GROUP BY 1,2) WHERE rn<=5;"
401;A;-1;Claude_4.5_Sonnet;0;6;"SELECT 
    country,
    month,
    customer_id,
    monthly_amount,
    rank
FROM (
    SELECT 
        country,
        DATE_TRUNC('month', invoice_date) AS month,
        customer_id,
        SUM(quantity * unit_price) AS monthly_amount,
        ROW_NUMBER() OVER (
            PARTITION BY country, DATE_TRUNC('month', invoice_date)
            ORDER BY SUM(quantity * unit_price) DESC
        ) AS rank
    FROM retail
    WHERE customer_id IS NOT NULL
    GROUP BY country, DATE_TRUNC('month', invoice_date), customer_id
) AS ranked
WHERE rank <= 5
ORDER BY country, month, rank, customer_id;"
402;A;-1;Claude_4.5_Sonnet;1;6;"SELECT 
    country,
    month,
    customer_id,
    monthly_amount,
    rank
FROM (
    SELECT 
        country,
        DATE_TRUNC('MONTH', invoice_date) AS month,
        customer_id,
        SUM(quantity * unit_price) AS monthly_amount,
        ROW_NUMBER() OVER (
            PARTITION BY country, DATE_TRUNC('MONTH', invoice_date)
            ORDER BY SUM(quantity * unit_price) DESC
        ) AS rank
    FROM retail
    WHERE customer_id IS NOT NULL
    GROUP BY country, DATE_TRUNC('MONTH', invoice_date), customer_id
) AS ranked
WHERE rank <= 5
ORDER BY country, month, rank, customer_id;"
403;A;-1;Claude_4.5_Sonnet;2;6;"WITH monthly_customer_revenue AS (
    SELECT 
        country,
        DATE_TRUNC('MONTH', invoice_date) AS month,
        customer_id,
        SUM(quantity * unit_price) AS monthly_amount
    FROM retail
    WHERE customer_id IS NOT NULL
    GROUP BY country, DATE_TRUNC('MONTH', invoice_date), customer_id
),
ranked_customers AS (
    SELECT 
        country,
        month,
        customer_id,
        monthly_amount,
        ROW_NUMBER() OVER (
            PARTITION BY country, month
            ORDER BY monthly_amount DESC
        ) AS rank
    FROM monthly_customer_revenue
)
SELECT 
    country,
    month,
    customer_id,
    monthly_amount,
    rank
FROM ranked_customers
WHERE rank <= 5
ORDER BY country, month, rank, customer_id;"
404;A;-1;Claude_4.5_Sonnet;3;6;"SELECT country, customer_id, EXTRACT(YEAR FROM invoice_date) AS year, EXTRACT(MONTH FROM invoice_date) AS month,
       SUM(quantity * unit_price) AS monthly_revenue,
       ROW_NUMBER() OVER (PARTITION BY country, year, month ORDER BY SUM(quantity * unit_price) DESC) AS rank
FROM retail
GROUP BY country, customer_id, year, month
HAVING rank <= 5
ORDER BY country, year, month, rank, customer_id;"
405;B;-1;Claude_4.5_Sonnet;0;6;"SELECT genre, year, SUM(na_sales) AS total_na_sales,
       ROW_NUMBER() OVER (PARTITION BY genre ORDER BY SUM(na_sales) DESC) AS rank
FROM games
GROUP BY genre, year
HAVING rank <= 3
ORDER BY genre;"
406;B;-1;Claude_4.5_Sonnet;1;6;"SELECT genre, year, SUM(na_sales) AS total_na_sales,
       ROW_NUMBER() OVER (PARTITION BY genre ORDER BY SUM(na_sales) DESC) AS rank
FROM games
GROUP BY genre, year
HAVING rank <= 3
ORDER BY genre;"
407;B;-1;Claude_4.5_Sonnet;2;6;"WITH yearly_sales AS (
    SELECT 
        genre,
        year,
        SUM(na_sales) AS total_na_sales
    FROM games
    WHERE year IS NOT NULL
    GROUP BY genre, year
),
ranked_years AS (
    SELECT 
        *,
        ROW_NUMBER() OVER (PARTITION BY genre ORDER BY total_na_sales DESC) AS rnk
    FROM yearly_sales
)
SELECT 
    genre,
    year,
    total_na_sales
FROM ranked_years
WHERE rnk <= 3
ORDER BY genre, rnk;"
408;B;-1;Claude_4.5_Sonnet;3;6;"SELECT genre,year,SUM(na_sales) total_na_sales,ROW_NUMBER() OVER(PARTITION BY genre ORDER BY SUM(na_sales) DESC) rnk FROM games WHERE year IS NOT NULL GROUP BY genre,year QUALIFY rnk<=3 ORDER BY genre,rnk;"
409;C;-1;Claude_4.5_Sonnet;0;6;"WITH daily_cat_revenue AS (
    SELECT 
        country,
        DATE_FROM_PARTS(year, month, day) AS order_date,
        category,
        SUM(price) AS total_price
    FROM eshop
    GROUP BY 1, 2, 3
),
ranked_categories AS (
    SELECT 
        *,
        RANK() OVER (PARTITION BY country, order_date ORDER BY total_price DESC) as rank
    FROM daily_cat_revenue
)
SELECT * FROM ranked_categories
WHERE rank <= 3
ORDER BY country, order_date;"
410;C;-1;Claude_4.5_Sonnet;1;6;"SELECT * FROM (
    SELECT 
        country,
        DATE_FROM_PARTS(year, month, day) AS order_date,
        category,
        SUM(price) AS daily_cat_revenue,
        RANK() OVER (PARTITION BY country, DATE_FROM_PARTS(year, month, day) ORDER BY SUM(price) DESC) as rank
    FROM eshop
    GROUP BY country, order_date, category
)
WHERE rank <= 3
ORDER BY country, order_date, rank;"
411;C;-1;Claude_4.5_Sonnet;2;6;"WITH daily_category_sales AS (
    SELECT 
        country,
        DATE_FROM_PARTS(year, month, day) AS order_date,
        category,
        SUM(price) AS total_daily_price
    FROM eshop
    GROUP BY country, order_date, category
),
category_ranking AS (
    SELECT 
        country,
        order_date,
        category,
        total_daily_price,
        RANK() OVER (PARTITION BY country, order_date ORDER BY total_daily_price DESC) AS category_rank
    FROM daily_category_sales
)
SELECT * FROM category_ranking 
WHERE category_rank <= 3
ORDER BY country, order_date;"
412;C;-1;Claude_4.5_Sonnet;3;6;"SELECT country,order_date,category,sum_price,DENSE_RANK() OVER(PARTITION BY country,order_date ORDER BY sum_price DESC) rnk FROM(SELECT country,DATE_FROM_PARTS(year,month,day) order_date,category,SUM(price) sum_price FROM eshop GROUP BY 1,2,3)QUALIFY rnk<=3 ORDER BY country,order_date;"
413;D;-1;Claude_4.5_Sonnet;0;6;"WITH daily_state_ranking AS (
    SELECT 
        order_date,
        ship_state,
        SUM(amount) AS total_amount,
        RANK() OVER (PARTITION BY order_date ORDER BY SUM(amount) DESC) AS rank
    FROM sales
    GROUP BY order_date, ship_state
)
SELECT * FROM daily_state_ranking 
WHERE rank <= 3
ORDER BY order_date, rank;"
414;D;-1;Claude_4.5_Sonnet;1;6;"SELECT * FROM (
    SELECT order_date, ship_state, SUM(amount) AS daily_revenue,
           RANK() OVER (PARTITION BY order_date ORDER BY SUM(amount) DESC) AS rank
    FROM sales GROUP BY 1, 2
) WHERE rank <= 3 ORDER BY order_date;"
415;D;-1;Claude_4.5_Sonnet;2;6;"WITH DailyStateTotals AS (
    SELECT order_date, ship_state, SUM(amount) AS daily_amount
    FROM sales GROUP BY order_date, ship_state
),
RankedStates AS (
    SELECT order_date, ship_state, daily_amount,
           RANK() OVER (PARTITION BY order_date ORDER BY daily_amount DESC) AS state_rank
    FROM DailyStateTotals
)
SELECT * FROM RankedStates WHERE state_rank <= 3 ORDER BY order_date;"
416;D;-1;Claude_4.5_Sonnet;3;6;"SELECT * FROM (SELECT order_date, ship_state, SUM(amount) a, RANK() OVER(PARTITION BY order_date ORDER BY a DESC) r FROM sales GROUP BY 1,2) WHERE r<=3;"
417;A;-1;Claude_4.5_Sonnet;0;7;"CREATE TABLE cities_pop (
    data VARIANT
);


COPY INTO cities_pop
FROM '@stage/cities_population.json'
FILE_FORMAT = (TYPE = 'JSON');"
418;A;-1;Claude_4.5_Sonnet;1;7;"CREATE OR REPLACE TABLE cities_pop (
    data VARIANT
);

COPY INTO cities_pop
FROM @your_stage/cities_population.json
FILE_FORMAT = (TYPE = 'JSON');"
419;A;-1;Claude_4.5_Sonnet;2;7;"CREATE OR REPLACE TABLE cities_pop (
    data VARIANT
);

COPY INTO cities_pop
FROM @your_stage/cities_population.json
FILE_FORMAT = (TYPE = 'JSON');"
420;A;-1;Claude_4.5_Sonnet;3;7;"CREATE OR REPLACE TABLE cities_pop (data VARIANT);
COPY INTO cities_pop
FROM @your_stage/cities_population.json 
FILE_FORMAT = (TYPE = 'JSON');"
421;B;-1;Claude_4.5_Sonnet;0;7;"CREATE OR REPLACE TABLE house_price (data VARIANT);
COPY INTO house_price
FROM @your_stage/house_price.parquet 
FILE_FORMAT = (TYPE = 'PARQUET');"
422;B;-1;Claude_4.5_Sonnet;1;7;"CREATE OR REPLACE TABLE house_price (data VARIANT);

COPY INTO house_price
FROM @your_stage/house_price.parquet 
FILE_FORMAT = (TYPE = 'PARQUET');"
423;B;-1;Claude_4.5_Sonnet;2;7;"CREATE OR REPLACE TABLE house_price (
    data VARIANT
);

COPY INTO house_price
FROM @~/house_price.json
FILE_FORMAT = (TYPE = JSON)
ON_ERROR = 'CONTINUE';"
424;B;-1;Claude_4.5_Sonnet;3;7;"CREATE OR REPLACE TABLE house_price(data VARIANT);
COPY INTO house_price FROM @~/house_price.json FILE_FORMAT=(TYPE=JSON) ON_ERROR='CONTINUE';"
425;C;-1;Claude_4.5_Sonnet;0;7;"CREATE OR REPLACE TABLE forbes (
    data VARIANT
);

COPY INTO forbes
FROM @my_stage/forbes.json
FILE_FORMAT = (TYPE = 'JSON');"
426;C;-1;Claude_4.5_Sonnet;1;7;"CREATE OR REPLACE TABLE forbes (
    data VARIANT
);

COPY INTO forbes
FROM @~/forbes.json
FILE_FORMAT = (TYPE = 'JSON');"
427;C;-1;Claude_4.5_Sonnet;2;7;"CREATE OR REPLACE TABLE forbes (
    data VARIANT
);

COPY INTO forbes
FROM @~/forbes.json
FILE_FORMAT = (TYPE = 'JSON');"
428;C;-1;Claude_4.5_Sonnet;3;7;"CREATE OR REPLACE TABLE forbes(data VARIANT);
COPY INTO forbes FROM @~/forbes.json FILE_FORMAT=(TYPE=JSON) ON_ERROR='CONTINUE';"
429;D;-1;Claude_4.5_Sonnet;0;7;"CREATE OR REPLACE TABLE weather (
    data VARIANT
);

COPY INTO weather
FROM @~/weather.parquet
FILE_FORMAT = (TYPE = 'PARQUET');"
430;D;-1;Claude_4.5_Sonnet;1;7;"CREATE OR REPLACE TABLE weather (data VARIANT);
COPY INTO weather FROM @~/weather.parquet FILE_FORMAT = (TYPE = 'PARQUET');"
431;D;-1;Claude_4.5_Sonnet;2;7;"CREATE OR REPLACE TABLE weather (data VARIANT);
COPY INTO weather FROM @~/weather.parquet FILE_FORMAT = (TYPE = 'PARQUET');"
432;D;-1;Claude_4.5_Sonnet;3;7;"CREATE TABLE weather (data VARIANT);
COPY INTO weather FROM @~/weather.parquet FILE_FORMAT=(TYPE=PARQUET);"
433;A;-1;Claude_4.5_Sonnet;0;8;"SELECT 
    data:city::STRING AS city,
    data:rank::INTEGER AS rank,
    data:country::STRING AS country
FROM cities_pop
WHERE data:country::STRING = 'India'
ORDER BY data:rank::INTEGER;"
434;A;-1;Claude_4.5_Sonnet;1;8;"SELECT 
    data:city::STRING AS city,
    data:rank::INTEGER AS rank,
    data:country::STRING AS country
FROM cities_pop
WHERE data:country::STRING = 'India'
ORDER BY data:rank::INTEGER;"
435;A;-1;Claude_4.5_Sonnet;2;8;"WITH indian_cities AS (
    SELECT 
        data:city::STRING AS city,
        data:rank::INTEGER AS rank,
        data:country::STRING AS country
    FROM cities_pop
    WHERE data:country::STRING = 'India'
)
SELECT 
    city,
    rank,
    country
FROM indian_cities
ORDER BY rank;"
436;A;-1;Claude_4.5_Sonnet;3;8;"SELECT data:city AS city, data:rank AS rank
FROM cities_pop
WHERE data:country = 'India'
ORDER BY data:rank;"
437;B;-1;Claude_4.5_Sonnet;0;8;"SELECT AVG(data:price::FLOAT) AS average_price, 
       MEDIAN(data:price::FLOAT) AS median_price
FROM house_price
WHERE data:price IS NOT NULL;"
438;B;-1;Claude_4.5_Sonnet;1;8;"SELECT AVG(data:price::FLOAT) AS average_price, 
       MEDIAN(data:price::FLOAT) AS median_price
FROM house_price
WHERE data:price IS NOT NULL;"
439;B;-1;Claude_4.5_Sonnet;2;8;"SELECT 
    ROUND(AVG(price), 2) AS avg_price,
    PERCENTILE_CONT(0.5) WITHIN GROUP (ORDER BY price) AS median_price
FROM (
    SELECT data:price::FLOAT AS price
    FROM house_price,
    LATERAL FLATTEN(INPUT => data)
    WHERE data:price IS NOT NULL
      AND TRY_TO_DOUBLE(data:price) IS NOT NULL
);"
440;B;-1;Claude_4.5_Sonnet;3;8;"SELECT ROUND(AVG(data:price::FLOAT),2) avg_price,PERCENTILE_CONT(0.5) WITHIN GROUP(ORDER BY data:price::FLOAT) median_price FROM house_price WHERE data:price IS NOT NULL;"
441;C;-1;Claude_4.5_Sonnet;0;8;"SELECT 
    data:personName::STRING as name,
    data:finalWorth::NUMBER as current_worth,
    data:countryOfCitizenship::STRING as country
FROM forbes
WHERE country = 'United States'
ORDER BY current_worth DESC;"
442;C;-1;Claude_4.5_Sonnet;1;8;"SELECT 
    data:personName::STRING AS name,
    data:finalWorth::NUMBER AS current_worth
FROM forbes
WHERE data:countryOfCitizenship::STRING = 'United States'
ORDER BY current_worth DESC;"
443;C;-1;Claude_4.5_Sonnet;2;8;"SELECT 
    data:personName::STRING AS name,
    data:finalWorth::NUMBER AS current_worth,
    data:countryOfCitizenship::STRING AS citizenship
FROM forbes
WHERE citizenship = 'United States'
ORDER BY current_worth DESC;"
444;C;-1;Claude_4.5_Sonnet;3;8;"SELECT data:name::STRING name,data:current_worth::INT worth FROM forbes WHERE data:country::STRING='United States' ORDER BY worth DESC;"
445;D;-1;Claude_4.5_Sonnet;0;8;"SELECT 
    AVG(data:MaxTemp::FLOAT) AS avg_max_temp,
    MEDIAN(data:MaxTemp::FLOAT) AS median_max_temp,
    AVG(data:MinTemp::FLOAT) AS avg_min_temp,
    MEDIAN(data:MinTemp::FLOAT) AS median_min_temp
FROM weather;"
446;D;-1;Claude_4.5_Sonnet;1;8;"SELECT AVG(data:MaxTemp::FLOAT), MEDIAN(data:MaxTemp::FLOAT),
       AVG(data:MinTemp::FLOAT), MEDIAN(data:MinTemp::FLOAT)
FROM weather;"
447;D;-1;Claude_4.5_Sonnet;2;8;"SELECT AVG(data:MaxTemp::FLOAT) AS avg_max, MEDIAN(data:MaxTemp::FLOAT) AS med_max,
       AVG(data:MinTemp::FLOAT) AS avg_min, MEDIAN(data:MinTemp::FLOAT) AS med_min
FROM weather;"
448;D;-1;Claude_4.5_Sonnet;3;8;"SELECT AVG(data:MaxTemp::F), MEDIAN(data:MaxTemp::F), AVG(data:MinTemp::F), MEDIAN(data:MinTemp::F) FROM weather;"
449;A;-1;Claude_4.5_Sonnet;0;9;"SELECT 
    data:country::STRING AS country,
    COUNT(*) AS city_count
FROM cities_pop
GROUP BY data:country::STRING
ORDER BY city_count DESC;"
450;A;-1;Claude_4.5_Sonnet;1;9;"SELECT 
    data:country::STRING AS country,
    COUNT(*) AS city_count
FROM cities_pop
GROUP BY data:country::STRING
ORDER BY city_count DESC;"
451;A;-1;Claude_4.5_Sonnet;2;9;"WITH city_counts AS (
    SELECT 
        data:country::STRING AS country,
        COUNT(*) AS city_count
    FROM cities_pop
    GROUP BY data:country::STRING
)
SELECT 
    country,
    city_count
FROM city_counts
ORDER BY city_count DESC;"
452;A;-1;Claude_4.5_Sonnet;3;9;"SELECT data:country AS country, COUNT(*) AS city_count
FROM cities_pop
GROUP BY country
ORDER BY city_count;"
453;B;-1;Claude_4.5_Sonnet;0;9;"SELECT data:furnishingstatus AS furnishing_status, 
       COUNT(*) AS house_count, 
       AVG(data:price::FLOAT) AS average_price
FROM house_price
GROUP BY furnishing_status;"
454;B;-1;Claude_4.5_Sonnet;1;9;"SELECT data:furnishingstatus AS furnishing_status, 
       COUNT(*) AS house_count, 
       AVG(data:price::FLOAT) AS average_price
FROM house_price
GROUP BY furnishing_status;"
455;B;-1;Claude_4.5_Sonnet;2;9;"SELECT 
    furnishingstatus,
    COUNT(*) AS num_houses,
    ROUND(AVG(price), 2) AS avg_price
FROM (
    SELECT 
        data:furnishingstatus::STRING AS furnishingstatus,
        data:price::FLOAT AS price
    FROM house_price,
    LATERAL FLATTEN(INPUT => data)
    WHERE data:furnishingstatus IS NOT NULL
      AND data:price IS NOT NULL
)
GROUP BY furnishingstatus
ORDER BY avg_price DESC;"
456;B;-1;Claude_4.5_Sonnet;3;9;"SELECT data:furnishingstatus::STRING furnishingstatus,COUNT(*) cnt,ROUND(AVG(data:price::FLOAT),2) avg_price FROM house_price WHERE data:furnishingstatus IS NOT NULL GROUP BY 1 ORDER BY avg_price DESC;"
457;C;-1;Claude_4.5_Sonnet;0;9;"SELECT 
    data:personName::STRING as name,
    data:finalWorth::NUMBER as current_worth,
    ARRAY_SIZE(data:industries) as industry_count
FROM forbes
ORDER BY current_worth DESC;"
458;C;-1;Claude_4.5_Sonnet;1;9;"SELECT 
    data:personName::STRING AS name,
    ARRAY_SIZE(data:industries) AS industry_count,
    data:finalWorth::NUMBER AS current_worth
FROM forbes
ORDER BY current_worth DESC;"
459;C;-1;Claude_4.5_Sonnet;2;9;"SELECT 
    data:personName::STRING AS name,
    data:finalWorth::NUMBER AS current_worth,
    ARRAY_SIZE(data:industries) AS industry_count
FROM forbes
ORDER BY current_worth DESC;"
460;C;-1;Claude_4.5_Sonnet;3;9;"SELECT data:name::STRING name,data:current_worth::INT worth,ARRAY_SIZE(data:industries) num_industries FROM forbes ORDER BY worth DESC;"
461;D;-1;Claude_4.5_Sonnet;0;9;"SELECT 
    data:WindGustDir::STRING AS wind_direction,
    AVG(data:Rainfall::FLOAT) AS avg_rainfall
FROM weather
WHERE wind_direction IS NOT NULL
GROUP BY wind_direction
ORDER BY avg_rainfall DESC;"
462;D;-1;Claude_4.5_Sonnet;1;9;"SELECT data:WindGustDir::STRING AS wind_dir, AVG(data:Rainfall::FLOAT) AS avg_rain
FROM weather GROUP BY 1 ORDER BY avg_rain;"
463;D;-1;Claude_4.5_Sonnet;2;9;"WITH WindRain AS (
    SELECT data:WindGustDir::STRING AS wind_dir, data:Rainfall::FLOAT AS rain FROM weather
)
SELECT wind_dir, AVG(rain) AS average_rainfall
FROM WindRain WHERE wind_dir IS NOT NULL GROUP BY wind_dir ORDER BY average_rainfall;"
464;D;-1;Claude_4.5_Sonnet;3;9;"SELECT data:WindGustDir::S dir, AVG(data:Rainfall::F) r FROM weather GROUP BY 1 ORDER BY r;"
465;A;-1;Claude_4.5_Sonnet;0;10;"SELECT 
    data:city::STRING AS city,
    data:country::STRING AS country,
    SUM(district.value:area_km2::DECIMAL) AS total_area_km2
FROM cities_pop,
LATERAL FLATTEN(input => data:districts) AS district
GROUP BY data:city::STRING, data:country::STRING
ORDER BY total_area_km2 DESC;"
466;A;-1;Claude_4.5_Sonnet;1;10;"SELECT 
    data:city::STRING AS city,
    data:country::STRING AS country,
    SUM(district.value:area_km2::DECIMAL) AS total_area_km2
FROM cities_pop,
LATERAL FLATTEN(input => data:districts) AS district
GROUP BY data:city::STRING, data:country::STRING
ORDER BY total_area_km2 DESC;"
467;A;-1;Claude_4.5_Sonnet;2;10;"WITH flattened_districts AS (
    SELECT 
        data:city::STRING AS city,
        data:country::STRING AS country,
        district.value:area_km2::DECIMAL AS area_km2
    FROM cities_pop,
    LATERAL FLATTEN(input => data:districts) AS district
),
city_total_area AS (
    SELECT 
        city,
        country,
        SUM(area_km2) AS total_area_km2
    FROM flattened_districts
    GROUP BY city, country
)
SELECT 
    city,
    country,
    total_area_km2
FROM city_total_area
ORDER BY total_area_km2 DESC;"
468;A;-1;Claude_4.5_Sonnet;3;10;"SELECT data:city AS city, SUM(data:districts[].area_km2) AS total_area
FROM cities_pop
GROUP BY city
ORDER BY total_area DESC;"
469;B;-1;Claude_4.5_Sonnet;0;10;"SELECT data:furnishingstatus AS furnishing_status, 
       data:price::FLOAT AS price
FROM house_price
WHERE data:price IS NOT NULL
ORDER BY price DESC
LIMIT 3;"
470;B;-1;Claude_4.5_Sonnet;1;10;"SELECT data:furnishingstatus AS furnishing_status, 
       data:price::FLOAT AS price
FROM house_price
WHERE data:price IS NOT NULL
ORDER BY price DESC
LIMIT 3;"
471;B;-1;Claude_4.5_Sonnet;2;10;"SELECT 
    furnishingstatus,
    price,
    ROW_NUMBER() OVER (PARTITION BY furnishingstatus ORDER BY price DESC) AS house_rank
FROM (
    SELECT 
        data:furnishingstatus::STRING AS furnishingstatus,
        data:price::FLOAT AS price
    FROM house_price,
    LATERAL FLATTEN(INPUT => data)
    WHERE data:furnishingstatus IS NOT NULL
      AND data:price IS NOT NULL
)
QUALIFY house_rank <= 3
ORDER BY furnishingstatus, price DESC;"
472;B;-1;Claude_4.5_Sonnet;3;10;"SELECT data:furnishingstatus::STRING furnishingstatus,data:price::FLOAT price,ROW_NUMBER() OVER(PARTITION BY data:furnishingstatus ORDER BY data:price DESC) rnk FROM house_price WHERE data:furnishingstatus IS NOT NULL AND data:price IS NOT NULL QUALIFY rnk<=3 ORDER BY furnishingstatus,price DESC;"
473;C;-1;Claude_4.5_Sonnet;0;10;"SELECT 
    ind.value::STRING as industry,
    COUNT(*) as billionaire_count
FROM forbes,
LATERAL FLATTEN(input => data:industries) ind
GROUP BY industry
ORDER BY billionaire_count DESC;"
474;C;-1;Claude_4.5_Sonnet;1;10;"SELECT 
    f.value::STRING AS industry,
    COUNT(*) AS billionaire_count
FROM forbes,
LATERAL FLATTEN(input => data:industries) f
GROUP BY industry
ORDER BY billionaire_count DESC;"
475;C;-1;Claude_4.5_Sonnet;2;10;"WITH flattened_industries AS (
    SELECT 
        ind.value::STRING AS industry_name
    FROM forbes,
    LATERAL FLATTEN(input => data:industries) ind
)
SELECT 
    industry_name,
    COUNT(*) AS billionaire_count
FROM flattened_industries
GROUP BY industry_name
ORDER BY billionaire_count DESC;"
476;C;-1;Claude_4.5_Sonnet;3;10;"SELECT f.value::STRING industry,COUNT(*) cnt FROM forbes,LATERAL FLATTEN(INPUT=>data:industries) f GROUP BY 1 ORDER BY cnt DESC;"
477;D;-1;Claude_4.5_Sonnet;0;10;"WITH ranked_temps AS (
    SELECT 
        data:WindGustDir::STRING AS wind_direction,
        data:Temp3pm::FLOAT AS afternoon_temp,
        data:Date::DATE AS date,
        ROW_NUMBER() OVER (PARTITION BY data:WindGustDir::STRING ORDER BY data:Temp3pm::FLOAT DESC) AS rank
    FROM weather
    WHERE wind_direction IS NOT NULL
)
SELECT * FROM ranked_temps 
WHERE rank <= 3
ORDER BY wind_direction, rank;"
478;D;-1;Claude_4.5_Sonnet;1;10;"SELECT * FROM (
    SELECT data:WindGustDir::STRING AS wind_dir, data:Temp3pm::FLOAT AS temp,
           ROW_NUMBER() OVER (PARTITION BY data:WindGustDir::STRING ORDER BY data:Temp3pm::FLOAT DESC) AS rank
    FROM weather WHERE wind_dir IS NOT NULL
) WHERE rank <= 3 ORDER BY wind_dir;"
479;D;-1;Claude_4.5_Sonnet;2;10;"WITH AfternoonTemps AS (
    SELECT data:WindGustDir::STRING AS wind_dir, data:Temp3pm::FLOAT AS temp3pm FROM weather
),
RankedTemps AS (
    SELECT wind_dir, temp3pm,
           ROW_NUMBER() OVER (PARTITION BY wind_dir ORDER BY temp3pm DESC) AS temp_rank
    FROM AfternoonTemps WHERE wind_dir IS NOT NULL
)
SELECT * FROM RankedTemps WHERE temp_rank <= 3;"
480;D;-1;Claude_4.5_Sonnet;3;10;"SELECT * FROM (SELECT data:WindGustDir::S d, data:Temp3pm::F t, ROW_NUMBER() OVER(PARTITION BY d ORDER BY t DESC) r FROM weather WHERE d IS NOT NULL) WHERE r<=3;"
481;A;1;student;-1;1;"CREATE OR REPLACE TABLE retail (
    invoice_no INT,
    stock_code STRING,
    description STRING,
    quantity INT,
    invoice_date TIMESTAMP,
    unit_price NUMBER(10,2),
    customer_id INT,
    country STRING
);

CREATE OR REPLACE FILE FORMAT my_format
  TYPE = 'csv'
  FIELD_DELIMITER = ';'
  SKIP_HEADER = 1
  NULL_IF = ('NULL', 'null')
  EMPTY_FIELD_AS_NULL = TRUE
  TIMESTAMP_FORMAT = 'DD.MM.YYYY HH24:MI';

CREATE OR REPLACE STAGE my_stage
  FILE_FORMAT = my_format;

COPY INTO retail
  FROM @my_stage/online_retail.csv
  FILE_FORMAT = (FORMAT_NAME = my_format)
  ON_ERROR = CONTINUE;"
482;A;2;student;-1;1;"USE WAREHOUSE HYENA_WH;
CREATE OR REPLACE SCHEMA zapocet;
USE SCHEMA zapocet;

CREATE OR REPLACE TABLE retail(
    invoice_no INT,
    stock_code STRING,
    description STRING,
    quantity INT,
    invoice_date DATETIME,
    unit_price NUMBER(10,10),
    customer_id INT AUTOINCREMENT PRIMARY KEY,
    country STRING   
);

CREATE OR REPLACE FILE FORMAT my_format
  TYPE = 'CSV'
  FIELD_DELIMITER = ';'
  SKIP_HEADER = 1
  NULL_IF = ('NULL', 'null')
  EMPTY_FIELD_AS_NULL = TRUE
  TIMESTAMP_FORMAT = 'DD.MM.YYYY HH24:MI';

CREATE OR REPLACE STAGE my_stage
  FILE_FORMAT = my_format;

COPY INTO retail
  FROM @my_stage/online_retail.csv
  FILE_FORMAT = (FORMAT_NAME = my_format)
  ON_ERROR = 'CONTINUE';"
483;A;3;student;-1;1;"CREATE OR REPLACE FILE FORMAT retail_format
 TYPE='CSV'
 FIELD_DELIMITER=';'
 SKIP_HEADER=1
 NULL_IF=('NULL','null')
 EMPTY_FIELD_AS_NULL=TRUE
 TIMESTAMP_FORMAT='DD.MM.YYYY HH24 MI';

CREATE STAGE stork_db.zapocet.retail_stage
 FILE_FORMAT=retail_format;

CREATE OR REPLACE TABLE retail(
 invoice_no INT,
 stock_code STRING,
 description STRING,
 quantity INT,
 invoice_date STRING,
 unit_price FLOAT,
 customer_id INT,
 country STRING
);

COPY INTO retail 
 FROM @retail_stage/online_retail.csv 
 FILE_FORMAT=(FORMAT_NAME=retail_format)
 ON_ERROR=CONTINUE;"
484;A;4;student;-1;1;"CREATE OR REPLACE TABLE retail(
    invoice_no INT AUTOINCREMENT PRIMARY KEY,
    stock_code STRING,
    description STRING,
    quantity INT,
    invoice_date DATETIME,
    unit_price NUMBER(10,2),
    customer_id INT,
    country STRING
);

CREATE OR REPLACE FILE FORMAT my_format
  TYPE = 'CSV'
  FIELD_DELIMITER = ';'
  SKIP_HEADER = 1
  NULL_IF = ('NULL', 'null')
  EMPTY_FIELD_AS_NULL = TRUE
  TIMESTAMP_FORMAT = 'DD.MM.YYYY HH24:MI';
  

CREATE OR REPLACE STAGE my_stage
  FILE_FORMAT = my_format;

COPY INTO retail
  FROM @my_stage/online_retail.csv
  FILE_FORMAT = (FORMAT_NAME = my_format)
  ON_ERROR = CONTINUE;

  SELECT * FROM retail LIMIT 25;"
485;A;5;student;-1;1;"USE WAREHOUSE LIZARD_WH;
USE DATABASE LIZARD_DB;
USE ROLE TRAINING_ROLE;

CREATE OR REPLACE SCHEMA LIZARD_DB.Test_01;
USE SCHEMA LIZARD_DB.Test_01;

CREATE OR REPLACE TABLE retail(
invoice_no INT AUTOINCREMENT PRIMARY KEY,
stock_code STRING,
description STRING,
quantity INT,
invoice_date DATETIME,
unit_price NUMBER(10,2),
customer_id INT,
country STRING
);

CREATE OR REPLACE FILE FORMAT my_format
TYPE = 'CSV'
FIELD_DELIMITER = ';'
SKIP_HEADER = 1
NULL_IF = ('NULL', 'null')
EMPTY_FIELD_AS_NULL = TRUE
TIMESTAMP_FORMAT = 'DD.MM.YYYY HH24:MI';


CREATE OR REPLACE STAGE my_stage
FILE_FORMAT = my_format;

COPY INTO retail
FROM @my_stage/online_retail.csv
FILE_FORMAT = (FORMAT_NAME = my_format)
ON_ERROR = CONTINUE;"
486;A;6;student;-1;1;"USE WAREHOUSE JACKAL_WH;
USE DATABASE JACKAL_DB;
CREATE OR REPLACE SCHEMA JACKAL_DB.TEST;
USE SCHEMA JACKAL_DB.TEST;

CREATE OR REPLACE FILE FORMAT my_format
TYPE = 'CSV'
FIELD_DELIMITER = ';'
SKIP_HEADER = 1
NULL_IF = ('NULL','null')
EMPTY_FIELD_AS_NULL = TRUE
TIMESTAMP_FORMAT = 'DD.MM.YYYY HH24:MI';

CREATE OR REPLACE STAGE my_stage
FILE_FORMAT = my_format;

CREATE OR REPLACE TABLE retail(
invoice_no int,
stock_code STRING,
description STRING,
quantity int,
invoice_date DATE,
unit_price NUMBER(10,2),
customer_id INT,
country STRING
);
COPY INTO retail
FROM @my_stage/online_retail.csv
FILE_FORMAT = (FORMAT_NAME = my_format)
ON_ERROR = 'CONTINUE';"
487;A;7;student;-1;1;"CREATE OR REPLACE FILE FORMAT my_format
  TYPE = 'CSV'
  FIELD_DELIMITER = ';'
  SKIP_HEADER = 1
  NULL_IF = ('NULL', 'null')
  EMPTY_FIELD_AS_NULL = TRUE
  TIMESTAMP_FORMAT = 'DD.MM.YYYY HH24:MI';

CREATE OR REPLACE STAGE my_stage
  FILE_FORMAT = my_format;

CREATE OR REPLACE TABLE retail (
    invoice_no INT,
    stock_code STRING,
    description STRING,
    quantity INT,
    invoice_date DATETIME,
    unit_price NUMBER(10,2),
    customer_id INT,
    country STRING
);

COPY INTO retail
  FROM @my_stage/online_retail.csv
  FILE_FORMAT = (FORMAT_NAME = 'my_format')
  ON_ERROR = CONTINUE;"
488;A;8;student;-1;1;"CREATE OR REPLACE TABLE retail (
    invoice_no INT,
    stock_code STRING,
    description STRING,
    quantity INT,
    invoice_date DATETIME,
    unit_price NUMBER(10,2),
    customer_id INT,
    country STRING
);

CREATE OR REPLACE FILE FORMAT my_format
  TYPE = 'CSV'
  FIELD_DELIMITER = ';'
  SKIP_HEADER = 1
  NULL_IF = ('NULL', 'null')
  EMPTY_FIELD_AS_NULL = TRUE
  TIMESTAMP_FORMAT = 'DD.MM.YYYY HH24:MI';

  CREATE OR REPLACE STAGE my_stage
  FILE_FORMAT = my_format;


  COPY INTO retail
  FROM @my_stage/online_retail.csv
  FILE_FORMAT = (FORMAT_NAME = my_format)
  ON_ERROR = ""CONTINUE"";"
489;A;1;student;-1;2;"SELECT customer_id, invoice_date, (quantity * unit_price) AS amount, 
    SUM(amount) OVER (
        PARTITION BY customer_id
        ORDER BY invoice_date
        RANGE BETWEEN INTERVAL '14 DAY' PRECEDING AND CURRENT ROW
    ) AS last14d_sum
FROM retail;"
490;A;2;student;-1;2;"SELECT 
    customer_id,
    invoice_date,
    quantity * unit_price AS amount,
    SUM(quantity * unit_price) OVER (
        PARTITION BY customer_id 
        ORDER BY invoice_date
        RANGE BETWEEN INTERVAL '14 DAYS' PRECEDING AND CURRENT ROW
    ) AS last14d_sum
FROM retail
ORDER BY customer_id, invoice_date;"
491;A;4;student;-1;2;"SELECT 
    customer_id,
    invoice_date,
    quantity * unit_price AS amount,
    SUM(quantity * unit_price) OVER (
        PARTITION BY customer_id 
        ORDER BY invoice_date 
        RANGE BETWEEN INTERVAL '14' PRECEDING AND CURRENT ROW
    ) AS last14d_sum
FROM retail
ORDER BY customer_id, invoice_date;"
492;A;5;student;-1;2;"SELECT
customer_id,
invoice_date,
quantity * unit_price AS amount,
SUM(quantity * unit_price)
OVER (PARTITION BY customer_id 
ORDER BY invoice_date 
ROWS BETWEEN 14 PRECEDING AND CURRENT ROW) AS LAST14D_SUM
FROM retail
ORDER BY customer_id, invoice_date;"
493;A;6;student;-1;2;"SELECT customer_id,invoice_date,unit_price as amount,
    SUM(quantity * unit_price) OVER (
        PARTITION BY customer_id
        ORDER BY invoice_date
        RANGE BETWEEN INTERVAL '14 DAY' PRECEDING AND CURRENT ROW
)
as LAST14D_SUM
FROM retail"
494;A;7;student;-1;2;"SELECT customer_id, invoice_date, quantity * unit_price AS amount,
    SUM(quantity * unit_price) OVER(
        PARTITION BY customer_id
        ORDER BY invoice_date
        ROWS BETWEEN INTERVAL '14 DAY' PRECEDING AND CURRENT ROW
    ) AS last14d_sum
FROM retail
ORDER BY customer_id, invoice_date;"
495;A;8;student;-1;2;"SELECT customer_id, invoice_date, unit_price AS amount,
       SUM(amount * QUANTITY) OVER (PARTITION BY customer_id ORDER BY invoice_date
RANGE BETWEEN INTERVAL '13 DAY' PRECEDING AND CURRENT ROW
) as LAST14D_SUM
FROM retail;"
496;A;1;student;-1;3;"SELECT customer_id, invoice_no, invoice_date,
    LAG(invoice_date) OVER (
        PARTITION BY customer_id
        ORDER BY invoice_date
    ) AS next_date,
    DATEDIFF('day', next_date, invoice_date) AS days_to_next
FROM retail
ORDER BY days_to_next DESC;"
497;A;4;student;-1;3;"WITH NextPurchase AS (
  SELECT 
    customer_id,
    invoice_no,
    invoice_date,
    LEAD(invoice_date) OVER (PARTITION BY customer_id ORDER BY invoice_date) as next_date,
    DATEDIFF('day', invoice_date, LEAD(invoice_date) OVER (PARTITION BY customer_id ORDER BY invoice_date)) as days_to_next
  FROM retail
  WHERE quantity > 0
)
SELECT 
  customer_id,
  invoice_no,
  invoice_date,
  next_date,
  days_to_next
FROM NextPurchase
WHERE days_to_next IS NOT NULL
ORDER BY days_to_next DESC;"
498;A;5;student;-1;3;"SELECT 
customer_id, 
invoice_no, 
invoice_date, 
LEAD(invoice_date) OVER (PARTITION BY customer_id ORDER BY invoice_date) AS next_date, 
DATEDIFF(DAY, invoice_date, LEAD(invoice_date) OVER (PARTITION BY customer_id ORDER BY invoice_date)) AS days_to_next 
FROM retail 
WHERE invoice_date IS NOT NULL 
ORDER BY days_to_next DESC;"
499;A;4;student;-1;4;"SELECT 
  customer_id,
  SUM(quantity * unit_price) as total_amount,
  NTILE(4) OVER (ORDER BY total_amount DESC) as quartile
FROM retail
GROUP BY customer_id
ORDER BY total_amount DESC;"
500;A;5;student;-1;4;"WITH Customer_Revenue AS ( 
SELECT 
customer_id, 
SUM(quantity * unit_price) AS revenue 
FROM retail 
GROUP BY customer_id 
), 
Revenue_Rank AS ( 
SELECT 
customer_id, 
revenue, 
NTILE(4) OVER (ORDER BY revenue DESC) AS revenue_quartile 
FROM Customer_Revenue 
) 
SELECT customer_id, revenue, revenue_quartile
FROM Revenue_Rank ORDER BY revenue DESC;"
501;A;6;student;-1;4;"WITH customer_revenue AS (
    SELECT 
        customer_id,
        SUM(quantity * unit_price) AS revenue
    FROM retail
    GROUP BY customer_id
)
SELECT 
    customer_id,
    revenue,
    NTILE(4) OVER (ORDER BY revenue DESC) AS revenue_quartile
FROM customer_revenue
ORDER BY revenue DESC;"
502;A;1;student;-1;5;"WITH rn AS (
    SELECT *,
        ROW_NUMBER() OVER (
            PARTITION BY customer_id
            ORDER BY invoice_date ASC
        ) AS row_num
    FROM retail
)
SELECT row_num, customer_id, invoice_no, invoice_date, (quantity * unit_price) AS amount
FROM rn
WHERE row_num = 1
ORDER BY customer_id;"
503;A;4;student;-1;5;"SELECT 
  ROW_NUMBER() OVER (ORDER BY customer_id) AS NUM,
  customer_id,
  invoice_no,
  invoice_date,
  SUM(quantity * unit_price) AS amount
FROM retail
WHERE (customer_id, invoice_date) IN (
  SELECT 
    customer_id, 
    MIN(invoice_date)
  FROM retail 
  GROUP BY customer_id
)
GROUP BY customer_id, invoice_no, invoice_date
ORDER BY customer_id;"
504;A;5;student;-1;5;"SELECT
ROW_NUMBER() OVER (PARTITION BY customer_id ORDER BY invoice_date) AS num, 
customer_id, 
invoice_no, 
invoice_date, 
quantity * unit_price AS amount 
FROM retail
QUALIFY ROW_NUMBER() OVER (PARTITION BY customer_id ORDER BY invoice_date) = 1 
ORDER BY customer_id;"
505;A;6;student;-1;5;"WITH FirstPurchases AS (
    SELECT customer_id,invoice_no,invoice_date,quantity as amount,
        ROW_NUMBER() OVER (
        PARTITION BY customer_id 
        ORDER BY invoice_date ASC) AS rn
    FROM retail
)
SELECT 
    1 AS NUM, 
    customer_id, 
    invoice_no, 
    invoice_date, 
    amount
FROM FirstPurchases
WHERE rn = 1
ORDER BY customer_id;"
506;A;8;student;-1;5;"SELECT row_number() over (partition by customer_id order by customer_id) as num, customer_id, invoice_no, invoice_date,
sum(quantity*unit_price) OVER  (PARTITION BY customer_id ORDER BY customer_id desc ) as amount
from retail;
"
507;A;1;student;-1;6;"WITH rn AS (
    SELECT *,
        ROW_NUMBER() OVER (
            PARTITION BY country, DATE_TRUNC('month', invoice_date)
            ORDER BY (quantity * unit_price) DESC
        ) AS row_num
    FROM retail
)
SELECT country, DATE_TRUNC('month', invoice_date) AS month, customer_id, (quantity * unit_price) AS revenue, row_num
FROM rn
WHERE row_num <= 5
ORDER BY country, month, row_num, customer_id;"
508;A;4;student;-1;6;"SELECT 
    country,
    DATE_TRUNC('MONTH', invoice_date) as month,
    customer_id,
    SUM(quantity * unit_price) as amount,
    ROW_NUMBER() OVER (PARTITION BY country, DATE_TRUNC('MONTH', invoice_date) ORDER BY SUM(quantity * unit_price) DESC) as rank
FROM retail
GROUP BY country, month, customer_id
QUALIFY rank <= 5
ORDER BY country, month, rank, customer_id;"
509;A;5;student;-1;6;"WITH Monthly_Revenue AS (
SELECT
country,
TO_CHAR(invoice_date, 'YYYY-MM') AS month,
customer_id,
SUM(quantity * unit_price) AS revenue
FROM retail
GROUP BY country, month, customer_id
),
Ranked_Revenue AS (
SELECT
country,
month,
customer_id,
revenue,
RANK() OVER (PARTITION BY country, month ORDER BY revenue DESC) AS rank
FROM Monthly_Revenue
)
SELECT
country,
month,
customer_id,
revenue,
rank
FROM Ranked_Revenue
WHERE rank <= 5
ORDER BY country, month, rank, customer_id;"
510;A;6;student;-1;6;"WITH monthly_revenue AS (
    SELECT
        country,
        TO_CHAR(DATE_TRUNC('MONTH', invoice_date), 'YYYY-MM') AS month,
        customer_id,
        SUM(quantity * unit_price) AS revenue
    FROM retail
    GROUP BY
        country,
        TO_CHAR(DATE_TRUNC('MONTH', invoice_date), 'YYYY-MM'),
        customer_id
),
ranked_customers AS (
    SELECT
        country,
        month,
        customer_id,
        revenue,
        RANK() OVER (
            PARTITION BY country, month
            ORDER BY revenue DESC
        ) AS rank_in_month
    FROM monthly_revenue
)
SELECT
    country,
    month,
    customer_id,
    revenue,
    rank_in_month
FROM ranked_customers
WHERE rank_in_month <= 5
ORDER BY country, month, rank_in_month, customer_id;"
511;A;1;student;-1;7;"CREATE OR REPLACE TABLE cities_pop (data VARIANT);

CREATE OR REPLACE FILE FORMAT json_format
  TYPE = 'json'
  STRIP_OUTER_ARRAY = TRUE;

CREATE OR REPLACE STAGE json_stage
  FILE_FORMAT = (FORMAT_NAME = json_format);

COPY INTO cities_pop
  FROM @json_stage/cities_population.json
  FILE_FORMAT = json_format;"
512;A;2;student;-1;7;"CREATE OR REPLACE FILE FORMAT json_format
  TYPE = 'JSON'
  STRIP_OUTER_ARRAY = ',';

CREATE OR REPLACE STAGE json_stage
  FILE_FORMAT = json_format ;

COPY INTO cities_pop
  FROM @json
  FILE_FORMAT ="
513;A;4;student;-1;7;"CREATE OR REPLACE TABLE cities_pop(
    data VARIANT
);

CREATE OR REPLACE FILE FORMAT json_format
  TYPE = 'JSON'
  STRIP_OUTER_ARRAY = TRUE;

CREATE OR REPLACE STAGE json_stage
  FILE_FORMAT = json_format;

COPY INTO cities_pop
  FROM 
  FILE_FORMAT = js;"
514;A;5;student;-1;7;"CREATE OR REPLACE TABLE cities_pop (
data VARIANT
);

CREATE OR REPLACE FILE FORMAT json_format
TYPE = 'JSON'
STRIP_OUTER_ARRAY = TRUE;

CREATE OR REPLACE STAGE json_stage
FILE_FORMAT = json_format;

COPY INTO cities_pop
FROM @json_stage/cities_population.json
FILE_FORMAT = json_format;"
515;A;6;student;-1;7;"CREATE OR REPLACE FILE FORMAT json_format
TYPE = 'JSON'
STRIP_OUTER_ARRAY = ' '

CREATE OR REPLACE STAGE json_stage
FILE_FORMAT = json_format;

COPY INTO cities_pop 
FROM @json_stage/cities_population.json
FILE_FORMAT = json_format"
516;A;7;student;-1;7;"CREATE OR REPLACE FILE FORMAT json_format
  TYPE = 'json'
  STRIP_OUTER_ARRAY = TRUE;

CREATE OR REPLACE STAGE json_stage
  FILE_FORMAT = json_format;

CREATE OR REPLACE TABLE cities_pop(data VARIANT);

COPY INTO cities_pop
  FROM @json_stage/cities_population.json
  FILE_FORMAT = json_format;"
517;A;8;student;-1;7;"CREATE OR REPLACE FILE FORMAT json_format
  TYPE = 'JSON'
  STRIP_OUTER_ARRAY = TRUE;

CREATE OR REPLACE STAGE json_stage
  FILE_FORMAT = json_format;

 CREATE OR REPLACE TABLE cities_pop (data VARIANT);

COPY INTO cities_pop
  FROM @json_stage/cities_population.json
  FILE_FORMAT = json_format;"
518;A;1;student;-1;8;"SELECT data:rank::INT as rank, data:city::STRING as city, data:""2025_population""::STRING as pop2025
  FROM cities_pop
  WHERE data:country::STRING = 'India';"
519;A;5;student;-1;8;"SELECT 
data:rank::INT AS RANK,
data:city::STRING AS CITY,
data:""2025_population""::STRING AS POP2025
FROM cities_pop
WHERE data:country::STRING = 'India'
ORDER BY RANK;"
520;A;7;student;-1;8;"SELECT 
    data:rank::int AS RANK,
    data:city::string AS CITY,
    data:""2025_population""::string AS POP2025
FROM cities_pop
WHERE data:country::string LIKE 'India'
ORDER BY RANK;"
521;A;1;student;-1;9;"SELECT data:country::STRING AS country, COUNT(*) AS city_count
  FROM cities_pop
  GROUP BY country
  ORDER BY city_count DESC;"
522;A;5;student;-1;9;"SELECT 
data:country::STRING AS COUNTRY,
COUNT(*) AS CITY_COUNT
FROM cities_pop
GROUP BY COUNTRY
ORDER BY CITY_COUNT DESC;"
523;A;7;student;-1;9;"SELECT 
    data:country::string AS COUNTRY,
    COUNT(data:city::string) AS CITY_COUNT
FROM cities_pop
GROUP BY COUNTRY
ORDER BY CITY_COUNT DESC;"
524;A;5;student;-1;10;"SELECT 
data:city::STRING AS CITY,
SUM(district.value:area_km2::FLOAT) AS AREA
FROM cities_pop,
LATERAL FLATTEN(input => data:districts) AS district
GROUP BY CITY
ORDER BY AREA DESC;"
525;A;7;student;-1;10;"SELECT 
    data:city::STRING AS CITY,
    SUM(f.value:area_km2::NUMBER(10,2)) AS AREA
FROM cities_pop,
LATERAL FLATTEN (input => TO_ARRAY(data:districts)) f
GROUP BY CITY
ORDER BY AREA DESC;"
526;B;9;student;-1;1;"CREATE OR REPLACE FILE FORMAT csv_format
    TYPE = 'csv'
    FIELD_DELIMITER = ','
    SKIP_HEADER = 1
    NULL_IF = ('NULL', 'null')
    EMPTY_FIELD_AS_NULL = TRUE;

CREATE OR REPLACE STAGE games_stage
    FILE_FORMAT = csv_format;

CREATE OR REPLACE TABLE games (
    id INT,
    name STRING,
    platform STRING,
    year INT,
    genre STRING,
    publisher STRING,
    na_sales NUMBER(12, 2),
    eu_sales NUMBER(12, 2),
    jp_sales NUMBER(12, 2),
    other_sales NUMBER(12, 2),
    global_sales NUMBER(12, 2)
);


COPY INTO games
    FROM @games_stage/video_game_sales.csv
    FILE_FORMAT = csv_format
    ON_ERROR = CONTINUE;

SELECT * FROM games LIMIT 10;"
527;B;10;student;-1;1;"CREATE OR REPLACE FILE FORMAT my_format
  TYPE = 'CSV'
  FIELD_DELIMITER = ','
  SKIP_HEADER = 1
  NULL_IF = ('NULL', 'null')
  EMPTY_FIELD_AS_NULL = TRUE;

CREATE OR REPLACE STAGE my_stage
  FILE_FORMAT = my_format;

CREATE OR REPLACE TABLE games (
    id INT,
    name STRING,
    platform STRING,
    year INT,
    genre STRING,
    publisher STRING,
    na_sales NUMBER(10, 2),
    eu_sales NUMBER(10, 2),
    jp_sales NUMBER(10, 2),
    other_sales NUMBER(10, 2),
    global_sales NUMBER(10, 2)
);

COPY INTO games
  FROM @my_stage
  FILE_FORMAT = (FORMAT_NAME = my_format)
  ON_ERROR = CONTINUE;

SELECT * FROM games
LIMIT 5;;"
528;B;11;student;-1;1;"create or replace table games(
    id int,
    name varchar(100),
    platform varchar(50),
    year INT,
    genre varchar(50),
    publisher varchar(50),
    na_sales decimal(10,2),
    eu_sales decimal(10,2),
    jp_sales decimal(10,2),
    other_sales decimal(10,2),
    global_sales decimal(10,2)
);

CREATE OR REPLACE FILE FORMAT my_format
  TYPE = 'CSV'
  FIELD_DELIMITER = ','
  SKIP_HEADER = 1
  NULL_IF = ('NULL', 'null')
  EMPTY_FIELD_AS_NULL = TRUE;

CREATE OR REPLACE STAGE my_stage
  FILE_FORMAT = my_format;

COPY INTO games
  FROM @my_stage
  FILE_FORMAT = (FORMAT_NAME = my_format)
  ON_ERROR = CONTINUE;

select * from games;"
529;B;12;student;-1;1;"USE WAREHOUSE LOBSTER_WH;
CREATE OR REPLACE SCHEMA LOBSTER_db.zapocet;
USE SCHEMA LOBSTER_db.zapocet;

CREATE OR REPLACE TABLE games(
    id INT AUTOINCREMENT PRIMARY KEY,
    name STRING,
    platform STRING,
    year INT,
    genre STRING,
    publisher STRING,
    na_sales NUMBER(10,2),
    eu_sales NUMBER(10,2),
    jp_sales NUMBER(10,2),
    other_sales NUMBER(10,2),
    global_sales NUMBER(10,2)
);

CREATE OR REPLACE FILE FORMAT my_format
  TYPE = 'CSV'
  FIELD_DELIMITER = ','
  SKIP_HEADER = 1
  NULL_IF = ('NULL', 'null')
  EMPTY_FIELD_AS_NULL = TRUE;

CREATE OR REPLACE STAGE my_stage
  FILE_FORMAT = my_format;

COPY INTO games
  FROM @my_stage/video_game_sales.csv
  FILE_FORMAT = (FORMAT_NAME = my_format)
  ON_ERROR = CONTINUE;

SELECT * FROM games
LIMIT 10;"
530;B;13;student;-1;1;"CREATE or Replace File Format my_format
    Type = 'CSV'
    FIELD_DELIMITER = ','
    SKIP_HEADER = 1
    NULL_IF = ('NULL', 'NULL')
    EMPTY_FIELD_AS_NULL = TRUE;

Create Or Replace STAGE my_stage
    File_Format = my_format;

Create Or Replace Table games(
    ID int,
    Name string,
    Platform string,
    Year int,
    Genre string,
    Publisher string,
    NA_Sales number(10,2),
    EU_Sales number(10,2),
    JP_Sales number(10,2),
    Other_Sales number(10,2),
    Global_Sales number(10,2)
);

COPY INTO games
    From @my_stage/video_game_sales.csv
    File_Format  = (FORMAT_NAME = my_format)
    ON_ERROR = 'Continue';

SELECT * From games;"
531;B;14;student;-1;1;"USE WAREHOUSE KOALA_WH;
USE DATABASE KOALA_DB;
USE ROLE TRAINING_ROLE;

CREATE OR REPLACE SCHEMA KOALA_DB.TEST01;
USE SCHEMA TEST01;


CREATE OR REPLACE TABLE games(
    id INT AUTOINCREMENT PRIMARY KEY,
    name STRING,
    platform STRING,
    year NUMBER(4,0),
    genre STRING,
    publisher STRING,
    na_sales NUMBER(10,2),
    eu_sales NUMBER(10,2),
    jp_sales NUMBER(10,2),
    other_sales NUMBER(10,2),
    global_sales NUMBER(10,2)
);

CREATE OR REPLACE FILE FORMAT my_format
  TYPE = 'CSV'
  FIELD_DELIMITER = ','
  SKIP_HEADER = 1
  NULL_IF = ('NULL', 'null')
  EMPTY_FIELD_AS_NULL = TRUE;

CREATE OR REPLACE STAGE my_stage
  FILE_FORMAT = my_format;

COPY INTO games
  FROM @my_stage/video_game_sales.csv
  FILE_FORMAT = (FORMAT_NAME = my_format)
  ON_ERROR = CONTINUE;

  SELECT * FROM games LIMIT 5;"
532;B;15;student;-1;1;"CREATE OR REPLACE TABLE video_game_sales(
    ID INT AUTOINCREMENT PRIMARY KEY,
    Name STRING,
    Platform STRING,
    Year STRING,
    Genre STRING,
    Publisher STRING,
    NA_Sales NUMBER(10,2),
    EU_Sales NUMBER(10,2),
    JP_Sales NUMBER(10,2),
    Other_Sales NUMBER(10,2),
    Global_Sales NUMBER(10,2)
)

CREATE OR REPLACE FILE FORMAT my_format
  TYPE = 'CSV'
  FIELD_DELIMITER = ','
  SKIP_HEADER = 1
  NULL_IF = ('NULL', 'null')
  EMPTY_FIELD_AS_NULL = TRUE;

CREATE OR REPLACE STAGE my_stage
  FILE_FORMAT = my_format;

COPY INTO games
  FROM @my_stage/video_game_sales.csv
  FILE_FORMAT = (FORMAT_NAME = my_format)
  ON_ERROR = CONTINUE;"
533;B;16;student;-1;1;"USE WAREHOUSE WOMBAT_SH;
USE DATABASE WOMBAT_DB;
CREATE OR REPLACE SCHEMA WOMBAT_DB.testb;
USE SCHEMA WOMBAT_DB.testb;

CREATE TABLE games(
    id INT,
    name STRING,
    platform STRING,
    year INT,
    genre STRING,
    publisher STRING,
    na_sales DOUBLE,
    eu_sales DOUBLE,
    jp_sales DOUBLE,
    other_sales DOUBLE,
    global_sales DOUBLE
);

CREATE OR REPLACE FILE FORMAT my_format
  TYPE = 'CSV'
  FIELD_DELIMITER = ','
  SKIP_HEADER = 1
  NULL_IF = ('NULL', 'null')
  EMPTY_FIELD_AS_NULL = TRUE;

CREATE OR REPLACE STAGE my_stage
  FILE_FORMAT = my_format;

COPY INTO games
  FROM @my_stage/video_game_sales.csv
  FILE_FORMAT = (FORMAT_NAME = my_format)
  ON_ERROR = CONTINUE;"
534;B;9;student;-1;2;"SELECT platform, year,
    SUM(global_sales) OVER (
        PARTITION BY platform, year
        ORDER BY year
    ) AS year_sales,
    SUM(global_sales) OVER (
        PARTITION BY platform
        ORDER BY year
    ) AS last_3y_sales
FROM games
ORDER BY platform, year;"
535;B;10;student;-1;2;"SELECT platform, year, global_sales,
       SUM(global_sales) OVER (
         PARTITION BY platform
         ORDER BY year
         RANGE BETWEEN CURRENT ROW AND 3 FOLLOWING
       ) AS test
FROM GAMES
ORDER BY platform, year;"
536;B;11;student;-1;2;"SELECT 
    platform,
    year,
    SUM(global_sales) as YEAR_SALES,
    SUM(SUM(global_sales)) OVER (PARTITION BY platform ORDER BY year ROWS BETWEEN 2 PRECEDING AND CURRENT ROW) as LAST_3Y_SALES
FROM games
GROUP BY platform, year
ORDER BY platform, year;"
537;B;13;student;-1;2;"Select platform, year,
    SUM(global_sales) OVER(
        PARTITION BY platform
        ORDER BY platform
        RANGE between interval '12 MONTH' PRECEDING AND CURRENT ROW
        ) AS Year_Sales,
    SUM(global_sales) OVER(
        PARTITION BY platform
        ORDER BY platform
        RANGE between interval '36 MONTH' preceding and current row
    ) AS Last_3Y_sales
From games
order by platform, year;"
538;B;14;student;-1;2;"SELECT
    platform,
    year,
    SUM(global_sales) AS YEAR_SALES,
    SUM(SUM(global_sales)) OVER (
        PARTITION BY platform 
        ORDER BY year 
        ROWS BETWEEN 2 PRECEDING AND CURRENT ROW
        ) AS THREE_YEAR_SALES
FROM games
GROUP BY platform, year
ORDER BY platform, year;"
539;B;15;student;-1;2;"with year_sales as (
    SELECT platform, year,
        SUM(global_sales) AS year_sales
    FROM video_game_sales
    GROUP BY platform, year
    ORDER BY platform, year
) SELECT platform, year, year_sales,
    SUM(year_sales) OVER (
    PARTITION BY platform
    ORDER BY year ASC
    ROWS BETWEEN 2 PRECEDING AND CURRENT ROW
) AS last_3y_sales
FROM year_sales
ORDER BY platform, year;"
540;B;9;student;-1;3;"SELECT genre, year,
    SUM(global_sales) OVER (
        PARTITION BY genre
        ORDER BY year
    ) AS revenue,
        LAG(global_sales) OVER (
        PARTITION BY genre
        ORDER BY year
    ) AS prev_evenue,
    SUM(global_sales) - LAG(global_sales) OVER (
        PARTITION BY genre
        ORDER BY year
    ) AS difference
FROM games
ORDER BY genre, year;"
541;B;10;student;-1;3;"SELECT genre, year, global_sales as REVENUE,
    LAG(global_sales) OVER (PARTITION BY genre ORDER BY year) AS PREV_REVENUE,
    global_sales - LAG(global_sales) OVER (PARTITION BY genre ORDER BY year) AS DIFFERENCE
FROM GAMES
ORDER BY genre, year;"
542;B;11;student;-1;3;"SELECT
    genre,
    year,
    SUM(global_sales) AS REVENUE,
    LAG(SUM(global_sales)) OVER (PARTITION BY genre ORDER BY year) AS PREV_REVENUE,
    LAG(SUM(global_sales)) OVER (PARTITION BY genre ORDER BY year) - SUM(global_sales) AS DIFFERENCE
FROM games
GROUP BY genre,year
ORDER BY genre, year;"
543;B;14;student;-1;3;"SELECT
    genre AS GENRE,
    year AS YEAR,
    SUM(global_sales) AS REVENUE,
    LAG(SUM(global_sales)) OVER (
    PARTITION BY genre 
    ORDER BY year
    ) AS PREV_REVENUE,
    SUM(global_sales) - LAG(SUM(global_sales)) OVER (
    PARTITION BY genre 
    ORDER BY year) AS DIFFERENCE
FROM games
GROUP BY genre, year
ORDER BY genre, year;"
544;B;15;student;-1;3;"with rev as (
    SELECT genre, year,
        SUM(global_sales) AS revenue
    FROM video_game_sales
    GROUP BY genre, year
    ORDER BY genre, year
) SELECT genre, year, revenue,
    LAG(revenue) OVER (
        PARTITION BY genre
        ORDER BY year ASC
    ) AS prev_revenue,
    revenue - LAG(revenue) OVER (
        PARTITION BY genre
        ORDER BY year ASC
    ) AS difference
FROM rev
ORDER BY genre, year;"
545;B;9;student;-1;4;"SELECT year, name, global_sales,
    NTILE(4) OVER (
        PARTITION BY global_sales
        ORDER BY year DESC
    ) AS quartile_sales
FROM games
ORDER BY year DESC;"
546;B;11;student;-1;4;"SELECT
    year,
    name,
    global_sales,
    NTILE(4) OVER (PARTITION BY year ORDER BY global_sales) AS QUARTILE_SALES
FROM games
ORDER BY year DESC, global_sales DESC;"
547;B;12;student;-1;4;"SELECT
    year,
    name,
    global_sales,
    NTILE(4) OVER(
        PARTITION BY global_sales
        order by year DESc
    
    ) AS QUARTILE_SALES
FROM GAMES
ORDER BY YEAR desc,global_sales DESc,QUARTILE_SALES asc;"
548;B;14;student;-1;4;"WITH QuartileSales AS (
    SELECT 
        YEAR,
        NAME,
        GLOBAL_SALES,
        NTILE(4) OVER (PARTITION BY YEAR ORDER BY GLOBAL_SALES DESC) AS QUARTILE_SALES
    FROM games
)
SELECT YEAR, NAME, GLOBAL_SALES, QUARTILE_SALES
FROM QuartileSales
ORDER BY YEAR DESC, QUARTILE_SALES, GLOBAL_SALES DESC;"
549;B;15;student;-1;4;"with rev as (
    SELECT name, year,
        SUM(global_sales) AS revenue
    FROM video_game_sales
    GROUP BY name, year
    ORDER BY name, year
) SELECT name, year, revenue,
    NTILE(4) OVER (
        PARTITION BY year
        ORDER BY revenue DESC
    ) AS quartile_sales
FROM rev
ORDER BY year DESC, quartile_sales"
550;B;10;student;-1;5;"SELECT publisher, year, name, eu_sales,
    RANK() OVER (PARTITION BY publisher, year ORDER BY eu_sales DESC) as num
FROM games
WHERE num <= 3
ORDER BY publisher, year, num;"
551;B;11;student;-1;5;"SELECT
    publisher,
    year,
    name,
    eu_sales,
    ROW_NUMBER() OVER (PARTITION BY publisher, year ORDER BY eu_sales DESC) AS NUM
FROM games
QUALIFY num <=3
ORDER BY publisher, year;"
552;B;12;student;-1;5;"SELECT
    publisher,
    year,
    name,
    eu_sales,
    RANK() OVER(
        PARTITION BY publisher
        order by year

    ) AS NUM
FROM GAMES
ORDER BY publisher,year,eu_sales DESC;"
553;B;14;student;-1;5;"WITH RankedGames AS (
    SELECT
        PUBLISHER,
        YEAR,
        NAME,
        EU_SALES,
        ROW_NUMBER() OVER (
        PARTITION BY PUBLISHER, YEAR 
        ORDER BY EU_SALES DESC
        ) AS NUM
    FROM games
) SELECT
    PUBLISHER,
    YEAR,
    NAME,
    EU_SALES,
    NUM
FROM RankedGames
WHERE NUM <= 3
ORDER BY PUBLISHER, YEAR, NUM;"
554;B;15;student;-1;5;"with rev as (
    SELECT genre, year,
        SUM(na_sales) AS revenue
    FROM video_game_sales
    GROUP BY genre, year
), ranked as (
    SELECT genre, year, revenue,
        RANK() OVER (
            PARTITION BY genre
            ORDER BY revenue DESC
        ) AS num
    FROM rev
) SELECT genre, year, revenue, num
FROM ranked
WHERE num <= 3
ORDER BY genre, num ASC;"
555;B;9;student;-1;6;"SELECT genre, year,
    SUM(na_sales) OVER (
        PARTITION BY genre
        ORDER BY year
    ) AS revenue,
    RANK() OVER (
        PARTITION BY genre
        ORDER BY year
    ) AS rank
FROM games
-- WHERE rank <= 3;
ORDER BY genre, rank;"
556;B;11;student;-1;6;"SELECT
    genre
    year,
    na_sales AS REVENUE,
    RANK() OVER(PARTITION BY genre ORDER BY na_sales DESC) AS rank
FROM games
QUALIFY rank <=3
ORDER BY genre, rank;"
557;B;14;student;-1;6;"WITH RankedSales AS (
    SELECT 
        genre,
        year,
        SUM(na_sales) AS revenue,
        RANK() OVER (
        PARTITION BY genre 
        ORDER BY SUM(na_sales) DESC
        ) AS rank
    FROM games
    GROUP BY genre, year
)
SELECT 
    genre,
    year,
    revenue,
    rank
FROM RankedSales
WHERE rank <= 3
ORDER BY genre, rank;"
558;B;15;student;-1;6;"CREATE OR REPLACE TABLE house_price (
    DATA VARIANT
);

CREATE OR REPLACE STAGE parquet_stage;

COPY INTO house_price
    FROM @parquet_stage/house_price.parquet
    FILE_FORMAT = (TYPE = 'parquet');"
559;B;9;student;-1;7;"CREATE OR REPLACE STAGE parquet_stage;

CREATE OR REPLACE TABLE house_price (
    data VARIANT
);

COPY INTO house_price
    FROM @parquet_stage
    FILE_FORMAT = (TYPE = PARQUET);"
560;B;10;student;-1;7;"CREATE OR REPLACE STAGE parquet_stage;

CREATE OR REPLACE TABLE house_price(data VARIANT);

COPY INTO house_price
  FROM @parquet_stage
  FILE_FORMAT = (TYPE = 'PARQUET');

SELECT 
    data:area::int AS area,
    data:price::int AS price
FROM house_price;"
561;B;11;student;-1;7;"create or replace table house_price(data variant);

CREATE STAGE parquet_stage;

COPY INTO house_price
  FROM @parquet_stage
  FILE_FORMAT = (TYPE = 'PARQUET');"
562;B;12;student;-1;7;"CREATE OR REPLACE TABLE HOUSE (
  data VARIANT
);

CREATE OR REPLACE STAGE house_stage;

COPY INTO house
FROM @house_stage
FILE_FORMAT = (TYPE = 'PARQUET');

SELECT COUNT(*) FROM HOUSE;

SELECT * FROM HOUSE LIMIT 5;"
563;B;13;student;-1;7;"CREATE OR REPLace table house_price(data VARIANT);
CREATE OR REPLACE STAGE parquet_stage;
COPY into house_price
    From @parquet_stage/house_price.parquet
    File_Format = (TYPE = PARQUET);"
564;B;14;student;-1;7;"CREATE OR REPLACE TABLE house_price (
    data VARIANT
);

CREATE OR REPLACE FILE FORMAT my_format2
  TYPE = 'JSON' 
  EMPTY_FIELD_AS_NULL = TRUE;

CREATE OR REPLACE STAGE parquet_stage;

CREATE OR REPLACE STAGE parquet_stage
  FILE_FORMAT = (TYPE = 'PARQUET');

CREATE OR REPLACE TABLE house_price
  AS
  SELECT * FROM @parquet_stage
  FILE_FORMAT = (TYPE = 'PARQUET');"
565;B;15;student;-1;7;"CREATE OR REPLACE TABLE house_price (
    DATA VARIANT
);

CREATE OR REPLACE STAGE parquet_stage;

COPY INTO house_price
    FROM @parquet_stage/house_price.parquet
    FILE_FORMAT = (TYPE = 'parquet');"
566;B;9;student;-1;8;"SELECT 
    ROUND(AVG(data:price)) AS avg_price, 
    ROUND(MEDIAN(data:price)) AS median_price
FROM house_price;"
567;B;10;student;-1;8;"SELECT 
    round(avg(data:price::int)) AS avg_price,
    round(median(data:price::int)) AS median_price
FROM house_price;"
568;B;11;student;-1;8;"SELECT 
    AVG(data:price) AS AVG_PRICE,
    MEDIAN(data:price) AS MEDIAN_PRICE
FROM house_price
WHERE data:price IS NOT NULL;"
569;B;12;student;-1;8;"SELECT 
    round(AVG(data:price::int),0) AS AVERAGE,
    round(MEDIAN(data:price::int),0) as median
    
FROM house;"
570;B;13;student;-1;8;"SELECT
    AVG(data:price::int) As AVG_price,
    MEDIAN(data:price::int) AS MEDIAN_price
From house_price;"
571;B;14;student;-1;8;"SELECT 
  AVG(price) AS AVG_PRICE,
  MEDIAN(price) AS MEDIAN_PRICE
FROM house_price
WHERE price IS NOT NULL;"
572;B;15;student;-1;8;"SELECT 
    ROUND(MEDIAN(data:price::int)) AS median_price,
    ROUND(AVG(data:price::int)) AS avg_price
FROM house_price
WHERE data:price::int IS NOT NULL;"
573;B;9;student;-1;9;"SELECT 
    data:furnishingstatus::STRING AS furnishingstatus,
    COUNT(*) AS count,
    ROUND(AVG(data:price::INT)) AS avg_price
FROM house_price
GROUP BY furnishingstatus
ORDER BY avg_price DESC;"
574;B;10;student;-1;9;"SELECT data:furnishingstatus::STRING, COUNT(*), round(avg(data:price::INT)) FROM house_price
GROUP BY data:furnishingstatus::STRING
ORDER BY data:furnishingstatus::STRING DESC;"
575;B;11;student;-1;9;"SELECT
    data:furnishingstatus,
    COUNT(*) AS COUNT,
    ROUND(AVG(data:price)) AS AVG_PRICE
FROM house_price
GROUP BY data:furnishingstatus
ORDER BY data:furnishingstatus ASC;"
576;B;12;student;-1;9;"SELECT 
    data:furnishingstatus::string AS FS,
    COUNT(*) AS POCET,
    Round(AVG(data:price::INT),0) AS cena
FROM HOUSE
GROUP BY FS
ORDER BY cena DESC;"
577;B;13;student;-1;9;"SELECT
    data:furnishingstatus::string AS furnishingstatus,
    COUNT(*) AS count,
    AVG(data:price::int)
From house_price
group by furnishingstatus
order by furnishingstatus;"
578;B;14;student;-1;9;"SELECT 
  furnishingstatus AS FURNISHINGSTATUS,
  COUNT(*) AS COUNT,
  AVG(price) AS AVG_PRICE
FROM house_price
WHERE price IS NOT NULL
GROUP BY furnishingstatus
ORDER BY furnishingstatus;"
579;B;15;student;-1;9;"SELECT 
    data:furnishingstatus::string AS furnished_status,
    COUNT(*) AS COUNT,
    ROUND(AVG(data:price::int)) AS avg_price
FROM house_price
GROUP BY data:furnishingstatus::string
ORDER BY COUNT ASC;"
580;B;9;student;-1;10;"SELECT 
    data:furnishingstatus::STRING AS furnishingstatus,
    ROUND(data:price::INT) AS price,
    data:area::INT AS area,
    RANK() OVER (
        PARTITION BY furnishingstatus
        ORDER BY price DESC
    ) AS rank
FROM house_price 
-- WHERE rank <= 3
ORDER BY furnishingstatus, rank;"
581;B;13;student;-1;10;"Select
    data:furnishingstatus::string AS furnishingstatus,
    data:price::int AS price,
    data:area::int AS area,
    RANK() OVER(
    PARTITION BY furnishingstatus
    ORDER BY price
    
    )
From house_price;"
582;B;15;student;-1;10;"with ranked as (
    SELECT 
        data:price::int AS PRICE, 
        data:furnishingstatus::string AS FURNISHING_STATUS,
        data:area::int AS AREA,
        RANK() OVER(
            PARTITION BY data:furnishingstatus::string
            ORDER BY data:price::int DESC
        ) AS RANK
    FROM house_price
) SELECT FURNISHING_STATUS, PRICE, AREA, RANK
FROM ranked
WHERE RANK <= 3
ORDER BY FURNISHING_STATUS, RANK;"
583;C;17;student;-1;1;"CREATE OR REPLACE FILE FORMAT my_format
  TYPE = 'CSV'
  FIELD_DELIMITER = ';'
  SKIP_HEADER = 1
  NULL_IF = ('NULL', 'null')
  EMPTY_FIELD_AS_NULL = TRUE
  TIMESTAMP_FORMAT = 'DD.MM.YYYY HH24:MI';

CREATE OR REPLACE STAGE my_stage
  FILE_FORMAT = my_format;

CREATE OR REPLACE TABLE retail (
    invoice_no INT,
    stock_code STRING,
    description STRING,
    quantity INT,
    invoice_date DATETIME,
    unit_price  FLOAT,
    customer_id INT,
    country STRING
);

  COPY INTO retail
  FROM @my_stage/online_retail.csv
  FILE_FORMAT = (FORMAT_NAME = my_format)
  ON_ERROR = 'CONTINUE';

  SELECT * FROM retail"
584;C;18;student;-1;1;"CREATE OR REPLACE TABLE retail (
    invoice_no INT,
    stock_code STRING,
    description STRING,
    quantity INT,
    invoice_date TIMESTAMP,
    unit_price FLOAT,
    customer_id INT,
    country STRING
);


CREATE OR REPLACE FILE FORMAT my_format
  TYPE = 'CSV'
  FIELD_DELIMITER = ','
  SKIP_HEADER = 1
  NULL_IF = ('NULL', 'null')
  EMPTY_FIELD_AS_NULL = TRUE
  TIMESTAMP_FORMAT = 'DD.MM.YYYY HH24:MI';

CREATE OR REPLACE STAGE my_stage
  FILE_FORMAT = my_format;

COPY INTO retail
  FROM @my_stage/online_retail.csv
  FILE_FORMAT = (FORMAT_NAME = my_format)
  ON_ERROR = 'CONTINUE';"
585;C;19;student;-1;1;"create or replace table retail(
invoice_no int,
atock_code string,
description string,
quantity int,
invoice_date datetime,
unit_price number(10,2),
customer_id int,
country string
);

CREATE OR REPLACE FILE FORMAT my_format
TYPE = 'csv',
FIELD_DELIMITER = ';',
SKIP_HEADER = 1,
NULL_IF = ('NULL', 'null'),
EMPTY_FIELD_AS_NULL = TRUE,
TIMESTAMP_FORMAT = 'DD.MM.YYYY HH24:MI';

CREATE OR REPLACE STAGE my_stage
FILE_FORMAT = my_format;

copy into retail
from @my_stage/online_retail.csv
FILE_FORMAT = (FORMAT_NAME = my_format)
ON_ERROR = 'CONTINUE';

SELECT * FROM retail limit 5;"
586;C;20;student;-1;1;"use warehouse VIPER_WH;
create or replace schema test;
use schema test;

CREATE OR REPLACE file format my_format
  TYPE = 'CSV'
  FIELD_DELIMITER = ';'
  SKIP_HEADER = 1
  NULL_IF = ('NULL', 'null')
  EMPTY_FIELD_AS_NULL = TRUE
  TIMESTAMP_FORMAT = 'DD.MM.YYYY HH24:MI';

CREATE OR REPLACE stage my_stage
  FILE_FORMAT =my_format;

create or replace table  retail (
    invoice_no int , 
    stock_code string , 
     description string , 
     quantity int , 
     invoice_date date , 
      unit_price number(10 ,2) ,
      customer_id int , 
       country string 
)

copy into retail
  FROM @my_stage/online_retail.csv
  FILE_FORMAT = (FORMAT_NAME = my_format)
  ON_ERROR = CONTINUE;"
587;C;21;student;-1;1;"CREATE OR REPLACE TABLE retail(
invoice_no INT,
stock_code STRING,
description STRING,
quantity INT,
invoice_date DATE,
unit_price NUMBER(10,2),
customer_id INT,
country STRING
);

CREATE or replace FILE FORMAT my_format
  TYPE = 'CSV'
  FIELD_DELIMITER=';'
  SKIP_HEADER = 1
  NULL_IF = ('NULL', 'null')
  EMPTY_FIELD_AS_NULL = TRUE
  TIMESTAMP_FORMAT = 'DD.MM.YYYY HH24:MI';

CREATE OR REPLACE stage my_stage
  FILE_FORMAT = my_format;

COPY INTO retail
  FROM @my_stage/online_retail.csv
  FILE_FORMAT = (FORMAT_NAME = my_format)
  ON_ERROR = CONTINUE;"
588;C;22;student;-1;1;"CREATE OR REPLACE TABLE retail(
    invoice_no int,
    stock_code string,
    description string,
    quantity int,
    invoice_date DATETIME,
    unit_price number(10, 2),
    customer_id int,
    country string
);

CREATE OR REPLACE FILE FORMAT my_format
    TYPE = 'CSV'
  FIELD_DELIMITER = ';'
  SKIP_HEADER = 1
  NULL_IF = ('NULL', 'null')
  EMPTY_FIELD_AS_NULL = TRUE
  TIMESTAMP_FORMAT = 'DD.MM.YYYY HH24:MI';

CREATE OR REPLACE STAGE my_stage
    FILE_FORMAT = my_format;

COPY INTO retail
  FROM @my_stage
  FILE_FORMAT = (FORMAT_NAME = my_format)
  ON_ERROR = 'CONTINUE';"
589;C;20;student;-1;2;"SELECT *
FROM (SELECT
        country,
        stock_code,
        QUANTITY,
        AVG(QUANTITY) OVER (
            PARTITION BY country
            ORDER BY stock_code
            ROWS BETWEEN 6 PRECEDING AND CURRENT ROW
        ) AS QTY_AVG_LAST7D
    FROM retail
) AS subquery
WHERE QTY_AVG_LAST7D > 1;"
590;C;20;student;-1;3;"select stock_code , UNIT_PRICE , 
    lag(QUANTITY) over (
        partition by  country  
        order by stock_code  
    )as res1 ,  QUANTITY - lag( QUANTITY) over (
        partition by country  
        order by stock_code 
    )as PREVIOUS_PRICE 
from retail  
order by stock_code , UNIT_PRI"
591;C;18;student;-1;4;"SELECT country, DATE_TRUNC('MONTH', invoice_date), quantity*unit_price AS revenue,
    NTILE(4) over (
        PARTITION BY country
        order by revenue
    ) AS country_quartile
FROM retail
ORDER BY country, revenue;"
592;C;19;student;-1;4;"select country, invoice_date, (quantity * unit_price) as revenue, country_qrt, 
NTILE(revenue) over (partition by country order by invoice_date) as country_qrt
from retail
order by country_qrt DESC;"
593;C;20;student;-1;4;"WITH monthly_revenue AS (
    SELECT
        country,
        DATE_TRUNC('month', invoice_date) AS month,
        SUM(quantity * unit_price) AS revenue
    FROM
        retail
    GROUP BY
        country,
        DATE_TRUNC('month', invoice_date)
),ranked_revenue AS (
    SELECT country,
        month,
        revenue,
        NTILE(4) OVER (PARTITION BY country ORDER BY revenue) AS country_quartile
    FROM
        monthly_revenue
)
SELECT country, month,revenue, country_quartile
FROM
    ranked_revenue
ORDER BY country,month;"
594;C;18;student;-1;5;"WITH (
SELECT INVOICE_NO, STOCK_CODE, (quantity * unit_price) AS AMOUNT
ORDER BY AMOUNT DESC
FROM retail) AS tabulka4;

SELECT (quantity * unit_price) AS amount,
ROW_NUMBER() OVER (
    PARTITION BY invoice_no
    ORDER BY amount
) AS NUM, invoice_no, stock_code
FROM tabulka4
LIMIT 3;"
595;C;20;student;-1;5;"WITH RankedProducts AS (
    SELECT
        ROW_NUMBER() OVER (
            PARTITION BY invoice_no
            ORDER BY (quantity * unit_price) DESC
        ) AS num,
        invoice_no,
        stock_code,
        (quantity * unit_price) AS amount
    FROM
        retail
)SELECT num, invoice_no,  stock_code,
    ROUND(amount::numeric, 2) AS amount
FROM RankedProducts
WHERE num <= 3
ORDER BY invoice_no,num;"
596;C;18;student;-1;6;"SELECT
ROW_NUMBER() OVER (
    PARTITION BY invoice_no
    ORDER BY unit_price DESC
) AS RANKK, invoice_no, stock_code, unit_price
FROM retail
ORDER BY invoice_no, RANKK, stock_code;"
597;C;19;student;-1;6;"select rank, invoice_no, stock_code, unit_price,
RANK() over (partition by invoice_no order by unit_price) as rank
from retail
order by rank;"
598;C;20;student;-1;6;"WITH RankedProducts AS (
    SELECT INVOICE_NO,  STOCK_CODE,  UNIT_PRICE,
        ROW_NUMBER() OVER (
            PARTITION BY INVOICE_NO
            ORDER BY UNIT_PRICE DESC
        ) AS RANK
    FROM retail
)
SELECT
    RANK,     INVOICE_NO,     STOCK_CODE,  UNIT_PRICE
FROM
    RankedProducts
WHERE RANK <= 5
ORDER BY INVOICE_NO, RANK, STOCK_CODE;"
599;C;17;student;-1;7;"CREATE OR REPLACE FILE FORMAT json_format
  TYPE = 'JSON'
  STRIP_OUTER_ARRAY = TRUE;

CREATE OR REPLACE STAGE json_stage
  FILE_FORMAT = json_format;

CREATE OR REPLACE TABLE cities_pop(data VARIANT);

COPY INTO cities_pop
  FROM @json_stage/json_format
  FILE_FORMAT = json_format;"
600;C;18;student;-1;7;"CREATE TABLE cities_pop (data VARIANT);

CREATE OR REPLACE file format json_format
  TYPE = 'JSON'
  STRIP_OUTER_ARRAY = true;

CREATE OR REPLACE stage json_stage
  FILE_FORMAT = json_format;

COPY INTO cities_pop
  FROM @json_stage/cities_population.json
  FILE_FORMAT = (FORMAT_NAME = json_format);

SELECT * FROM cities_pop
LIMIT 10;"
601;C;19;student;-1;7;"CREATE OR REPLACE FILE FORMAT json_format
TYPE = 'json'
STRIP_OUTER_ARRAY = true;

CREATE OR REPLACE STAGE json_stage
FILE_FORMAT = json_format;

create or replace table cities_pop (data variant);

copy into cities_pop
from @json_stage
file_format = json_format;"
602;C;20;student;-1;7;"CREATE OR REPLACE FILE FORMAT json_format
TYPE = 'json'
STRIP_OUTER_ARRAY = true;

CREATE OR REPLACE STAGE json_stage
FILE_FORMAT = json_format;

create or replace table cities_pop (data variant);

copy into cities_pop
from @json_stage
file_format = json_format;"
603;C;21;student;-1;7;"CREATE OR REPLACE TABLE cities_pop(data VARIANT);

CREATE OR REPLACE FILE FORMAT json_format
  TYPE = 'JSON'
  STRIP_OUTER_ARRAY = TRUE;

CREATE OR REPLACE STAGE json_stage
  FILE_FORMAT = json_format;


COPY INTO cities_pop
  FROM @json_stage/cities_population.json
  FILE_FORMAT = (FORMAT_NAME = json_format);"
604;C;22;student;-1;7;"CREATE OR REPLACE TABLE cities_pop(
    data variant
);

CREATE OR REPLACE FILE FORMAT json_format
  TYPE = 'JSON'
  STRIP_OUTER_ARRAY = TRUE;

CREATE OR REPLACE stage json_stage
  FILE_FORMAT = json_format;

COPY INTO cities_pop
  FROM @json_stage
  FILE_FORMAT = json_format;"
605;C;17;student;-1;8;"SELECT 
data:city::STRING as CITY,
data:country::STRING as COUNTRY,
data:population:by_year::STRING as POP2025
FROM cities_pop
WHERE data:city::STRING LIKE '%San%' OR data:city::STRING LIKE'%san%'
ORDER BY POP2025 DESC;"
606;C;18;student;-1;8;"SELECT 
    data:city::STRING AS CITY,
    data:country::STRING AS COUNTRY,
    data:""2025_population""::STRING AS POP2025
FROM cities_pop
WHERE city ILIKE '%san%';"
607;C;19;student;-1;8;"select 
data:city::string as city,
data:country::string as country,
data:""2025_population""::float as pop2025
from cities_pop WHERE city ILIKE '%san%';"
608;C;20;student;-1;8;"select 
    data:city::string as CITY ,
    data:country::string as COUNTRY,  
    data:2025_poulation::int as POPULATION_2025, 
from cities_pop  
where  data:city::string ILIKE ""%San%"";"
609;C;18;student;-1;10;"SELECT 
    data:city::STRING AS CITY,
    AVG(f.value:population::INT) AS AVERAGE
FROM cities_pop,
    lateral flatten (input => TO_ARRAY(data:population:districts)) f
GROUP BY CITY
order by AVERAGE desc;"
610;D;23;student;-1;1;"CREATE OR REPLACE FILE FORMAT my_format
  TYPE = 'csv'
  FIELD_DELIMITER = ','
  SKIP_HEADER = 1
  NULL_IF = ('NULL', 'null')
  EMPTY_FIELD_AS_NULL = TRUE;

CREATE OR REPLACE STAGE my_stage
  FILE_FORMAT = my_format;

CREATE OR REPLACE TABLE games (
    id int,
    name string,
    platform string,
    year int,
    genre string,
    publisher string,
    na_sales float,
    eu_sales float,
    jp_sales float,
    other_sales float,
    global_sales float
);

COPY INTO games
  FROM @my_stage
  FILE_FORMAT = (FORMAT_NAME = my_format)
  ON_ERROR = 'CONTINUE';"
611;D;24;student;-1;1;"CREATE OR replace FILE FORMAT my_format
  TYPE = 'CSV'
  FIELD_DELIMITER = ','
  SKIP_HEADER = 1
  NULL_IF = ('NULL', 'null')
  EMPTY_FIELD_AS_NULL = TRUE;


CREATE OR REPLACE stage my_stage
FILE_FORMAT = my_format;

create table games(
    id  int,
    name  text,
    platform  text,
    year int,
    genre text,
    publisher text,
    na_sales float,
    eu_sales float,
    jp_sales  float,
    other_sales  float,
    global_sales  float
);

copy into games
from @my_stage/video_game_sales.csv
FILE_FORMAT = my_format
on_error ='CONTINUE'"
612;D;25;student;-1;1;"CREATE OR REPLACE TABLE games
(
id int,
name string,
platform string,
year int,
genre string,
publisher string,
na_sales NUMBER(10,4),
eu_sales NUMBER(10,4),
jp_sales NUMBER(10,4),
other_sales NUMBER(10,4),
global_sales NUMBER(10,4)
);

CREATE OR REPLACE FILE FORMAT my_format
  TYPE = 'csv'
  FIELD_DELIMITER = ','
  SKIP_HEADER = 1
  NULL_IF = ('NULL', 'null')
  EMPTY_FIELD_AS_NULL = TRUE;

CREATE OR REPLACE STAGE my_stage
  FILE_FORMAT = my_format;

COPY INTO games
  FROM @my_stage/video_game_sales.csv
  FILE_FORMAT = (FORMAT_NAME = my_format)
  ON_ERROR = 'CONTINUE';
SELECT * FROM games LIMIT 10;"
613;D;26;student;-1;1;"CREATE OR REPLACE FILE FORMAT my_format 
TYPE = 'CSV'
FIELD_DELIMITER = ','
SKIP_HEADER = 1
NULL_IF = ('NULL', 'null')
EMPTY_FIELD_AS_NULL = TRUE;

CREATE OR REPLACE STAGE my_stage
FILE_FORMAT = my_format;

CREATE OR REPLACE TABLE games (
    id INT AUTOINCREMENT PRIMARY KEY,
    name STRING,
    platform STRING,
    year STRING,
    genre STRING,
    publisher STRING,
    na_sales NUMBER(10, 2),
    eu_sales NUMBER(10, 2),
    jp_sales NUMBER(10, 2),
    other_sales NUMBER(10, 2),
    global_sales NUMBER(10, 2)
);

COPY INTO games 
FROM @my_stage/video_game_sales.csv
ON_ERROR = 'CONTINUE';"
614;D;27;student;-1;1;"CREATE OR REPLACE TABLE games (
    id INT,
    name STRING,
    platform STRING,
    year INT,
    genre STRING,
    publisher STRING,
    na_sales NUMBER(10,2),
    eu_sales NUMBER(10,2),
    jp_sales NUMBER(10,2),
    other_sales NUMBER(10,2),
    global_sales NUMBER(10,2)
);

CREATE OR REPLACE FILE FORMAT my_format
  TYPE = 'CSV'
  FIELD_DELIMITER = ','
  SKIP_HEADER = 1
  NULL_IF = ('NULL', 'null')
  EMPTY_FIELD_AS_NULL = TRUE;

CREATE OR REPLACE STAGE my_stage
  FILE_FORMAT = my_format;

COPY INTO games
  FROM @my_stage/video_game_sales.csv
  FILE_FORMAT = (FORMAT_NAME = my_format)
  ON_ERROR = 'CONTINUE';"
615;D;28;student;-1;1;"CREATE OR REPLACE TABLE games(
id int,
name text,
platform text,
year number(4,0),
genre text,
publisher text,
na_sales number(12,2),
eu_sales number(12,2),
jp_sales number(12,2),
other_sales number(12,2),
global_sales number(12,2)
);
describe table games;

CREATE OR REPLACE file format my_format
  TYPE = 'csv'
  FIELD_DELIMITER = ','
  SKIP_HEADER = 1
  NULL_IF = ('NULL', 'null')
  EMPTY_FIELD_AS_NULL = TRUE;

CREATE OR REPLACE stage my_stage
  FILE_FORMAT = my_format;

COPY INTO games
  FROM @my_stage/video_game_sales.csv
  FILE_FORMAT = (FORMAT_NAME = my_format)
ON_ERROR = 'CONTINUE';

SELECT * FROM GAMES LIMIT 10;"
616;D;29;student;-1;1;"CREATE OR REPLACE TABLE games (
    id INT PRIMARY KEY AUTOINCREMENT,
    name string,
    platform string,
    year int,
    genre string,
    publisher string,
    na_sales number(10,2),
    eu_sales number(10,2),
    jp_sales number(10,2),
    other_sales number(10,2),
    global_sales number(10,2)
);

CREATE OR REPLACE FILE FORMAT my_format
  TYPE = 'CSV'
  FIELD_DELIMITER = ','
  SKIP_HEADER = 1
  NULL_IF = ('NULL', 'null')
  EMPTY_FIELD_AS_NULL = TRUE;

CREATE OR REPLACE stage my_stage
  FILE_FORMAT = my_format;

COPY INTO games
  FROM @my_stage
  FILE_FORMAT = (FORMAT_NAME = my_format)
  ON_ERROR = 'CONTINUE';

SELECT * FROM games;"
617;D;30;student;-1;1;"use warehouse termite_wh;
use database termite_db;
CREATE SCHEMA if not exists zapocet;
use schema zapocet;

CREATE OR REPLACE FILE FORMAT my_format
  TYPE = 'CSV'
  FIELD_DELIMITER = ','
  SKIP_HEADER = 1
  NULL_IF = ('NULL', 'null')
  EMPTY_FIELD_AS_NULL = TRUE;

CREATE OR REPLACE STAGE my_stage
  FILE_FORMAT = my_format;

  create or replace table games (
 id INT AUTOINCREMENT PRIMARY KEY,
 name string,
 platform string,
 year int,
 genre string,
 publisher string,
 na_sales number(10,2),
eu_sales number(10,2),
jp_sales number(10,2),
other_sales number(10,2),
global_sales number(10,2)
  ); 

  describe table games;

COPY INTO games
  FROM @my_stage/video_game_sales.csv
  FILE_FORMAT = (FORMAT_NAME = my_format)
  ON_ERROR = CONTINUE;

  Select * from games;"
618;D;24;student;-1;2;"select distinct genre,year, avg(na_sales) over (partition by genre, year order by year
) as YEAR_SALES 
from games

order by genre, year"
619;D;25;student;-1;2;"SELECT genre, year,
ROUND(AVG(na_sales) OVER (PARTITION BY genre ORDER BY year),2) AS YEAR_SALES,
ROUND(AVG(na_sales) OVER (PARTITION BY genre ORDER BY year
RANGE BETWEEN INTERVAL '60 MONTH' PRECEDING AND CURRENT ROW),2) AS AVG_LAST_5Y_SALES
FROM games
order by year;"
620;D;26;student;-1;2;"SELECT genre, year, YEAR_SALES,
ROUND(AVG(YEAR_SALES) OVER (
    PARTITION BY genre
    ORDER BY year
    ROWS BETWEEN 5 PRECEDING AND CURRENT ROW
), 2) AS AVG_LAST_5Y_SALES
FROM (SELECT genre, year,
ROUND(SUM(na_sales), 2) AS YEAR_SALES
FROM GAMES
GROUP BY genre, year)
ORDER BY genre, year;"
621;D;27;student;-1;2;"  SELECT genre, year, 
   AVG(na_sales) OVER (
    PARTITION BY year, genre
    ORDER BY year  
    ) AS YEAR_SALES, 
   AVG(na_sales) OVER (
    PARTITION BY year, genre
    ORDER BY year
    RANGE BETWEEN INTERVAL '5 YEAR' PRECEDING AND CURRENT ROW //tento riadok by fungoval, keby si v tabulke nastavim ten year na DATE namiesto INT :D
   ) AS AVG_LAST_5Y_SALES
  FROM games;"
622;D;30;student;-1;2;"with year_na_sales as(
  Select genre, year, SUM(na_sales) as yr_na_sales from games
  group by genre, year
  order by genre, year
  ) SELECT genre, year, yr_na_sales, avg(yr_na_sales) OVER (
  PARTITION BY genre
  order BY year
  rows between 5 PRECEDING AND CURRENT ROW
  ) as last_5_year_sales
  from year_na_sales
  order by genre, year;"
623;D;23;student;-1;3;"SELECT publisher, name, year, LAG(year) OVER (PARTITION BY publisher ORDER BY publisher ASC) prev_year, (prev_year - year)
FROM games
GROUP BY publisher, name, year
ORDER BY publisher ASC;"
624;D;24;student;-1;3;"select PUBLISHER, name, year, lag(year) over (order by publisher,year, name) as prev_year, year - lag(year) over (order by publisher, year, name ) as year_gap
from games
order by publisher, year, name"
625;D;25;student;-1;3;"SELECT publisher, name, year, 
LAG(year) OVER(PARTITION BY publisher ORDER BY year,name) AS PREV_YEAR,
year-LAG(year) OVER(PARTITION BY publisher ORDER BY year) AS YEAR_GAP
FROM games
ORDER BY publisher, year, name;"
626;D;26;student;-1;3;"SELECT publisher, name, year,
LAG(year) OVER (
    PARTITION BY publisher
    ORDER BY year, name
) AS PREV_YEAR,
year - LAG(year) OVER (
    PARTITION BY publisher
    ORDER BY year, name
) AS YEAR_GAP
FROM games
ORDER BY publisher, name, year;"
627;D;27;student;-1;3;"  SELECT publisher, name, year,
    LAG(year) OVER (
        PARTITION BY publisher
        ORDER BY year
    ) AS PREV_YEAR, 
    year - LAG(year) OVER (
        PARTITION BY publisher
        ORDER BY year
    ) AS PREV_YEAR
    FROM games
    ORDER BY publisher, year;"
628;D;28;student;-1;3;"SELECT
    PUBLISHER,
    NAME,
    YEAR,
    LAG(year) over (partition by year order by name) as PREV_YEAR,//fix it
    (YEAR - PREV_YEAR) as YEAR_GAP
FROM GAMES
ORDER BY PUBLISHER, YEAR;"
629;D;29;student;-1;3;"SELECT publisher,
       name,
       year,
       LAG(year) OVER(
       PARTITION BY publisher ORDER BY year
       ) AS PREV_YEAR,
       year - LAG(year) OVER(
       PARTITION BY publisher ORDER BY year
       ) AS YEAR_GAP
FROM games
ORDER BY publisher, name, year;"
630;D;30;student;-1;3;"with prev as (
  SELECT publisher, name, year, LAG(year) OVER (
  PARTITION by publisher
  order by year
  ) as prev_year,
  from games
  order by publisher, year, prev_year, name
  ) select publisher, name, year, year-prev_year as year_gap from prev;"
631;D;24;student;-1;4;"select publisher, name, global_sales, dense_rank() over(order by global_sales desc) as quartile_sales
from games"
632;D;25;student;-1;4;"SELECT publisher, name, global_sales,
NTILE(4) OVER(ORDER BY global_sales DESC) AS QUARTILE_SALES
FROM games;"
633;D;26;student;-1;4;"SELECT publisher, name, global_sales,
NTILE(4) OVER (
PARTITION BY publisher
ORDER BY global_sales DESC
) AS QUARTILE_SALES
FROM games
ORDER BY global_sales DESC;"
634;D;27;student;-1;4;"SELECT publisher, name, global_sales,
        NTILE(4) OVER (
            PARTITION BY publisher
            ORDER BY global_sales DESC
        ) AS QUARTILE_SALES
    FROM games
    ORDER BY global_sales DESC;"
635;D;30;student;-1;4;"  SELECT publisher, name, global_sales, NTILE(4) OVER (
  PARTITION BY publisher
  order by global_sales DESC
  ) from games
  order by global_sales DESC;"
636;D;24;student;-1;5;"select * from(
select genre, year, name, global_sales, rank() over(partition by genre, year order by genre)
from games
order by genre, year)
"
637;D;25;student;-1;5;"SELECT genre,year, name, global_sales,
ROW_NUMBER() OVER(PARTITION BY year ORDER BY global_sales DESC) AS NUM
FROM games
ORDER BY genre, year, num;"
638;D;26;student;-1;5;"SELECT * FROM (SELECT genre, year, name, global_sales,
ROW_NUMBER() OVER (
    PARTITION BY genre, year
    ORDER BY year ASC, global_sales DESC
) AS NUM
FROM games
order by genre, year, NUM)
WHERE NUM <= 3;"
639;D;27;student;-1;5;"    SELECT genre, year, name, global_sales,
        DENSE_RANK() OVER (
            PARTITION BY genre
            ORDER BY global_sales DESC
        ) AS NUM
    FROM games
    ORDER BY genre, year, NUM;"
640;D;29;student;-1;5;"SELECT genre, year, name, global_sales,
DENSE_RANK() OVER(PARTITION BY genre ORDER BY global_sales DESC) AS Num
FROM games
ORDER BY genre, year, Num;"
641;D;30;student;-1;5;"SELECT genre, year, name, global_sales, RANK() OVER (
  PARTITION BY genre, year
  order by global_sales DESC
  ) as num from games
  order by genre, year, num;"
642;D;23;student;-1;6;"SELECT year, name, global_sales, RANK() OVER (PARTITION BY year ORDER BY global_sales DESC) RANK
FROM games
GROUP BY year, name, global_sales
ORDER BY year, RANK ASC
LIMIT 5;"
643;D;24;student;-1;6;"select year, name, global_sales, rank from (
select year, name, global_sales, rank() over(partition by year order by global_sales desc) as rank
from games
order by year, global_sales desc)
where rank <6"
644;D;25;student;-1;6;"SELECT year, name, global_sales,
RANK() OVER(PARTITION BY year ORDER BY global_sales DESC) AS RANK
FROM games

ORDER BY year;"
645;D;26;student;-1;6;"SELECT * FROM (SELECT year, name, global_sales,
RANK() OVER (
    PARTITION BY year
    ORDER BY year ASC, global_sales DESC
) AS RANK
FROM games
order by year, RANK)
WHERE RANK <= 5;"
646;D;27;student;-1;6;"  SELECT year, name, global_sales,
        DENSE_RANK() OVER (
            PARTITION BY year
            ORDER BY global_sales DESC
        ) AS RANK
    FROM games
    ORDER BY year, RANK;"
647;D;29;student;-1;6;"SELECT year, name, global_sales,
RANK() OVER(PARTITION BY year ORDER BY global_sales DESC) AS RANK
FROM games
ORDER BY year;"
648;D;30;student;-1;6;"with top5 as (
  SELECT year, name, global_sales, RANK() OVER (
  PARTITION BY year
  order by global_sales DESC
  ) as rank from games
  ) select * from top5 where rank <=5 order by year, rank;"
649;D;23;student;-1;7;"CREATE FILE FORMAT parquet_stage;

CREATE TABLE house_price (data VARIANT);

COPY INTO house_price
  FROM @my_stage/house_price.parquet
  FILE_FORMAT = (TYPE = 'PARQUET');"
650;D;24;student;-1;7;"CREATE FILE FORMAT parquet_stage;

CREATE TABLE house_price (data VARIANT);

COPY INTO house_price
  FROM @my_stage/house_price.parquet
  FILE_FORMAT = (TYPE = 'PARQUET');"
651;D;25;student;-1;7;"CREATE OR REPLACE TABLE house_price
(data VARIANT);

CREATE OR REPLACE STAGE parquet_stage;

COPY INTO house_price
  FROM @parquet_stage/house_price.parquet
  FILE_FORMAT = (TYPE = 'PARQUET');"
652;D;26;student;-1;7;"CREATE OR REPLACE FILE FORMAT my_format2 
TYPE = 'PARQUET';

CREATE OR REPLACE STAGE parquet_stage
FILE_FORMAT = my_format2;

CREATE TABLE house_price (
    data VARIANT
);

COPY INTO house_price
  FROM @parquet_stage/
  FILE_FORMAT = (TYPE = 'PARQUET');"
653;D;27;student;-1;7;"CREATE OR REPLACE TABLE house_price(data VARIANT);

CREATE OR REPLACE STAGE parquet_stage;

COPY INTO house_price
  FROM @parquet_stage/house_price.parquet
  FILE_FORMAT = (TYPE = PARQUET);

    "
654;D;29;student;-1;7;"CREATE OR REPLACE TABLE house_price (
    data VARIANT
);

CREATE OR REPLACE stage parquet_stage;

COPY INTO house_price
  FROM @parquet_stage
  FILE_FORMAT = (TYPE = parquet);

SELECT * FROM house_price;"
655;D;30;student;-1;7;"CREATE OR REPLACE STAGE parquet_stage;

COPY INTO house_price
FROM @parquet_stage/house_prices.parquet
FILE_FORMAT = (TYPE = 'PARQUET');"
656;D;23;student;-1;8;"SELECT COUNT(*) TOTAL, (SELECT COUNT(*) FROM house_price WHERE data:airconditioning::string = 'yes') WITH_AC, ROUND(DIV0(WITH_AC, TOTAL) * 100, 2) PERCENT_WITH_AC
FROM house_price;"
657;D;25;student;-1;8;"SELECT 
COUNT(*) As TOTAL,
(SELECT COUNT(data:airconditioning::string) as AIRCON  FROM house_price WHERE data:airconditioning ILIKE 'yes') AS WITH_AC,
ROUND((WITH_AC/TOTAL)*100,2) as PERCENT_WITH_AC
FROM house_price;"
658;D;26;student;-1;8;"SELECT COUNT(*) AS TOTAL,
(SELECT COUNT(*) FROM house_price WHERE data:airconditioning = 'yes') AS WITH_AC,
ROUND(WITH_AC / TOTAL * 100, 2) AS PERCENT_WITH_AC
FROM house_price;"
659;D;29;student;-1;8;"SELECT COUNT(*) AS TOTAL, (SELECT COUNT(data:airconditioning::string) FROM house_price WHERE data:airconditioning = 'yes') AS WITH_AC, ROUND(WITH_AC / TOTAL * 100, 2) AS PERCENT_WITH_AC
FROM house_price;"
660;D;23;student;-1;9;"SELECT data:bedrooms::int BEDROOMS, COUNT(*) COUNT, ROUND(AVG(data:price::int)) AVG_PRICE,
FROM house_price
GROUP BY BEDROOMS
ORDER BY BEDROOMS ASC;"
661;D;25;student;-1;9;"SELECT
data:bedrooms::int AS BEDROOMS,
COUNT(*) AS COUNT,
ROUND(AVG(data:price::int)) AS AVG_PRICE
FROM house_price 
GROUP BY BEDROOMS;"
662;D;26;student;-1;9;"SELECT
data:bedrooms AS BEDROOMS,
COUNT(*) AS COUNT,
ROUND(AVG(data:price)) AS AVG_PRICE
FROM house_price
GROUP BY BEDROOMS
order by BEDROOMS;"
663;D;27;student;-1;9;"SELECT 
    data:bedrooms AS bedrooms, COUNT(*), ROUND(AVG(data:price), 0)
FROM house_price
GROUP BY bedrooms
ORDER BY bedrooms;"
664;D;29;student;-1;9;"SELECT DISTINCT data:bedrooms AS bedrooms, COUNT(data:bedrooms) AS COUNT, ROUND(AVG(data:price)) AS AVG_PRICE
FROM house_price
GROUP BY bedrooms
ORDER BY bedrooms;"
665;D;23;student;-1;10;"SELECT data:stories::int STORIES, ROUND(AVG(data:price::int)) AVG_PRICE, RANK() OVER (ORDER BY AVG_PRICE DESC) RANK
FROM house_price
GROUP BY STORIES
ORDER BY AVG_PRICE DESC;"
666;D;25;student;-1;10;"SELECT
data:stories::int AS STORIES,
ROUND(AVG(data:price::int)) AS AVG_PRICE,
RANK() OVER(ORDER BY AVG_PRICE DESC) AS RANK
FROM house_price 
GROUP BY STORIES
;"
667;D;26;student;-1;10;"SELECT STORIES, AVG_PRICE,
ROW_NUMBER() OVER (
    ORDER BY AVG_PRICE DESC
) FROM
(SELECT
data:stories AS STORIES,
ROUND(AVG(data:price)) AS AVG_PRICE,
FROM house_price
GROUP BY STORIES
ORDER BY AVG_PRICE DESC);"
668;D;27;student;-1;10;"SELECT data:stories AS stories, ROUND(AVG(data:price), 0) AS AVG_price,
RANK() over (
    order by AVG_price DESC
) AS RANK
FROM house_price GROUP BY stories ORDER BY stories DESC;"
669;D;29;student;-1;10;"SELECT data:stories AS stories, ROUND(AVG(data:price)) as avg_price,
RANK() OVER(ORDER BY data:stories DESC) as rank
FROM house_price
GROUP BY data:stories
ORDER BY avg_price DESC;"
